{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/supabase/admin.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\n/**\r\n * Supabase Admin client using SERVICE_ROLE_KEY.\r\n * USE ONLY ON THE SERVER (Route Handlers, Server Actions).\r\n * This client bypasses RLS.\r\n */\r\nexport function createAdminClient() {\r\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n    if (!supabaseUrl || !supabaseServiceKey) {\r\n        throw new Error('[ADMIN] Supabase URL or Service Role Key is missing. Check your environment variables.');\r\n    }\r\n\r\n    return createClient(supabaseUrl || '', supabaseServiceKey || '', {\r\n        auth: {\r\n            autoRefreshToken: false,\r\n            persistSession: false\r\n        }\r\n    })\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,SAAS;IACZ,MAAM;IACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;IAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;QACrC,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO,IAAA,iRAAY,EAAC,eAAe,IAAI,sBAAsB,IAAI;QAC7D,MAAM;YACF,kBAAkB;YAClB,gBAAgB;QACpB;IACJ;AACJ"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/supabase/error.ts"],"sourcesContent":["/**\r\n * Serializa erros Supabase/Postgrest para logs e respostas JSON.\r\n * Evita \"{}\" no console quando o objeto não é enumerável.\r\n */\r\nexport function serializeSupabaseError(err: unknown): {\r\n    message: string;\r\n    code?: string;\r\n    details?: unknown;\r\n    hint?: string;\r\n    status?: number;\r\n    name?: string;\r\n} {\r\n    if (err == null) return { message: 'Unknown error' };\r\n\r\n    const e = err as Record<string, unknown>;\r\n    return {\r\n        message: typeof e?.message === 'string' ? e.message : String(err),\r\n        code: typeof e?.code === 'string' ? e.code : undefined,\r\n        details: e?.details,\r\n        hint: typeof e?.hint === 'string' ? e.hint : undefined,\r\n        status: typeof e?.status === 'number' ? e.status : undefined,\r\n        name: typeof e?.name === 'string' ? e.name : undefined,\r\n    };\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,SAAS,uBAAuB,GAAY;IAQ/C,IAAI,OAAO,MAAM,OAAO;QAAE,SAAS;IAAgB;IAEnD,MAAM,IAAI;IACV,OAAO;QACH,SAAS,OAAO,GAAG,YAAY,WAAW,EAAE,OAAO,GAAG,OAAO;QAC7D,MAAM,OAAO,GAAG,SAAS,WAAW,EAAE,IAAI,GAAG;QAC7C,SAAS,GAAG;QACZ,MAAM,OAAO,GAAG,SAAS,WAAW,EAAE,IAAI,GAAG;QAC7C,QAAQ,OAAO,GAAG,WAAW,WAAW,EAAE,MAAM,GAAG;QACnD,MAAM,OAAO,GAAG,SAAS,WAAW,EAAE,IAAI,GAAG;IACjD;AACJ"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/app/api/ads/%5Bid%5D/public/route.ts"],"sourcesContent":["/**\r\n * GET /api/ads/[id]/public\r\n * Detalhe público: anúncio published + owner approved. Inclui imagens (paths → URLs).\r\n */\r\nimport { NextResponse } from 'next/server'\r\nimport { createAdminClient } from '@/lib/supabase/admin'\r\nimport { serializeSupabaseError } from '@/lib/supabase/error'\r\n\r\nconst BUCKET = 'ad-images'\r\n\r\nfunction buildPublicUrl(path: string): string {\r\n    const url = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n    if (!url) return ''\r\n    const clean = path.replace(/^\\/+|\\/+$/g, '')\r\n    return `${url}/storage/v1/object/public/${BUCKET}/${clean}`\r\n}\r\n\r\nexport const dynamic = 'force-dynamic'\r\nexport const revalidate = 0\r\n\r\nexport async function GET(\r\n    _request: Request,\r\n    { params }: { params: Promise<{ id: string }> }\r\n) {\r\n    try {\r\n        const { id } = await params\r\n        if (!id) return NextResponse.json({ error: 'id obrigatório' }, { status: 400 })\r\n\r\n        const admin = createAdminClient()\r\n\r\n        const { data: adRow, error: adErr } = await admin\r\n            .from('ads')\r\n            .select('*')\r\n            .eq('id', id)\r\n            .eq('status', 'published')\r\n            .maybeSingle()\r\n\r\n        if (adErr) {\r\n            const ser = serializeSupabaseError(adErr)\r\n            console.error('[API/ADS/PUBLIC/GET] ads error:', ser)\r\n            return NextResponse.json({ error: ser.message }, { status: 500 })\r\n        }\r\n\r\n        if (!adRow) {\r\n            return NextResponse.json({ error: 'Anúncio não encontrado' }, { status: 404 })\r\n        }\r\n\r\n        const ownerId = adRow.owner_id as string\r\n        const { data: profile, error: profErr } = await admin\r\n            .from('profiles')\r\n            .select('id, status, full_name')\r\n            .eq('id', ownerId)\r\n            .maybeSingle()\r\n\r\n        if (profErr || !profile || (profile as { status: string }).status !== 'approved') {\r\n            return NextResponse.json({ error: 'Anúncio não encontrado' }, { status: 404 })\r\n        }\r\n\r\n        const { data: imgRows } = await admin\r\n            .from('ad_images')\r\n            .select('path, sort_order')\r\n            .eq('ad_id', id)\r\n            .order('sort_order', { ascending: true })\r\n\r\n        const images = ((imgRows ?? []) as { path: string; sort_order: number }[])\r\n            .sort((a, b) => a.sort_order - b.sort_order)\r\n            .map((i) => buildPublicUrl(i.path))\r\n\r\n        const ad = {\r\n            id: adRow.id,\r\n            userId: adRow.owner_id,\r\n            userName: (profile as { full_name: string }).full_name,\r\n            type: adRow.type,\r\n            status: adRow.status,\r\n            title: adRow.title,\r\n            description: adRow.description,\r\n            price: adRow.price_mzn != null ? Number(adRow.price_mzn) : null,\r\n            priceOnRequest: adRow.price_note != null && String(adRow.price_note).length > 0,\r\n            location: adRow.city,\r\n            province: adRow.province,\r\n            neighborhood: adRow.neighborhood ?? undefined,\r\n            categoryId: adRow.category,\r\n            whatsapp: adRow.whatsapp,\r\n            images: images.length > 0 ? images : [],\r\n            likes: 0,\r\n            createdAt: adRow.created_at,\r\n            updatedAt: adRow.updated_at,\r\n        }\r\n\r\n        return NextResponse.json({ ad })\r\n    } catch (err: unknown) {\r\n        const ser = serializeSupabaseError(err)\r\n        console.error('[API/ADS/PUBLIC/GET] unexpected error:', ser)\r\n        return NextResponse.json({ error: ser.message }, { status: 500 })\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}