{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/supabase/client.ts"],"sourcesContent":["import { createBrowserClient } from '@supabase/ssr'\r\n\r\nexport function createClient() {\r\n    return createBrowserClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    )\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;;AAEO,SAAS;IACZ,OAAO,IAAA,kRAAmB;AAI9B"}},
    {"offset": {"line": 24, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/storage.ts"],"sourcesContent":["/**\n * Persistência local para MVP.\n * Permite que o app funcione sem backend; depois pode ser trocado por Supabase.\n */\n\nimport type { Ad, AdStatus, AdClick, Category, User, Banner, LikedAdIds } from '../types';\n\nconst KEYS = {\n  ADS: 'celupublic_ads',\n  CATEGORIES: 'celupublic_categories',\n  USERS: 'celupublic_users',\n  BANNERS: 'celupublic_banners',\n  LIKED_IDS: 'celupublic_liked',\n  CURRENT_USER: 'celupublic_current_user',\n  AD_CLICKS: 'celupublic_ad_clicks',\n} as const;\n\nfunction get<T>(key: string, fallback: T): T {\n  try {\n    const raw = localStorage.getItem(key);\n    if (raw == null) return fallback;\n    return JSON.parse(raw) as T;\n  } catch {\n    return fallback;\n  }\n}\n\nfunction set(key: string, value: unknown): void {\n  localStorage.setItem(key, JSON.stringify(value));\n}\n\ntype AdStored = Ad | (Omit<Ad, 'status'> & { published?: boolean });\n\nfunction normalizeAd(a: AdStored): Ad {\n  const status: AdStatus =\n    'status' in a && a.status != null\n      ? a.status\n      : (a as { published?: boolean }).published === true\n        ? 'published'\n        : 'draft';\n  const { published, ...rest } = a as Ad & { published?: boolean };\n  return { ...rest, status };\n}\n\nexport const storage = {\n  getAds(): Ad[] {\n    const raw = get<AdStored[]>(KEYS.ADS, []);\n    return raw.map(normalizeAd);\n  },\n  setAds(ads: Ad[]) {\n    set(KEYS.ADS, ads);\n  },\n\n  getCategories(): Category[] {\n    return get(KEYS.CATEGORIES, []);\n  },\n  setCategories(categories: Category[]) {\n    set(KEYS.CATEGORIES, categories);\n  },\n\n  getUsers(): User[] {\n    return get(KEYS.USERS, []);\n  },\n  setUsers(users: User[]) {\n    set(KEYS.USERS, users);\n  },\n\n  getBanners(): Banner[] {\n    return get(KEYS.BANNERS, []);\n  },\n  setBanners(banners: Banner[]) {\n    set(KEYS.BANNERS, banners);\n  },\n\n  getLikedIds(): LikedAdIds {\n    return get(KEYS.LIKED_IDS, {});\n  },\n  setLikedIds(ids: LikedAdIds) {\n    set(KEYS.LIKED_IDS, ids);\n  },\n\n  getCurrentUserId(): string | null {\n    return get(KEYS.CURRENT_USER, null);\n  },\n  setCurrentUserId(id: string | null) {\n    set(KEYS.CURRENT_USER, id);\n  },\n\n  getAdClicks(): AdClick[] {\n    return get(KEYS.AD_CLICKS, []);\n  },\n  setAdClicks(clicks: AdClick[]) {\n    set(KEYS.AD_CLICKS, clicks);\n  },\n};\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AAID,MAAM,OAAO;IACX,KAAK;IACL,YAAY;IACZ,OAAO;IACP,SAAS;IACT,WAAW;IACX,cAAc;IACd,WAAW;AACb;AAEA,SAAS,IAAO,GAAW,EAAE,QAAW;IACtC,IAAI;QACF,MAAM,MAAM,aAAa,OAAO,CAAC;QACjC,IAAI,OAAO,MAAM,OAAO;QACxB,OAAO,KAAK,KAAK,CAAC;IACpB,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAEA,SAAS,IAAI,GAAW,EAAE,KAAc;IACtC,aAAa,OAAO,CAAC,KAAK,KAAK,SAAS,CAAC;AAC3C;AAIA,SAAS,YAAY,CAAW;IAC9B,MAAM,SACJ,YAAY,KAAK,EAAE,MAAM,IAAI,OACzB,EAAE,MAAM,GACR,AAAC,EAA8B,SAAS,KAAK,OAC3C,cACA;IACR,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,GAAG;IAC/B,OAAO;QAAE,GAAG,IAAI;QAAE;IAAO;AAC3B;AAEO,MAAM,UAAU;IACrB;QACE,MAAM,MAAM,IAAgB,KAAK,GAAG,EAAE,EAAE;QACxC,OAAO,IAAI,GAAG,CAAC;IACjB;IACA,QAAO,GAAS;QACd,IAAI,KAAK,GAAG,EAAE;IAChB;IAEA;QACE,OAAO,IAAI,KAAK,UAAU,EAAE,EAAE;IAChC;IACA,eAAc,UAAsB;QAClC,IAAI,KAAK,UAAU,EAAE;IACvB;IAEA;QACE,OAAO,IAAI,KAAK,KAAK,EAAE,EAAE;IAC3B;IACA,UAAS,KAAa;QACpB,IAAI,KAAK,KAAK,EAAE;IAClB;IAEA;QACE,OAAO,IAAI,KAAK,OAAO,EAAE,EAAE;IAC7B;IACA,YAAW,OAAiB;QAC1B,IAAI,KAAK,OAAO,EAAE;IACpB;IAEA;QACE,OAAO,IAAI,KAAK,SAAS,EAAE,CAAC;IAC9B;IACA,aAAY,GAAe;QACzB,IAAI,KAAK,SAAS,EAAE;IACtB;IAEA;QACE,OAAO,IAAI,KAAK,YAAY,EAAE;IAChC;IACA,kBAAiB,EAAiB;QAChC,IAAI,KAAK,YAAY,EAAE;IACzB;IAEA;QACE,OAAO,IAAI,KAAK,SAAS,EAAE,EAAE;IAC/B;IACA,aAAY,MAAiB;QAC3B,IAAI,KAAK,SAAS,EAAE;IACtB;AACF"}},
    {"offset": {"line": 109, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/local/usersRepo.local.ts"],"sourcesContent":["import type { User, AccountStatus } from '@/types';\nimport type { UsersRepository, CreateUserPayload } from '../usersRepo';\nimport { storage } from '@/lib/storage';\n\nexport const usersRepo: UsersRepository = {\n  async list(filters) {\n    let list = storage.getUsers();\n    if (filters?.status) list = list.filter((u) => u.status === filters.status);\n    if (filters?.role) list = list.filter((u) => u.role === filters.role);\n    return list.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  },\n\n  async getById(id: string) {\n    return storage.getUsers().find((u) => u.id === id) ?? null;\n  },\n\n  getCurrentUserId() {\n    return storage.getCurrentUserId();\n  },\n\n  setCurrentUserId(id: string | null) {\n    storage.setCurrentUserId(id);\n  },\n\n  async create(data: CreateUserPayload) {\n    const now = new Date().toISOString();\n    const user: User = {\n      ...data,\n      id: data.id ?? crypto.randomUUID(),\n      createdAt: now,\n      updatedAt: now,\n    };\n    const users = storage.getUsers();\n    storage.setUsers([...users, user]);\n    return user;\n  },\n\n  async updateStatus(id: string, status: AccountStatus) {\n    const users = storage.getUsers();\n    const index = users.findIndex((u) => u.id === id);\n    if (index === -1) return null;\n    const now = new Date().toISOString();\n    const updated: User = { ...users[index], status, updatedAt: now };\n    const next = [...users];\n    next[index] = updated;\n    storage.setUsers(next);\n    return updated;\n  },\n\n  async update(id: string, data: Partial<Omit<User, 'id'>>) {\n    const users = storage.getUsers();\n    const index = users.findIndex((u) => u.id === id);\n    if (index === -1) return null;\n    const now = new Date().toISOString();\n    const updated: User = { ...users[index], ...data, updatedAt: now };\n    const next = [...users];\n    next[index] = updated;\n    storage.setUsers(next);\n    return updated;\n  },\n};\n"],"names":[],"mappings":";;;;AAEA;;AAEO,MAAM,YAA6B;IACxC,MAAM,MAAK,OAAO;QAChB,IAAI,OAAO,0MAAO,CAAC,QAAQ;QAC3B,IAAI,SAAS,QAAQ,OAAO,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,QAAQ,MAAM;QAC1E,IAAI,SAAS,MAAM,OAAO,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK,QAAQ,IAAI;QACpE,OAAO,KAAK,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;IAC5F;IAEA,MAAM,SAAQ,EAAU;QACtB,OAAO,0MAAO,CAAC,QAAQ,GAAG,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,OAAO;IACxD;IAEA;QACE,OAAO,0MAAO,CAAC,gBAAgB;IACjC;IAEA,kBAAiB,EAAiB;QAChC,0MAAO,CAAC,gBAAgB,CAAC;IAC3B;IAEA,MAAM,QAAO,IAAuB;QAClC,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,OAAa;YACjB,GAAG,IAAI;YACP,IAAI,KAAK,EAAE,IAAI,OAAO,UAAU;YAChC,WAAW;YACX,WAAW;QACb;QACA,MAAM,QAAQ,0MAAO,CAAC,QAAQ;QAC9B,0MAAO,CAAC,QAAQ,CAAC;eAAI;YAAO;SAAK;QACjC,OAAO;IACT;IAEA,MAAM,cAAa,EAAU,EAAE,MAAqB;QAClD,MAAM,QAAQ,0MAAO,CAAC,QAAQ;QAC9B,MAAM,QAAQ,MAAM,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAC9C,IAAI,UAAU,CAAC,GAAG,OAAO;QACzB,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,UAAgB;YAAE,GAAG,KAAK,CAAC,MAAM;YAAE;YAAQ,WAAW;QAAI;QAChE,MAAM,OAAO;eAAI;SAAM;QACvB,IAAI,CAAC,MAAM,GAAG;QACd,0MAAO,CAAC,QAAQ,CAAC;QACjB,OAAO;IACT;IAEA,MAAM,QAAO,EAAU,EAAE,IAA+B;QACtD,MAAM,QAAQ,0MAAO,CAAC,QAAQ;QAC9B,MAAM,QAAQ,MAAM,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAC9C,IAAI,UAAU,CAAC,GAAG,OAAO;QACzB,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,UAAgB;YAAE,GAAG,KAAK,CAAC,MAAM;YAAE,GAAG,IAAI;YAAE,WAAW;QAAI;QACjE,MAAM,OAAO;eAAI;SAAM;QACvB,IAAI,CAAC,MAAM,GAAG;QACd,0MAAO,CAAC,QAAQ,CAAC;QACjB,OAAO;IACT;AACF"}},
    {"offset": {"line": 185, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/errors.ts"],"sourcesContent":["/**\n * Standardized app errors for repository and UI feedback.\n */\n\nexport const ERROR_CODES = {\n  LIMIT_REACHED: 'LIMIT_REACHED',\n  NOT_FOUND: 'NOT_FOUND',\n  UNAUTHORIZED: 'UNAUTHORIZED',\n  TIMEOUT: 'TIMEOUT',\n  SUPABASE_CONFIG: 'SUPABASE_CONFIG',\n  STORAGE_BUCKET_MISSING: 'STORAGE_BUCKET_MISSING',\n  UNKNOWN: 'UNKNOWN',\n} as const;\n\nexport type AppErrorCode = (typeof ERROR_CODES)[keyof typeof ERROR_CODES];\n\nexport class AppError extends Error {\n  constructor(\n    public readonly code: AppErrorCode,\n    message: string,\n    /** Optional low-level details for logging/diagnostics (never mostrado cru na UI). */\n    public readonly details?: unknown\n  ) {\n    super(message);\n    this.name = 'AppError';\n    Object.setPrototypeOf(this, AppError.prototype);\n  }\n}\n\n/** User-facing messages in Portuguese. */\nexport const ERROR_MESSAGES: Record<AppErrorCode, string> = {\n  [ERROR_CODES.LIMIT_REACHED]:\n    'Atingiu o limite de anúncios para este tipo. Remova um anúncio antigo ou contacte o administrador.',\n  [ERROR_CODES.NOT_FOUND]: 'Não encontrado.',\n  [ERROR_CODES.UNAUTHORIZED]: 'Sem permissão para esta ação.',\n  [ERROR_CODES.TIMEOUT]: 'A operação demorou demasiado tempo. Tente novamente.',\n  [ERROR_CODES.SUPABASE_CONFIG]:\n    'Configuração do Supabase em falta. Verifique as variáveis de ambiente no servidor.',\n  [ERROR_CODES.STORAGE_BUCKET_MISSING]:\n    \"Bucket de armazenamento em falta no Supabase. Confirme o nome do bucket no dashboard.\",\n  [ERROR_CODES.UNKNOWN]: 'Ocorreu um erro inesperado. Tente novamente.',\n};\n\nexport function getMessageForError(error: unknown): string {\n  if (error instanceof AppError) return ERROR_MESSAGES[error.code] ?? error.message;\n  if (error instanceof Error) return error.message;\n  return 'Ocorreu um erro. Tente novamente.';\n}\n\n/**\n * Converte qualquer erro JS/Supabase num AppError consistente.\n */\nexport function toAppError(error: unknown, context?: { fallbackMessage?: string }): AppError {\n  if (error instanceof AppError) return error;\n\n  // Supabase client error (postgrest, storage, auth)\n  const supa = error as any;\n  if (supa?.message || supa?.status || supa?.code) {\n    const status = supa.status as number | undefined;\n    const message: string =\n      supa.message ??\n      context?.fallbackMessage ??\n      'Erro ao comunicar com o servidor. Tente novamente.';\n\n    if (status === 401 || status === 403) {\n      return new AppError(ERROR_CODES.UNAUTHORIZED, message, supa);\n    }\n\n    if (status === 404) {\n      return new AppError(ERROR_CODES.NOT_FOUND, message, supa);\n    }\n\n    return new AppError(ERROR_CODES.UNKNOWN, message, supa);\n  }\n\n  if (error instanceof Error) {\n    return new AppError(ERROR_CODES.UNKNOWN, error.message, error);\n  }\n\n  return new AppError(\n    ERROR_CODES.UNKNOWN,\n    context?.fallbackMessage ?? 'Ocorreu um erro. Tente novamente.',\n    error\n  );\n}\n\n/**\n * Envolve uma Promise com timeout e lança AppError se o tempo for excedido.\n */\nexport async function withTimeout<T>(\n  promise: PromiseLike<T>,\n  ms: number,\n  label = 'Operação'\n): Promise<T> {\n  let timeoutId: ReturnType<typeof setTimeout> | undefined;\n\n  const timeoutPromise = new Promise<never>((_, reject) => {\n    timeoutId = setTimeout(() => {\n      reject(\n        new AppError(\n          ERROR_CODES.TIMEOUT,\n          `${label} demorou demasiado tempo a responder. Tente novamente mais tarde.`\n        )\n      );\n    }, ms);\n  });\n\n  try {\n    const result = await Promise.race([promise, timeoutPromise]);\n    return result as T;\n  } finally {\n    if (timeoutId) clearTimeout(timeoutId);\n  }\n}\n\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;;;;;;;;;AAEM,MAAM,cAAc;IACzB,eAAe;IACf,WAAW;IACX,cAAc;IACd,SAAS;IACT,iBAAiB;IACjB,wBAAwB;IACxB,SAAS;AACX;AAIO,MAAM,iBAAiB;;;IAC5B,YACE,AAAgB,IAAkB,EAClC,OAAe,EACf,mFAAmF,GACnF,AAAgB,OAAiB,CACjC;QACA,KAAK,CAAC,eALU,OAAA,WAGA,UAAA;QAGhB,IAAI,CAAC,IAAI,GAAG;QACZ,OAAO,cAAc,CAAC,IAAI,EAAE,SAAS,SAAS;IAChD;AACF;AAGO,MAAM,iBAA+C;IAC1D,CAAC,YAAY,aAAa,CAAC,EACzB;IACF,CAAC,YAAY,SAAS,CAAC,EAAE;IACzB,CAAC,YAAY,YAAY,CAAC,EAAE;IAC5B,CAAC,YAAY,OAAO,CAAC,EAAE;IACvB,CAAC,YAAY,eAAe,CAAC,EAC3B;IACF,CAAC,YAAY,sBAAsB,CAAC,EAClC;IACF,CAAC,YAAY,OAAO,CAAC,EAAE;AACzB;AAEO,SAAS,mBAAmB,KAAc;IAC/C,IAAI,iBAAiB,UAAU,OAAO,cAAc,CAAC,MAAM,IAAI,CAAC,IAAI,MAAM,OAAO;IACjF,IAAI,iBAAiB,OAAO,OAAO,MAAM,OAAO;IAChD,OAAO;AACT;AAKO,SAAS,WAAW,KAAc,EAAE,OAAsC;IAC/E,IAAI,iBAAiB,UAAU,OAAO;IAEtC,mDAAmD;IACnD,MAAM,OAAO;IACb,IAAI,MAAM,WAAW,MAAM,UAAU,MAAM,MAAM;QAC/C,MAAM,SAAS,KAAK,MAAM;QAC1B,MAAM,UACJ,KAAK,OAAO,IACZ,SAAS,mBACT;QAEF,IAAI,WAAW,OAAO,WAAW,KAAK;YACpC,OAAO,IAAI,SAAS,YAAY,YAAY,EAAE,SAAS;QACzD;QAEA,IAAI,WAAW,KAAK;YAClB,OAAO,IAAI,SAAS,YAAY,SAAS,EAAE,SAAS;QACtD;QAEA,OAAO,IAAI,SAAS,YAAY,OAAO,EAAE,SAAS;IACpD;IAEA,IAAI,iBAAiB,OAAO;QAC1B,OAAO,IAAI,SAAS,YAAY,OAAO,EAAE,MAAM,OAAO,EAAE;IAC1D;IAEA,OAAO,IAAI,SACT,YAAY,OAAO,EACnB,SAAS,mBAAmB,qCAC5B;AAEJ;AAKO,eAAe,YACpB,OAAuB,EACvB,EAAU,EACV,QAAQ,UAAU;IAElB,IAAI;IAEJ,MAAM,iBAAiB,IAAI,QAAe,CAAC,GAAG;QAC5C,YAAY,WAAW;YACrB,OACE,IAAI,SACF,YAAY,OAAO,EACnB,GAAG,MAAM,iEAAiE,CAAC;QAGjF,GAAG;IACL;IAEA,IAAI;QACF,MAAM,SAAS,MAAM,QAAQ,IAAI,CAAC;YAAC;YAAS;SAAe;QAC3D,OAAO;IACT,SAAU;QACR,IAAI,WAAW,aAAa;IAC9B;AACF"}},
    {"offset": {"line": 274, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/supabaseClient.ts"],"sourcesContent":["/**\n * Supabase client SINGLETON — único no app inteiro.\n *\n * Regras:\n * - createClient chamado UMA única vez (guard `supabaseInstance`).\n * - storageKey FIXO → evita logout em refresh por chave trocada.\n * - storage: window.localStorage explícito → evita SSR issues e garante persistência.\n * - persistSession: true + autoRefreshToken: true → sessão estável.\n * - detectSessionInUrl: true → necessário para PKCE/OAuth callback.\n *\n * USE SEMPRE `getSupabase()` nos repos/context. Nunca re-importe createClient.\n */\nimport { createClient, type SupabaseClient } from '@supabase/supabase-js';\nimport { AppError, ERROR_CODES } from './errors';\nimport { __STORAGE_HELPERS_VERSION__ } from './storageHelpers';\n\nconst url = process.env.NEXT_PUBLIC_SUPABASE_URL as string | undefined;\nconst anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY as string | undefined;\nconst useSupabaseFlag =\n  String(process.env.NEXT_PUBLIC_USE_SUPABASE ?? '').toLowerCase() === 'true';\n\nconst hasCredentials = !!url && !!anonKey;\n\n/**\n * Indica se o modo Supabase está efetivamente ativo (flag + credenciais válidas).\n */\nexport const useSupabase = useSupabaseFlag && hasCredentials;\n\n/**\n * Erro de configuração quando o flag está ativo mas faltam credenciais.\n */\nexport const supabaseConfigError =\n  useSupabaseFlag && !hasCredentials\n    ? new AppError(\n      ERROR_CODES.SUPABASE_CONFIG,\n      'NEXT_PUBLIC_USE_SUPABASE=true mas NEXT_PUBLIC_SUPABASE_URL ou NEXT_PUBLIC_SUPABASE_ANON_KEY não estão definidos.'\n    )\n    : null;\n\n/**\n * Chave de storage FIXA.\n * CRÍTICO: deve ser estável entre reloads e builds.\n * Se mudar → todos os utilizadores fazem logout.\n */\nconst SUPABASE_STORAGE_KEY = 'celu_auth_v1';\n\n/**\n * ID único desta instância (singleton proof).\n * Deve ser igual em todos os lugares do app.\n */\nconst CLIENT_INSTANCE_ID = typeof crypto !== 'undefined' ? crypto.randomUUID() : 'ssr-client-id';\n\n// ── Log de arranque ────────────────────────────────────────────────────────────\nif (process.env.NODE_ENV === 'development') {\n  // eslint-disable-next-line no-console\n  console.log('[BOOT] Supabase flag:', useSupabaseFlag, '| hasCredentials:', hasCredentials);\n  // eslint-disable-next-line no-console\n  // console.log('[BOOT] storageHelpers version:', __STORAGE_HELPERS_VERSION__);\n  // eslint-disable-next-line no-console\n  console.log('[BOOT] CLIENT_INSTANCE_ID:', CLIENT_INSTANCE_ID);\n  if (supabaseConfigError) {\n    // eslint-disable-next-line no-console\n    console.error('[BOOT] Supabase config error:', supabaseConfigError.message);\n  }\n}\n\nlet supabaseInstance: SupabaseClient | null = null;\n\nfunction createSupabase(): SupabaseClient | null {\n  // Modo local ou credenciais em falta: não cria client\n  if (!useSupabaseFlag || !hasCredentials) {\n    return null;\n  }\n\n  // SINGLETON: devolve instância existente se já criada\n  if (supabaseInstance) {\n    if (process.env.NODE_ENV === 'development') {\n      // eslint-disable-next-line no-console\n      console.log('[BOOT] Supabase singleton reutilizado, clientId:', CLIENT_INSTANCE_ID);\n    }\n    return supabaseInstance;\n  }\n\n  try {\n    supabaseInstance = createClient(url!, anonKey!, {\n      auth: {\n        persistSession: true,\n        autoRefreshToken: true,\n        detectSessionInUrl: true,\n        // CRÍTICO: storageKey fixo evita logout em refresh por chave instável\n        storageKey: SUPABASE_STORAGE_KEY,\n        // storage explícito: garante localStorage e não sessionStorage\n        storage: typeof window !== 'undefined' ? window.localStorage : undefined,\n        // flowType PKCE: mais seguro para OAuth\n        flowType: 'pkce',\n      },\n    });\n\n    if (process.env.NODE_ENV === 'development') {\n      // eslint-disable-next-line no-console\n      console.log('[BOOT] Supabase client CRIADO:', {\n        clientId: CLIENT_INSTANCE_ID,\n        storageKey: SUPABASE_STORAGE_KEY,\n        url: url?.slice(0, 40) + '...',\n      });\n    }\n    return supabaseInstance;\n  } catch (err: any) {\n    if (process.env.NODE_ENV === 'development') {\n      // eslint-disable-next-line no-console\n      console.error('[BOOT] Failed to create Supabase client:', err);\n      // eslint-disable-next-line no-console\n      console.warn('[BOOT] Falling back to local mode');\n    }\n    return null;\n  }\n}\n\n/** Devolve o client Supabase singleton; null se não configurado. */\nexport function getSupabase(): SupabaseClient | null {\n  return createSupabase();\n}\n\n/**\n * Retorna o ID único desta instância do client.\n * Use em 3 lugares diferentes para provar que é singleton.\n */\nexport function getSupabaseClientId(): string {\n  return CLIENT_INSTANCE_ID;\n}\n\n/** Client pronto quando Supabase está ativo. Pode ser null se env faltar. */\nexport const supabase = createSupabase();\n\n// Prova singleton no boot (DEV only)\nif (process.env.NODE_ENV === 'development' && supabase) {\n  // eslint-disable-next-line no-console\n  console.log('[BOOT] supabase export clientId:', CLIENT_INSTANCE_ID, '(deve ser igual em AuthContext e repos)');\n}\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;;;;;;;;;;CAWC,GACD;AACA;;;AAGA,MAAM;AACN,MAAM;AACN,MAAM,kBACJ,OAAO,4CAAwC,IAAI,WAAW,OAAO;AAEvE,MAAM,iBAAiB,CAAC,CAAC,OAAO,CAAC,CAAC;AAK3B,MAAM,cAAc,mBAAmB;AAKvC,MAAM,sBACX,sCACI,0BAIA;AAEN;;;;CAIC,GACD,MAAM,uBAAuB;AAE7B;;;CAGC,GACD,MAAM,qBAAqB,OAAO,WAAW,cAAc,OAAO,UAAU,KAAK;AAEjF,kFAAkF;AAClF,wCAA4C;IAC1C,sCAAsC;IACtC,QAAQ,GAAG,CAAC,yBAAyB,iBAAiB,qBAAqB;IAC3E,sCAAsC;IACtC,8EAA8E;IAC9E,sCAAsC;IACtC,QAAQ,GAAG,CAAC,8BAA8B;IAC1C;;AAIF;AAEA,IAAI,mBAA0C;AAE9C,SAAS;IACP,sDAAsD;IACtD,IAAI,CAAC,mBAAmB,CAAC,gBAAgB;QACvC,OAAO;IACT;IAEA,sDAAsD;IACtD,IAAI,kBAAkB;QACpB,wCAA4C;YAC1C,sCAAsC;YACtC,QAAQ,GAAG,CAAC,oDAAoD;QAClE;QACA,OAAO;IACT;IAEA,IAAI;QACF,mBAAmB,IAAA,+QAAY,EAAC,KAAM,SAAU;YAC9C,MAAM;gBACJ,gBAAgB;gBAChB,kBAAkB;gBAClB,oBAAoB;gBACpB,sEAAsE;gBACtE,YAAY;gBACZ,+DAA+D;gBAC/D,SAAS,sCAAgC,0BAAsB;gBAC/D,wCAAwC;gBACxC,UAAU;YACZ;QACF;QAEA,wCAA4C;YAC1C,sCAAsC;YACtC,QAAQ,GAAG,CAAC,kCAAkC;gBAC5C,UAAU;gBACV,YAAY;gBACZ,KAAK,KAAK,MAAM,GAAG,MAAM;YAC3B;QACF;QACA,OAAO;IACT,EAAE,OAAO,KAAU;QACjB,wCAA4C;YAC1C,sCAAsC;YACtC,QAAQ,KAAK,CAAC,4CAA4C;YAC1D,sCAAsC;YACtC,QAAQ,IAAI,CAAC;QACf;QACA,OAAO;IACT;AACF;AAGO,SAAS;IACd,OAAO;AACT;AAMO,SAAS;IACd,OAAO;AACT;AAGO,MAAM,WAAW;AAExB,qCAAqC;AACrC,IAAI,oDAAyB,iBAAiB,UAAU;IACtD,sCAAsC;IACtC,QAAQ,GAAG,CAAC,oCAAoC,oBAAoB;AACtE"}},
    {"offset": {"line": 390, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/supabase/usersRepo.supabase.ts"],"sourcesContent":["/**\r\n * Supabase implementation: profiles table + Auth.\r\n * Requires RLS policies and profiles table (see supabase/migrations).\r\n */\r\nimport type { User, AccountStatus } from '@/types';\r\nimport type { UsersRepository, CreateUserPayload } from '../usersRepo';\r\nimport { getSupabase } from '@/lib/supabaseClient';\r\nimport { AppError, ERROR_CODES } from '@/lib/errors';\r\n\r\ntype ProfileRow = {\r\n  id: string;\r\n  full_name: string;\r\n  email: string;\r\n  whatsapp: string | null;\r\n  province: string | null;\r\n  city: string | null;\r\n  role: string;\r\n  status: string;\r\n  account_type: string | null;\r\n  created_at: string;\r\n  updated_at: string;\r\n};\r\n\r\nfunction rowToUser(row: ProfileRow): User {\r\n  if (!row) throw new Error('[USERS_REPO] Invalid profile row');\r\n  return {\r\n    id: row.id,\r\n    email: row.email || '',\r\n    name: row.full_name || 'Utilizador',\r\n    role: (row.role === 'admin' ? 'admin' : 'seller') as User['role'],\r\n    status: (row.status || 'pending') as AccountStatus,\r\n    accountType: row.account_type as User['accountType'] ?? undefined,\r\n    whatsapp: row.whatsapp ?? undefined,\r\n    city: row.city ?? undefined,\r\n    province: row.province ?? undefined,\r\n    createdAt: row.created_at || new Date().toISOString(),\r\n    updatedAt: row.updated_at || new Date().toISOString(),\r\n  };\r\n}\r\n\r\nlet currentUserId: string | null = null;\r\n\r\nexport const usersRepoSupabase: UsersRepository = {\r\n  getCurrentUserId() {\r\n    return currentUserId;\r\n  },\r\n\r\n  setCurrentUserId(id: string | null) {\r\n    currentUserId = id;\r\n  },\r\n\r\n  async list(filters) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return [];\r\n\r\n    let query = supabase.from('profiles').select('*').order('created_at', { ascending: false });\r\n    if (filters?.status) query = query.eq('status', filters.status);\r\n    if (filters?.role) query = query.eq('role', filters.role);\r\n\r\n    const { data, error } = await query;\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][usersRepo.list]', error);\r\n      if (error.code === 'PGRST116' || error.message?.includes('policy')) {\r\n        return [];\r\n      }\r\n      throw new AppError(ERROR_CODES.UNAUTHORIZED, error.message);\r\n    }\r\n    return (data as ProfileRow[]).map(rowToUser);\r\n  },\r\n\r\n  async getById(id: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    try {\r\n      const { data, error } = await supabase.from('profiles').select('*').eq('id', id).single();\r\n      if (error || !data) {\r\n        if (error) {\r\n          // If 0 rows found with single(), it's expected if profile trigger hasn't run yet or is pending sync.\r\n          // PGRST116 = \"The result contains 0 rows\"\r\n          if (error.code === 'PGRST116') {\r\n            return null;\r\n          }\r\n\r\n          // eslint-disable-next-line no-console\r\n          console.error('[SUPABASE ERROR][usersRepo.getById]', {\r\n            code: error.code,\r\n            message: error.message,\r\n            details: error.details,\r\n          });\r\n\r\n          // Check for RLS recursion error (42P17)\r\n          if (error.code === '42P17' || error.message?.includes('recursion') || error.message?.includes('infinite')) {\r\n            // eslint-disable-next-line no-console\r\n            console.error(\r\n              '[RLS] profiles policy recursion detected (42P17) - ensure migration 20250216_fix_profiles_rls_no_recursion.sql is applied'\r\n            );\r\n          }\r\n        }\r\n        return null;\r\n      }\r\n      return rowToUser(data as ProfileRow);\r\n    } catch (err: any) {\r\n      // Catch any unexpected errors (network, etc.)\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][usersRepo.getById] unexpected error:', err);\r\n      return null;\r\n    }\r\n  },\r\n\r\n  async create() {\r\n    // CRÍTICO: Criação de perfis deve ser feita via Route Handler servidor (bypass RLS).\r\n    // O client anon/auth não tem permissão de INSERT direto em profiles em muitos cenários de bootstrap.\r\n    // Isso evita o erro 42501 (new row violates row-level security policy).\r\n    throw new Error('[USERS_REPO] Direct create is disabled from client. Use /api/profile/ensure');\r\n  },\r\n\r\n  async updateStatus(id: string, status: AccountStatus) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    const { data, error } = await supabase\r\n      .from('profiles')\r\n      .update({ status, updated_at: new Date().toISOString() })\r\n      .eq('id', id)\r\n      .select()\r\n      .single();\r\n\r\n    if (error || !data) {\r\n      if (error) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][usersRepo.updateStatus]', error);\r\n      }\r\n      return null;\r\n    }\r\n    return rowToUser(data as ProfileRow);\r\n  },\r\n\r\n  async update(id: string, payload: Partial<Omit<User, 'id'>>) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    const updates: Record<string, unknown> = { updated_at: new Date().toISOString() };\r\n    if (payload.name != null) updates.full_name = payload.name;\r\n    if (payload.email != null) updates.email = payload.email;\r\n    if (payload.whatsapp != null) updates.whatsapp = payload.whatsapp;\r\n    if (payload.province != null) updates.province = payload.province;\r\n    if (payload.city != null) updates.city = payload.city;\r\n    if (payload.role != null) updates.role = payload.role;\r\n    if (payload.status != null) updates.status = payload.status;\r\n    if (payload.accountType != null) updates.account_type = payload.accountType;\r\n\r\n    const { data, error } = await supabase.from('profiles').update(updates).eq('id', id).select().single();\r\n    if (error || !data) {\r\n      if (error) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][usersRepo.update]', error);\r\n      }\r\n      return null;\r\n    }\r\n    return rowToUser(data as ProfileRow);\r\n  },\r\n};\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AAGD;AACA;;;AAgBA,SAAS,UAAU,GAAe;IAChC,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;QACL,IAAI,IAAI,EAAE;QACV,OAAO,IAAI,KAAK,IAAI;QACpB,MAAM,IAAI,SAAS,IAAI;QACvB,MAAO,IAAI,IAAI,KAAK,UAAU,UAAU;QACxC,QAAS,IAAI,MAAM,IAAI;QACvB,aAAa,IAAI,YAAY,IAA2B;QACxD,UAAU,IAAI,QAAQ,IAAI;QAC1B,MAAM,IAAI,IAAI,IAAI;QAClB,UAAU,IAAI,QAAQ,IAAI;QAC1B,WAAW,IAAI,UAAU,IAAI,IAAI,OAAO,WAAW;QACnD,WAAW,IAAI,UAAU,IAAI,IAAI,OAAO,WAAW;IACrD;AACF;AAEA,IAAI,gBAA+B;AAE5B,MAAM,oBAAqC;IAChD;QACE,OAAO;IACT;IAEA,kBAAiB,EAAiB;QAChC,gBAAgB;IAClB;IAEA,MAAM,MAAK,OAAO;QAChB,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO,EAAE;QAExB,IAAI,QAAQ,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC,KAAK,KAAK,CAAC,cAAc;YAAE,WAAW;QAAM;QACzF,IAAI,SAAS,QAAQ,QAAQ,MAAM,EAAE,CAAC,UAAU,QAAQ,MAAM;QAC9D,IAAI,SAAS,MAAM,QAAQ,MAAM,EAAE,CAAC,QAAQ,QAAQ,IAAI;QAExD,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM;QAC9B,IAAI,OAAO;YACT,sCAAsC;YACtC,QAAQ,KAAK,CAAC,oCAAoC;YAClD,IAAI,MAAM,IAAI,KAAK,cAAc,MAAM,OAAO,EAAE,SAAS,WAAW;gBAClE,OAAO,EAAE;YACX;YACA,MAAM,IAAI,0MAAQ,CAAC,6MAAW,CAAC,YAAY,EAAE,MAAM,OAAO;QAC5D;QACA,OAAO,AAAC,KAAsB,GAAG,CAAC;IACpC;IAEA,MAAM,SAAQ,EAAU;QACtB,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO;QAEtB,IAAI;YACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC,KAAK,EAAE,CAAC,MAAM,IAAI,MAAM;YACvF,IAAI,SAAS,CAAC,MAAM;gBAClB,IAAI,OAAO;oBACT,qGAAqG;oBACrG,0CAA0C;oBAC1C,IAAI,MAAM,IAAI,KAAK,YAAY;wBAC7B,OAAO;oBACT;oBAEA,sCAAsC;oBACtC,QAAQ,KAAK,CAAC,uCAAuC;wBACnD,MAAM,MAAM,IAAI;wBAChB,SAAS,MAAM,OAAO;wBACtB,SAAS,MAAM,OAAO;oBACxB;oBAEA,wCAAwC;oBACxC,IAAI,MAAM,IAAI,KAAK,WAAW,MAAM,OAAO,EAAE,SAAS,gBAAgB,MAAM,OAAO,EAAE,SAAS,aAAa;wBACzG,sCAAsC;wBACtC,QAAQ,KAAK,CACX;oBAEJ;gBACF;gBACA,OAAO;YACT;YACA,OAAO,UAAU;QACnB,EAAE,OAAO,KAAU;YACjB,8CAA8C;YAC9C,sCAAsC;YACtC,QAAQ,KAAK,CAAC,yDAAyD;YACvE,OAAO;QACT;IACF;IAEA,MAAM;QACJ,qFAAqF;QACrF,qGAAqG;QACrG,wEAAwE;QACxE,MAAM,IAAI,MAAM;IAClB;IAEA,MAAM,cAAa,EAAU,EAAE,MAAqB;QAClD,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO;QAEtB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC;YAAE;YAAQ,YAAY,IAAI,OAAO,WAAW;QAAG,GACtD,EAAE,CAAC,MAAM,IACT,MAAM,GACN,MAAM;QAET,IAAI,SAAS,CAAC,MAAM;YAClB,IAAI,OAAO;gBACT,sCAAsC;gBACtC,QAAQ,KAAK,CAAC,4CAA4C;YAC5D;YACA,OAAO;QACT;QACA,OAAO,UAAU;IACnB;IAEA,MAAM,QAAO,EAAU,EAAE,OAAkC;QACzD,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO;QAEtB,MAAM,UAAmC;YAAE,YAAY,IAAI,OAAO,WAAW;QAAG;QAChF,IAAI,QAAQ,IAAI,IAAI,MAAM,QAAQ,SAAS,GAAG,QAAQ,IAAI;QAC1D,IAAI,QAAQ,KAAK,IAAI,MAAM,QAAQ,KAAK,GAAG,QAAQ,KAAK;QACxD,IAAI,QAAQ,QAAQ,IAAI,MAAM,QAAQ,QAAQ,GAAG,QAAQ,QAAQ;QACjE,IAAI,QAAQ,QAAQ,IAAI,MAAM,QAAQ,QAAQ,GAAG,QAAQ,QAAQ;QACjE,IAAI,QAAQ,IAAI,IAAI,MAAM,QAAQ,IAAI,GAAG,QAAQ,IAAI;QACrD,IAAI,QAAQ,IAAI,IAAI,MAAM,QAAQ,IAAI,GAAG,QAAQ,IAAI;QACrD,IAAI,QAAQ,MAAM,IAAI,MAAM,QAAQ,MAAM,GAAG,QAAQ,MAAM;QAC3D,IAAI,QAAQ,WAAW,IAAI,MAAM,QAAQ,YAAY,GAAG,QAAQ,WAAW;QAE3E,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,CAAC,SAAS,EAAE,CAAC,MAAM,IAAI,MAAM,GAAG,MAAM;QACpG,IAAI,SAAS,CAAC,MAAM;YAClB,IAAI,OAAO;gBACT,sCAAsC;gBACtC,QAAQ,KAAK,CAAC,sCAAsC;YACtD;YACA,OAAO;QACT;QACA,OAAO,UAAU;IACnB;AACF"}},
    {"offset": {"line": 529, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/getUsersRepo.ts"],"sourcesContent":["import type { UsersRepository } from './usersRepo';\nimport { usersRepo } from './local/usersRepo.local';\nimport { usersRepoSupabase } from './supabase/usersRepo.supabase';\nimport { useSupabase } from '@/lib/supabaseClient';\n\n/** Returns the users repository: Supabase when VITE_USE_SUPABASE=true, otherwise local. */\nexport function getUsersRepo(): UsersRepository {\n  return useSupabase ? usersRepoSupabase : usersRepo;\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAGO,SAAS;IACd,OAAO,qNAAW,GAAG,8PAAiB,GAAG,gPAAS;AACpD"}},
    {"offset": {"line": 546, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/authInstrumentation.ts"],"sourcesContent":["/**\n * Instrumentação de autenticação para debugging e rastreamento de fluxos.\n * Gera trace IDs únicos por tentativa de login e loga eventos estruturados.\n */\n\nexport type AuthEventType =\n  | 'SIGNED_IN'\n  | 'SIGNED_OUT'\n  | 'TOKEN_REFRESHED'\n  | 'PROFILE_LOADING'\n  | 'PROFILE_READY'\n  | 'PROFILE_ERROR'\n  | 'NAVIGATE'\n  | 'SESSION_BEFORE'\n  | 'SESSION_AFTER';\n\nexport type AuthFlowLog = {\n  attemptId: string;\n  timestamp: number;\n  event: AuthEventType;\n  data?: Record<string, any>;\n};\n\nconst LOGS: AuthFlowLog[] = [];\nconst MAX_LOGS = 100;\n\n/**\n * Gera um ID único para rastrear uma tentativa de login/fluxo de auth.\n */\nexport function generateAuthAttemptId(): string {\n  return `auth_${Date.now()}_${Math.random().toString(36).slice(2, 9)}`;\n}\n\n/**\n * Loga um evento de autenticação (DEV only).\n */\nexport function logAuthEvent(\n  attemptId: string,\n  event: AuthEventType,\n  data?: Record<string, any>\n): void {\n  if (process.env.NODE_ENV !== 'development') return;\n\n  const log: AuthFlowLog = {\n    attemptId,\n    timestamp: Date.now(),\n    event,\n    data,\n  };\n\n  LOGS.push(log);\n  if (LOGS.length > MAX_LOGS) {\n    LOGS.shift();\n  }\n\n  // eslint-disable-next-line no-console\n  console.log(`[AUTH_FLOW] ${event}`, {\n    attemptId,\n    ...data,\n  });\n}\n\n/**\n * Retorna os logs recentes (útil para debugging).\n */\nexport function getAuthLogs(): AuthFlowLog[] {\n  return [...LOGS];\n}\n\n/**\n * Limpa os logs (útil para testes).\n */\nexport function clearAuthLogs(): void {\n  LOGS.length = 0;\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;AAoBD,MAAM,OAAsB,EAAE;AAC9B,MAAM,WAAW;AAKV,SAAS;IACd,OAAO,CAAC,KAAK,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,IAAI;AACvE;AAKO,SAAS,aACd,SAAiB,EACjB,KAAoB,EACpB,IAA0B;IAE1B;;IAEA,MAAM,MAAmB;QACvB;QACA,WAAW,KAAK,GAAG;QACnB;QACA;IACF;IAEA,KAAK,IAAI,CAAC;IACV,IAAI,KAAK,MAAM,GAAG,UAAU;QAC1B,KAAK,KAAK;IACZ;IAEA,sCAAsC;IACtC,QAAQ,GAAG,CAAC,CAAC,YAAY,EAAE,OAAO,EAAE;QAClC;QACA,GAAG,IAAI;IACT;AACF;AAKO,SAAS;IACd,OAAO;WAAI;KAAK;AAClB;AAKO,SAAS;IACd,KAAK,MAAM,GAAG;AAChB"}},
    {"offset": {"line": 595, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/components/providers/AuthProvider.tsx"],"sourcesContent":["'use client';\r\n\r\nimport {\r\n    createContext,\r\n    useCallback,\r\n    useContext,\r\n    useEffect,\r\n    useMemo,\r\n    useState,\r\n    useRef,\r\n    type ReactNode,\r\n} from 'react';\r\nimport type { User, AccountType } from '@/types';\r\nimport { storage } from '@/lib/storage';\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport { getUsersRepo } from '@/lib/repositories/getUsersRepo';\r\nimport {\r\n    generateAuthAttemptId,\r\n    logAuthEvent,\r\n    type AuthEventType,\r\n} from '@/lib/authInstrumentation';\r\n\r\nexport type RegisterPayload = {\r\n    full_name: string;\r\n    email: string;\r\n    password: string;\r\n    account_type: AccountType;\r\n    whatsapp: string;\r\n    province: string;\r\n};\r\n\r\nexport type AuthStatus = 'booting' | 'anonymous' | 'authenticating' | 'authenticated';\r\nexport type ProfileStatus = 'idle' | 'loading' | 'ready' | 'error';\r\nexport type RedirectStatus = 'idle' | 'redirecting';\r\n\r\ntype AuthContextValue = {\r\n    user: User | null;\r\n    login: (email: string, password: string) => Promise<User | null>;\r\n    logout: () => Promise<void>;\r\n    register: (payload: RegisterPayload) => Promise<User | null>;\r\n    isPending: boolean;\r\n    isRejected: boolean;\r\n    isBlocked: boolean;\r\n    isAdmin: boolean;\r\n    isApprovedSeller: boolean;\r\n    authStatus: AuthStatus;\r\n    profileStatus: ProfileStatus;\r\n    authError: string | null;\r\n    refreshProfile: () => Promise<void>;\r\n    loginWithGoogle: () => Promise<void>;\r\n    getPostLoginRedirect: (profile?: User) => string;\r\n};\r\n\r\nconst AuthContext = createContext<AuthContextValue | null>(null);\r\n\r\nconst ADMIN_EMAIL = 'sunyldjosesomailamatapa@gmail.com';\r\nconst USE_SUPABASE = process.env.NEXT_PUBLIC_USE_SUPABASE === 'true';\r\n\r\nexport function AuthProvider({ children }: { children: ReactNode }) {\r\n    const [authStatus, setAuthStatus] = useState<AuthStatus>(USE_SUPABASE ? 'booting' : 'anonymous');\r\n    const [profileStatus, setProfileStatus] = useState<ProfileStatus>('idle');\r\n    const [profileUser, setProfileUser] = useState<User | null>(null);\r\n    const [authError, setAuthError] = useState<string | null>(null);\r\n\r\n    const currentAttemptIdRef = useRef<string>(generateAuthAttemptId());\r\n    const repo = getUsersRepo();\r\n    const supabase = useMemo(() => createClient(), []);\r\n\r\n    const lastHandledUserIdRef = useRef<string | null>(null);\r\n    const ensureProfileCacheRef = useRef<Map<string, Promise<User | null>>>(new Map());\r\n    const ensureFailedRef = useRef<Map<string, number>>(new Map());\r\n    const ensureAttemptedRef = useRef<Set<string>>(new Set());\r\n\r\n    // Derived flags\r\n    const user = profileUser;\r\n    const isPending = !!user && ['pending', 'pending_payment', 'pending_review'].includes(user.status);\r\n    const isRejected = user?.status === 'rejected';\r\n    const isBlocked = user?.status === 'blocked';\r\n    const isAdmin = user?.role === 'admin';\r\n    const isApprovedSeller = user?.status === 'approved';\r\n\r\n    const getPostLoginRedirect = useCallback((profile?: User): string => {\r\n        const p = profile ?? profileUser;\r\n        if (!p) return '/';\r\n\r\n        // Admin logic\r\n        if (p.role === 'admin' && p.status === 'approved') return '/admin';\r\n\r\n        // Seller logic\r\n        if (p.status === 'approved') return '/vendedor';\r\n\r\n        // Activation flow for seller\r\n        if (['pending_payment', 'pending_review', 'rejected', 'pending'].includes(p.status)) {\r\n            return '/vendedor/ativacao';\r\n        }\r\n\r\n        return '/ativacao'; // Fallback\r\n    }, [profileUser]);\r\n\r\n    const ensureProfileForSupabaseUser = useCallback(\r\n        async (supabaseUser: { id: string; email?: string | null; user_metadata?: any }): Promise<User | null> => {\r\n            const id = supabaseUser.id;\r\n            const email = (supabaseUser.email ?? '').toLowerCase();\r\n            const isAdminEmail = email === ADMIN_EMAIL;\r\n\r\n            // 1. Check promise cache (prevents concurrent calls)\r\n            const cached = ensureProfileCacheRef.current.get(id);\r\n            if (cached) return cached;\r\n\r\n            // 2. Check cooldown for recent failures\r\n            const failedAt = ensureFailedRef.current.get(id);\r\n            if (failedAt && Date.now() - failedAt < 30_000) {\r\n                setProfileStatus('error');\r\n                return null;\r\n            }\r\n\r\n            const promise = (async () => {\r\n                setProfileStatus('loading');\r\n                console.log('[PROFILE] Checking for userId:', id.slice(0, 8));\r\n\r\n                try {\r\n                    // a) Try client-side SELECT first\r\n                    let profile = await repo.getById(id);\r\n\r\n                    if (profile) {\r\n                        console.log('[PROFILE] Found via client SELECT');\r\n                        if (isAdminEmail && profile.role !== 'admin') {\r\n                            profile = await repo.update(id, { role: 'admin', status: 'approved' });\r\n                        }\r\n                        setProfileStatus('ready');\r\n                        return profile;\r\n                    }\r\n\r\n                    // b) Not found -> Check Circuit Breaker before calling API\r\n                    if (ensureAttemptedRef.current.has(id)) {\r\n                        console.warn('[PROFILE] Circuit breaker active: skipping second ensure attempt');\r\n                        setProfileStatus('error');\r\n                        setAuthError('Perfil não encontrado após tentativa de criação.');\r\n                        return null;\r\n                    }\r\n\r\n                    console.log('[PROFILE] Not found on client. Attempting server-side ensure...');\r\n                    ensureAttemptedRef.current.add(id);\r\n\r\n                    const meta = supabaseUser.user_metadata ?? {};\r\n                    const name = meta.full_name ?? meta.name ?? email ?? 'Utilizador';\r\n\r\n                    // c) Call Server Route Handler using service_role\r\n                    const response = await fetch('/api/profile/ensure', {\r\n                        method: 'POST',\r\n                        headers: { 'Content-Type': 'application/json' },\r\n                        body: JSON.stringify({\r\n                            id,\r\n                            email,\r\n                            full_name: name\r\n                        })\r\n                    });\r\n\r\n                    if (!response.ok) {\r\n                        const errorData = await response.json();\r\n                        throw new Error(errorData.error || 'Falha na resposta do servidor');\r\n                    }\r\n\r\n                    const created = await response.json();\r\n                    console.log('[PROFILE] Successfully ensured via server route handler');\r\n\r\n                    setProfileStatus('ready');\r\n                    return created;\r\n                } catch (err: any) {\r\n                    console.error('[PROFILE] Error in ensureProfile flow:', err);\r\n                    ensureFailedRef.current.set(id, Date.now());\r\n                    setProfileStatus('error');\r\n                    setAuthError(err.message || 'Erro ao carregar ou criar perfil');\r\n                    return null;\r\n                }\r\n            })();\r\n\r\n            ensureProfileCacheRef.current.set(id, promise);\r\n            // Cleanup cache after 10s\r\n            setTimeout(() => ensureProfileCacheRef.current.delete(id), 10000);\r\n            return promise;\r\n        },\r\n        [repo]\r\n    );\r\n\r\n    useEffect(() => {\r\n        if (!USE_SUPABASE) return;\r\n\r\n        let cancelled = false;\r\n\r\n        supabase.auth.getSession().then(async ({ data: { session } }) => {\r\n            if (cancelled) return;\r\n            if (session?.user) {\r\n                setAuthStatus('authenticated');\r\n                const profile = await ensureProfileForSupabaseUser(session.user);\r\n                if (!cancelled) setProfileUser(profile);\r\n            } else {\r\n                setAuthStatus('anonymous');\r\n            }\r\n        });\r\n\r\n        const { data: { subscription } } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n            if (cancelled) return;\r\n\r\n            if (event === 'SIGNED_OUT') {\r\n                setProfileUser(null);\r\n                setAuthStatus('anonymous');\r\n                setProfileStatus('idle');\r\n            } else if (session?.user) {\r\n                setAuthStatus('authenticated');\r\n                if (lastHandledUserIdRef.current !== session.user.id) {\r\n                    lastHandledUserIdRef.current = session.user.id;\r\n                    const profile = await ensureProfileForSupabaseUser(session.user);\r\n                    if (!cancelled) setProfileUser(profile);\r\n                }\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            cancelled = true;\r\n            subscription.unsubscribe();\r\n        };\r\n    }, [supabase, ensureProfileForSupabaseUser]);\r\n\r\n    const login = useCallback(async (email: string, password: string) => {\r\n        setAuthStatus('authenticating');\r\n        const { data, error } = await supabase.auth.signInWithPassword({\r\n            email: email.trim().toLowerCase(),\r\n            password,\r\n        });\r\n        if (error || !data.user) {\r\n            setAuthStatus('anonymous');\r\n            setAuthError(error?.message || 'Login falhou');\r\n            return null;\r\n        }\r\n        const profile = await ensureProfileForSupabaseUser(data.user);\r\n        setProfileUser(profile);\r\n        return profile;\r\n    }, [supabase, ensureProfileForSupabaseUser]);\r\n\r\n    const loginWithGoogle = useCallback(async () => {\r\n        const redirectTo = `${window.location.origin}/auth/callback`;\r\n        await supabase.auth.signInWithOAuth({\r\n            provider: 'google',\r\n            options: {\r\n                redirectTo,\r\n                queryParams: {\r\n                    prompt: 'select_account',\r\n                    access_type: 'offline'\r\n                }\r\n            },\r\n        });\r\n    }, [supabase]);\r\n\r\n    const logout = useCallback(async () => {\r\n        await supabase.auth.signOut();\r\n        setProfileUser(null);\r\n        setAuthStatus('anonymous');\r\n        setProfileStatus('idle');\r\n    }, [supabase]);\r\n\r\n    const register = useCallback(async (payload: RegisterPayload) => {\r\n        const { data, error } = await supabase.auth.signUp({\r\n            email: payload.email,\r\n            password: payload.password,\r\n            options: { data: { full_name: payload.full_name } },\r\n        });\r\n        if (error || !data.user) {\r\n            setAuthError(error?.message || 'Falha no cadastro');\r\n            return null;\r\n        }\r\n\r\n        console.log('[AUTH] Signup success, ensuring profile via server...');\r\n\r\n        // Ensure profile via server route handler (bypass RLS)\r\n        const response = await fetch('/api/profile/ensure', {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({\r\n                id: data.user.id,\r\n                email: payload.email,\r\n                full_name: payload.full_name,\r\n                whatsapp: payload.whatsapp,\r\n                province: payload.province,\r\n                account_type: payload.account_type\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            console.error('[AUTH] Register profile ensure failed:', errorData);\r\n            setAuthStatus('anonymous');\r\n            setAuthError('Utilizador criado, mas falha ao gerar perfil: ' + (errorData.error || 'Erro interno'));\r\n            return null;\r\n        }\r\n\r\n        const profile = await response.json();\r\n        setProfileUser(profile);\r\n        setProfileStatus('ready');\r\n        return profile;\r\n    }, [supabase]);\r\n\r\n    const refreshProfile = useCallback(async () => {\r\n        const { data: { user: sbUser } } = await supabase.auth.getUser();\r\n        if (sbUser) {\r\n            const p = await repo.getById(sbUser.id);\r\n            setProfileUser(p);\r\n        }\r\n    }, [supabase, repo]);\r\n\r\n    const value = useMemo(() => ({\r\n        user,\r\n        login,\r\n        logout,\r\n        register,\r\n        isPending,\r\n        isRejected,\r\n        isBlocked,\r\n        isAdmin,\r\n        isApprovedSeller,\r\n        authStatus,\r\n        profileStatus,\r\n        authError,\r\n        refreshProfile,\r\n        loginWithGoogle,\r\n        getPostLoginRedirect,\r\n    }), [user, login, logout, register, isPending, isRejected, isBlocked, isAdmin, isApprovedSeller, authStatus, profileStatus, authError, refreshProfile, loginWithGoogle, getPostLoginRedirect]);\r\n\r\n    return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;\r\n}\r\n\r\nexport function useAuth() {\r\n    const ctx = useContext(AuthContext);\r\n    if (!ctx) throw new Error('useAuth must be used within AuthProvider');\r\n    return ctx;\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 917, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/constants.ts"],"sourcesContent":["/**\n * Constantes do CeluPublic.\n */\n\nexport const APP_NAME = 'CeluPublic';\n\nexport const CONTACT_INFO = {\n  WHATSAPP: '+258 87 833 0517',\n  WHATSAPP_RAW: '258878330517',\n  EMAIL: 'celupublic@gmail.com',\n  SUPPORT_SEC: 'celupublic@gmail.com',\n} as const;\n\nexport const LIMITS = {\n  MAX_PRODUCTS: 10,\n  MAX_SERVICES: 5,\n  MAX_AD_IMAGES: 5,\n  ACTIVATION_FEE_MT: 20,\n} as const;\n\n/** Províncias de Moçambique (para select no cadastro) */\nexport const PROVINCIAS_MOCAMBIQUE = [\n  'Cabo Delgado',\n  'Gaza',\n  'Inhambane',\n  'Manica',\n  'Maputo',\n  'Maputo Cidade',\n  'Nampula',\n  'Niassa',\n  'Sofala',\n  'Tete',\n  'Zambézia',\n] as const;\n\n/** Cidades por província (para select no anúncio). Province -> cities. */\nexport const CIDADES_POR_PROVINCIA: Record<string, string[]> = {\n  'Cabo Delgado': ['Pemba', 'Montepuez', 'Mocímboa da Praia', 'Chinde'],\n  'Gaza': ['Xai-Xai', 'Chókwè', 'Macia', 'Chibuto'],\n  'Inhambane': ['Inhambane', 'Maxixe', 'Vilanculos', 'Massinga'],\n  'Manica': ['Chimoio', 'Manica', 'Gondola', 'Sussundenga'],\n  'Maputo': ['Matola', 'Boane', 'Manhiça', 'Marracuene', 'Namaacha'],\n  'Maputo Cidade': ['Maputo', 'KaMavota', 'KaMubukwana', 'KaMaxakeni', 'KaMphumo', 'KaTembe', 'KaNyaka'],\n  'Nampula': ['Nampula', 'Nacala', 'Angoche', 'Monapo', 'Mozambique'],\n  'Niassa': ['Lichinga', 'Cuamba', 'Metangula'],\n  'Sofala': ['Beira', 'Dondo', 'Nhamatanda', 'Chibabava'],\n  'Tete': ['Tete', 'Moatize', 'Angónia', 'Zumbo'],\n  'Zambézia': ['Quelimane', 'Mocuba', 'Gurúè', 'Milange', 'Nicoadala'],\n};\n\nexport const PLACEHOLDER_IMAGE = 'https://placehold.co/600x400/e2e8f0/64748b?text=Sem+imagem';\n"],"names":[],"mappings":"AAAA;;CAEC;;;;;;;;;;;;;;AAEM,MAAM,WAAW;AAEjB,MAAM,eAAe;IAC1B,UAAU;IACV,cAAc;IACd,OAAO;IACP,aAAa;AACf;AAEO,MAAM,SAAS;IACpB,cAAc;IACd,cAAc;IACd,eAAe;IACf,mBAAmB;AACrB;AAGO,MAAM,wBAAwB;IACnC;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAGM,MAAM,wBAAkD;IAC7D,gBAAgB;QAAC;QAAS;QAAa;QAAqB;KAAS;IACrE,QAAQ;QAAC;QAAW;QAAU;QAAS;KAAU;IACjD,aAAa;QAAC;QAAa;QAAU;QAAc;KAAW;IAC9D,UAAU;QAAC;QAAW;QAAU;QAAW;KAAc;IACzD,UAAU;QAAC;QAAU;QAAS;QAAW;QAAc;KAAW;IAClE,iBAAiB;QAAC;QAAU;QAAY;QAAe;QAAc;QAAY;QAAW;KAAU;IACtG,WAAW;QAAC;QAAW;QAAU;QAAW;QAAU;KAAa;IACnE,UAAU;QAAC;QAAY;QAAU;KAAY;IAC7C,UAAU;QAAC;QAAS;QAAS;QAAc;KAAY;IACvD,QAAQ;QAAC;QAAQ;QAAW;QAAW;KAAQ;IAC/C,YAAY;QAAC;QAAa;QAAU;QAAS;QAAW;KAAY;AACtE;AAEO,MAAM,oBAAoB"}},
    {"offset": {"line": 1037, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/cache.ts"],"sourcesContent":["/**\n * Simple in-app cache with TTL. Used for ads list and other data to avoid reprocessing.\n * Invalidate when data is mutated (create/update/delete).\n */\n\nconst CACHE_PREFIX = 'celupublic_cache_';\nconst META_KEY = CACHE_PREFIX + 'meta';\n\ntype Meta = Record<string, { expires: number }>;\n\nfunction getMeta(): Meta {\n  try {\n    const raw = localStorage.getItem(META_KEY);\n    return raw ? JSON.parse(raw) : {};\n  } catch {\n    return {};\n  }\n}\n\nfunction setMeta(meta: Meta) {\n  try {\n    localStorage.setItem(META_KEY, JSON.stringify(meta));\n  } catch {\n    // ignore\n  }\n}\n\n/**\n * Get cached value. Returns null if missing or expired.\n */\nexport function getCache<T>(key: string): T | null {\n  try {\n    const meta = getMeta();\n    const entry = meta[key];\n    if (!entry || Date.now() > entry.expires) return null;\n    const raw = localStorage.getItem(CACHE_PREFIX + key);\n    return raw ? (JSON.parse(raw) as T) : null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Set cache with TTL in milliseconds.\n */\nexport function setCache<T>(key: string, value: T, ttlMs: number): void {\n  try {\n    const meta = getMeta();\n    meta[key] = { expires: Date.now() + ttlMs };\n    setMeta(meta);\n    localStorage.setItem(CACHE_PREFIX + key, JSON.stringify(value));\n  } catch {\n    // ignore\n  }\n}\n\n/**\n * Remove key from cache and storage.\n */\nexport function invalidate(key: string): void {\n  try {\n    const meta = getMeta();\n    delete meta[key];\n    setMeta(meta);\n    localStorage.removeItem(CACHE_PREFIX + key);\n  } catch {\n    // ignore\n  }\n}\n\n/**\n * Invalidate all keys that start with prefix (e.g. \"ads\" invalidates \"ads_list\", \"ads_123\").\n */\nexport function invalidatePrefix(prefix: string): void {\n  try {\n    const meta = getMeta();\n    let changed = false;\n    for (const k of Object.keys(meta)) {\n      if (k.startsWith(prefix)) {\n        delete meta[k];\n        localStorage.removeItem(CACHE_PREFIX + k);\n        changed = true;\n      }\n    }\n    if (changed) setMeta(meta);\n  } catch {\n    // ignore\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;AAAA;;;CAGC,GAED,MAAM,eAAe;AACrB,MAAM,WAAW,eAAe;AAIhC,SAAS;IACP,IAAI;QACF,MAAM,MAAM,aAAa,OAAO,CAAC;QACjC,OAAO,MAAM,KAAK,KAAK,CAAC,OAAO,CAAC;IAClC,EAAE,OAAM;QACN,OAAO,CAAC;IACV;AACF;AAEA,SAAS,QAAQ,IAAU;IACzB,IAAI;QACF,aAAa,OAAO,CAAC,UAAU,KAAK,SAAS,CAAC;IAChD,EAAE,OAAM;IACN,SAAS;IACX;AACF;AAKO,SAAS,SAAY,GAAW;IACrC,IAAI;QACF,MAAM,OAAO;QACb,MAAM,QAAQ,IAAI,CAAC,IAAI;QACvB,IAAI,CAAC,SAAS,KAAK,GAAG,KAAK,MAAM,OAAO,EAAE,OAAO;QACjD,MAAM,MAAM,aAAa,OAAO,CAAC,eAAe;QAChD,OAAO,MAAO,KAAK,KAAK,CAAC,OAAa;IACxC,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAKO,SAAS,SAAY,GAAW,EAAE,KAAQ,EAAE,KAAa;IAC9D,IAAI;QACF,MAAM,OAAO;QACb,IAAI,CAAC,IAAI,GAAG;YAAE,SAAS,KAAK,GAAG,KAAK;QAAM;QAC1C,QAAQ;QACR,aAAa,OAAO,CAAC,eAAe,KAAK,KAAK,SAAS,CAAC;IAC1D,EAAE,OAAM;IACN,SAAS;IACX;AACF;AAKO,SAAS,WAAW,GAAW;IACpC,IAAI;QACF,MAAM,OAAO;QACb,OAAO,IAAI,CAAC,IAAI;QAChB,QAAQ;QACR,aAAa,UAAU,CAAC,eAAe;IACzC,EAAE,OAAM;IACN,SAAS;IACX;AACF;AAKO,SAAS,iBAAiB,MAAc;IAC7C,IAAI;QACF,MAAM,OAAO;QACb,IAAI,UAAU;QACd,KAAK,MAAM,KAAK,OAAO,IAAI,CAAC,MAAO;YACjC,IAAI,EAAE,UAAU,CAAC,SAAS;gBACxB,OAAO,IAAI,CAAC,EAAE;gBACd,aAAa,UAAU,CAAC,eAAe;gBACvC,UAAU;YACZ;QACF;QACA,IAAI,SAAS,QAAQ;IACvB,EAAE,OAAM;IACN,SAAS;IACX;AACF"}},
    {"offset": {"line": 1120, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/selectors/adsSelectors.ts"],"sourcesContent":["/**\n * Public ad selectors: only published ads whose owner has status \"approved\".\n * Use these for Home, AdListing, AdDetail related ads — not for admin or seller dashboard.\n */\n\nimport type { Ad, User } from '@/types';\n\nfunction approvedOwnerIds(users: User[]): Set<string> {\n  const set = new Set<string>();\n  // Safe: guard against undefined/null\n  if (!users || !Array.isArray(users)) return set;\n  for (const u of users) {\n    if (u?.status === 'approved' && u?.id) set.add(u.id);\n  }\n  return set;\n}\n\n/** Public ads: status published + owner approved, sorted by updatedAt desc. */\nexport function getPublicAds(ads: Ad[], users: User[]): Ad[] {\n  // Safe: guard against undefined/null arrays\n  if (!ads || !Array.isArray(ads)) return [];\n  if (!users || !Array.isArray(users)) return [];\n  \n  try {\n    const approved = approvedOwnerIds(users);\n    return ads\n      .filter((a) => a?.status === 'published' && a?.userId && approved.has(a.userId))\n      .sort((a, b) => {\n        const timeA = a?.updatedAt ? new Date(a.updatedAt).getTime() : 0;\n        const timeB = b?.updatedAt ? new Date(b.updatedAt).getTime() : 0;\n        return timeB - timeA;\n      });\n  } catch (err: any) {\n    // eslint-disable-next-line no-console\n    console.error('[SELECTORS] Error in getPublicAds:', err);\n    return [];\n  }\n}\n\n/** Top ranked public ads by likes. */\nexport function getTopRankedPublicAds(ads: Ad[], users: User[], limit = 8): Ad[] {\n  const publicAds = getPublicAds(ads, users);\n  return [...publicAds].sort((a, b) => b.likes - a.likes).slice(0, limit);\n}\n\n/** Public ads in a category. */\nexport function getAdsByCategoryPublic(ads: Ad[], users: User[], categoryId: string): Ad[] {\n  const approved = approvedOwnerIds(users);\n  return ads\n    .filter((a) => a.status === 'published' && approved.has(a.userId) && a.categoryId === categoryId)\n    .sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n}\n\n/** Related public ads (same category or type), excluding given ad. */\nexport function getRelatedPublicAds(ad: Ad, ads: Ad[], users: User[], limit = 4): Ad[] {\n  const approved = approvedOwnerIds(users);\n  return ads\n    .filter(\n      (a) =>\n        a.status === 'published' &&\n        approved.has(a.userId) &&\n        a.id !== ad.id &&\n        (a.categoryId === ad.categoryId || a.type === ad.type)\n    )\n    .sort((a, b) => b.likes - a.likes)\n    .slice(0, limit);\n}\n\n/** Whether the ad's owner is approved (for use in AdDetail: hide ad if not). */\nexport function isAdOwnerApproved(ad: Ad, users: User[]): boolean {\n  const u = users.find((x) => x.id === ad.userId);\n  return u?.status === 'approved';\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;AAID,SAAS,iBAAiB,KAAa;IACrC,MAAM,MAAM,IAAI;IAChB,qCAAqC;IACrC,IAAI,CAAC,SAAS,CAAC,MAAM,OAAO,CAAC,QAAQ,OAAO;IAC5C,KAAK,MAAM,KAAK,MAAO;QACrB,IAAI,GAAG,WAAW,cAAc,GAAG,IAAI,IAAI,GAAG,CAAC,EAAE,EAAE;IACrD;IACA,OAAO;AACT;AAGO,SAAS,aAAa,GAAS,EAAE,KAAa;IACnD,4CAA4C;IAC5C,IAAI,CAAC,OAAO,CAAC,MAAM,OAAO,CAAC,MAAM,OAAO,EAAE;IAC1C,IAAI,CAAC,SAAS,CAAC,MAAM,OAAO,CAAC,QAAQ,OAAO,EAAE;IAE9C,IAAI;QACF,MAAM,WAAW,iBAAiB;QAClC,OAAO,IACJ,MAAM,CAAC,CAAC,IAAM,GAAG,WAAW,eAAe,GAAG,UAAU,SAAS,GAAG,CAAC,EAAE,MAAM,GAC7E,IAAI,CAAC,CAAC,GAAG;YACR,MAAM,QAAQ,GAAG,YAAY,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK;YAC/D,MAAM,QAAQ,GAAG,YAAY,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK;YAC/D,OAAO,QAAQ;QACjB;IACJ,EAAE,OAAO,KAAU;QACjB,sCAAsC;QACtC,QAAQ,KAAK,CAAC,sCAAsC;QACpD,OAAO,EAAE;IACX;AACF;AAGO,SAAS,sBAAsB,GAAS,EAAE,KAAa,EAAE,QAAQ,CAAC;IACvE,MAAM,YAAY,aAAa,KAAK;IACpC,OAAO;WAAI;KAAU,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK,EAAE,KAAK,CAAC,GAAG;AACnE;AAGO,SAAS,uBAAuB,GAAS,EAAE,KAAa,EAAE,UAAkB;IACjF,MAAM,WAAW,iBAAiB;IAClC,OAAO,IACJ,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,eAAe,SAAS,GAAG,CAAC,EAAE,MAAM,KAAK,EAAE,UAAU,KAAK,YACrF,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;AACnF;AAGO,SAAS,oBAAoB,EAAM,EAAE,GAAS,EAAE,KAAa,EAAE,QAAQ,CAAC;IAC7E,MAAM,WAAW,iBAAiB;IAClC,OAAO,IACJ,MAAM,CACL,CAAC,IACC,EAAE,MAAM,KAAK,eACb,SAAS,GAAG,CAAC,EAAE,MAAM,KACrB,EAAE,EAAE,KAAK,GAAG,EAAE,IACd,CAAC,EAAE,UAAU,KAAK,GAAG,UAAU,IAAI,EAAE,IAAI,KAAK,GAAG,IAAI,GAExD,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK,EAChC,KAAK,CAAC,GAAG;AACd;AAGO,SAAS,kBAAkB,EAAM,EAAE,KAAa;IACrD,MAAM,IAAI,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,GAAG,MAAM;IAC9C,OAAO,GAAG,WAAW;AACvB"}},
    {"offset": {"line": 1183, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/local/clicksRepo.local.ts"],"sourcesContent":["/**\n * Local implementation: ad clicks stored in localStorage.\n * TODO Supabase: replace with ad_clicks table (id, ad_id, created_at, type).\n * Suggested index: (created_at), (ad_id, created_at) for stats by ad and by date.\n */\nimport type { AdClick, ClickStats } from '@/types';\nimport type { ClicksRepository } from '../clicksRepo';\nimport { storage } from '@/lib/storage';\nimport { invalidatePrefix } from '@/lib/cache';\n\nconst CACHE_PREFIX_CLICK_STATS = 'clickStats'; // invalidates clickStats:7d:v1 etc.\n\nfunction genId(): string {\n  return typeof crypto !== 'undefined' && crypto.randomUUID\n    ? crypto.randomUUID()\n    : `click-${Date.now()}-${Math.random().toString(36).slice(2, 11)}`;\n}\n\nexport const clicksRepo: ClicksRepository = {\n  async trackWhatsAppClick(adId: string, _userId?: string) {\n    const now = new Date().toISOString();\n    const click: AdClick = {\n      id: genId(),\n      adId,\n      createdAt: now,\n      type: 'whatsapp',\n    };\n    const clicks = storage.getAdClicks();\n    storage.setAdClicks([...clicks, click]);\n    invalidatePrefix(CACHE_PREFIX_CLICK_STATS);\n  },\n\n  async listClicks(filters) {\n    let list = [...storage.getAdClicks()];\n    if (filters?.adId) list = list.filter((c) => c.adId === filters.adId);\n    if (filters?.from) {\n      const fromMs = new Date(filters.from).getTime();\n      list = list.filter((c) => new Date(c.createdAt).getTime() >= fromMs);\n    }\n    if (filters?.to) {\n      const toMs = new Date(filters.to).getTime();\n      list = list.filter((c) => new Date(c.createdAt).getTime() <= toMs);\n    }\n    list.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n    return list;\n  },\n\n  async getStats(filters): Promise<ClickStats> {\n    const list = await this.listClicks({\n      from: filters?.from,\n      to: filters?.to,\n    });\n    const clicksByAdId: Record<string, number> = {};\n    for (const c of list) {\n      clicksByAdId[c.adId] = (clicksByAdId[c.adId] ?? 0) + 1;\n    }\n    const topAds = Object.entries(clicksByAdId)\n      .map(([adId, clicks]) => ({ adId, clicks }))\n      .sort((a, b) => b.clicks - a.clicks);\n    return {\n      totalClicks: list.length,\n      clicksByAdId,\n      topAds,\n    };\n  },\n};\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AAGD;AACA;;;AAEA,MAAM,2BAA2B,cAAc,oCAAoC;AAEnF,SAAS;IACP,OAAO,OAAO,WAAW,eAAe,OAAO,UAAU,GACrD,OAAO,UAAU,KACjB,CAAC,MAAM,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,KAAK,CAAC,GAAG,KAAK;AACtE;AAEO,MAAM,aAA+B;IAC1C,MAAM,oBAAmB,IAAY,EAAE,OAAgB;QACrD,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,QAAiB;YACrB,IAAI;YACJ;YACA,WAAW;YACX,MAAM;QACR;QACA,MAAM,SAAS,0MAAO,CAAC,WAAW;QAClC,0MAAO,CAAC,WAAW,CAAC;eAAI;YAAQ;SAAM;QACtC,IAAA,iNAAgB,EAAC;IACnB;IAEA,MAAM,YAAW,OAAO;QACtB,IAAI,OAAO;eAAI,0MAAO,CAAC,WAAW;SAAG;QACrC,IAAI,SAAS,MAAM,OAAO,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,IAAI,KAAK,QAAQ,IAAI;QACpE,IAAI,SAAS,MAAM;YACjB,MAAM,SAAS,IAAI,KAAK,QAAQ,IAAI,EAAE,OAAO;YAC7C,OAAO,KAAK,MAAM,CAAC,CAAC,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,MAAM;QAC/D;QACA,IAAI,SAAS,IAAI;YACf,MAAM,OAAO,IAAI,KAAK,QAAQ,EAAE,EAAE,OAAO;YACzC,OAAO,KAAK,MAAM,CAAC,CAAC,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,MAAM;QAC/D;QACA,KAAK,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;QACnF,OAAO;IACT;IAEA,MAAM,UAAS,OAAO;QACpB,MAAM,OAAO,MAAM,IAAI,CAAC,UAAU,CAAC;YACjC,MAAM,SAAS;YACf,IAAI,SAAS;QACf;QACA,MAAM,eAAuC,CAAC;QAC9C,KAAK,MAAM,KAAK,KAAM;YACpB,YAAY,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI;QACvD;QACA,MAAM,SAAS,OAAO,OAAO,CAAC,cAC3B,GAAG,CAAC,CAAC,CAAC,MAAM,OAAO,GAAK,CAAC;gBAAE;gBAAM;YAAO,CAAC,GACzC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,MAAM,GAAG,EAAE,MAAM;QACrC,OAAO;YACL,aAAa,KAAK,MAAM;YACxB;YACA;QACF;IACF;AACF"}},
    {"offset": {"line": 1255, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/supabase/clicksRepo.supabase.ts"],"sourcesContent":["import type { ClickStats } from '@/types';\r\nimport type { ClicksRepository, ListClicksFilters, GetStatsFilters } from '../clicksRepo';\r\nimport { getSupabase } from '@/lib/supabaseClient';\r\nimport { toAppError, withTimeout } from '@/lib/errors';\r\n\r\nexport const clicksRepoSupabase: ClicksRepository = {\r\n  async trackWhatsAppClick(adId: string, userId?: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return;\r\n    const { error } = await supabase.from('ad_clicks').insert({\r\n      ad_id: adId,\r\n      user_id: userId ?? null,\r\n      type: 'whatsapp',\r\n    });\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][clicksRepo.trackWhatsAppClick]', error);\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  async listClicks(_filters?: ListClicksFilters) {\r\n    // Not used in Supabase mode for UI; return vazio.\r\n    return [];\r\n  },\r\n\r\n  async getStats(filters?: GetStatsFilters): Promise<ClickStats> {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return { totalClicks: 0, clicksByAdId: {}, topAds: [] };\r\n\r\n    // 1) Primeiro tentamos usar as views agregadas (quando existirem).\r\n    const useWindow = !!(filters?.from || filters?.to);\r\n    const viewTable = useWindow ? 'ad_click_counts_7d' : 'ad_click_counts_all';\r\n\r\n    try {\r\n      const { data, error } = await withTimeout(\r\n        supabase.from(viewTable).select('ad_id, clicks_total, clicks_7d'),\r\n        12_000,\r\n        'Estatísticas de cliques'\r\n      );\r\n\r\n      if (!error && Array.isArray(data)) {\r\n        const clicksByAdId: Record<string, number> = {};\r\n        let total = 0;\r\n\r\n        for (const row of data as any[]) {\r\n          const adId = row.ad_id as string;\r\n          const count = (row.clicks_total ?? row.clicks_7d ?? 0) as number;\r\n          if (!adId) continue;\r\n          clicksByAdId[adId] = count;\r\n          total += count;\r\n        }\r\n\r\n        const topAds = Object.entries(clicksByAdId)\r\n          .map(([adId, clicks]) => ({ adId, clicks }))\r\n          .sort((a, b) => b.clicks - a.clicks);\r\n\r\n        return {\r\n          totalClicks: total,\r\n          clicksByAdId,\r\n          topAds,\r\n        };\r\n      }\r\n\r\n      // Se der erro 400 / view inexistente, fazemos fallback manual.\r\n      if (error) {\r\n        const status = (error as any).status as number | undefined;\r\n        const message = (error as any).message as string | undefined;\r\n        const isViewMissing =\r\n          status === 400 ||\r\n          (message &&\r\n            (message.includes('does not exist') ||\r\n              message.includes('relation \"ad_click_counts_') ||\r\n              message.toLowerCase().includes('view')));\r\n\r\n        if (!isViewMissing) {\r\n          if (process.env.NODE_ENV === 'development') {\r\n            // eslint-disable-next-line no-console\r\n            console.error('[SUPABASE ERROR][clicksRepo.getStats]', error);\r\n          }\r\n          return { totalClicks: 0, clicksByAdId: {}, topAds: [] };\r\n        }\r\n      }\r\n    } catch (err) {\r\n      if (process.env.NODE_ENV === 'development') {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][clicksRepo.getStats view]', err);\r\n      }\r\n      // Em caso de timeout/erro duro, tentamos fallback com tabela base de cliques.\r\n    }\r\n\r\n    // 2) Fallback: agrega manualmente a partir de ad_clicks quando as views não existem.\r\n    try {\r\n      let query = supabase.from('ad_clicks').select('ad_id, created_at');\r\n\r\n      if (filters?.from) {\r\n        query = query.gte('created_at', filters.from);\r\n      }\r\n      if (filters?.to) {\r\n        query = query.lte('created_at', filters.to);\r\n      }\r\n\r\n      const { data, error } = await withTimeout(\r\n        query,\r\n        12_000,\r\n        'Estatísticas de cliques (fallback)'\r\n      );\r\n\r\n      if (error || !Array.isArray(data)) {\r\n        if (error && process.env.NODE_ENV === 'development') {\r\n          // eslint-disable-next-line no-console\r\n          console.error('[SUPABASE ERROR][clicksRepo.getStats fallback]', error);\r\n        }\r\n        return { totalClicks: 0, clicksByAdId: {}, topAds: [] };\r\n      }\r\n\r\n      const clicksByAdId: Record<string, number> = {};\r\n      let total = 0;\r\n\r\n      for (const row of data as any[]) {\r\n        const adId = row.ad_id as string | undefined;\r\n        if (!adId) continue;\r\n\r\n        clicksByAdId[adId] = (clicksByAdId[adId] ?? 0) + 1;\r\n        total += 1;\r\n      }\r\n\r\n      const topAds = Object.entries(clicksByAdId)\r\n        .map(([adId, clicks]) => ({ adId, clicks }))\r\n        .sort((a, b) => b.clicks - a.clicks);\r\n\r\n      return {\r\n        totalClicks: total,\r\n        clicksByAdId,\r\n        topAds,\r\n      };\r\n    } catch (err) {\r\n      const appError = toAppError(err, {\r\n        fallbackMessage: 'Não foi possível carregar estatísticas de cliques.',\r\n      });\r\n      if (process.env.NODE_ENV === 'development') {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][clicksRepo.getStats fallback fatal]', appError);\r\n      }\r\n      return { totalClicks: 0, clicksByAdId: {}, topAds: [] };\r\n    }\r\n  },\r\n};\r\n\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1396, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/getClicksRepo.ts"],"sourcesContent":["import type { ClicksRepository } from './clicksRepo';\r\nimport { clicksRepo } from './local/clicksRepo.local';\r\nimport { clicksRepoSupabase } from './supabase/clicksRepo.supabase';\r\nimport { useSupabase } from '@/lib/supabaseClient';\r\n\r\nexport function getClicksRepo(): ClicksRepository {\r\n  return useSupabase ? clicksRepoSupabase : clicksRepo;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEO,SAAS;IACd,OAAO,qNAAW,GAAG,gQAAkB,GAAG,kPAAU;AACtD"}},
    {"offset": {"line": 1413, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/local/likesRepo.local.ts"],"sourcesContent":["import type { LikesRepository } from '../likesRepo';\r\n\r\nconst PREFIX = 'CELU_LIKES:';\r\n\r\nfunction getKey(userId: string): string {\r\n  return `${PREFIX}${userId}`;\r\n}\r\n\r\nfunction load(userId: string): string[] {\r\n  try {\r\n    const raw = localStorage.getItem(getKey(userId));\r\n    if (!raw) return [];\r\n    const arr = JSON.parse(raw) as string[];\r\n    return Array.isArray(arr) ? arr : [];\r\n  } catch {\r\n    return [];\r\n  }\r\n}\r\n\r\nfunction save(userId: string, ids: string[]) {\r\n  try {\r\n    localStorage.setItem(getKey(userId), JSON.stringify(ids));\r\n  } catch {\r\n    // ignore\r\n  }\r\n}\r\n\r\nexport const likesRepo: LikesRepository = {\r\n  async getUserLikes(userId: string) {\r\n    return load(userId);\r\n  },\r\n\r\n  async toggleLike(adId: string, userId: string) {\r\n    const list = load(userId);\r\n    const idx = list.indexOf(adId);\r\n    if (idx >= 0) {\r\n      list.splice(idx, 1);\r\n      save(userId, list);\r\n      return false;\r\n    }\r\n    list.push(adId);\r\n    save(userId, list);\r\n    return true;\r\n  },\r\n\r\n  async getLikeCounts(_adIds: string[]) {\r\n    // Local mode: contagens vêm do próprio objeto Ad.likes (mantém comportamento atual).\r\n    return {};\r\n  },\r\n};\r\n\r\n"],"names":[],"mappings":";;;;AAEA,MAAM,SAAS;AAEf,SAAS,OAAO,MAAc;IAC5B,OAAO,GAAG,SAAS,QAAQ;AAC7B;AAEA,SAAS,KAAK,MAAc;IAC1B,IAAI;QACF,MAAM,MAAM,aAAa,OAAO,CAAC,OAAO;QACxC,IAAI,CAAC,KAAK,OAAO,EAAE;QACnB,MAAM,MAAM,KAAK,KAAK,CAAC;QACvB,OAAO,MAAM,OAAO,CAAC,OAAO,MAAM,EAAE;IACtC,EAAE,OAAM;QACN,OAAO,EAAE;IACX;AACF;AAEA,SAAS,KAAK,MAAc,EAAE,GAAa;IACzC,IAAI;QACF,aAAa,OAAO,CAAC,OAAO,SAAS,KAAK,SAAS,CAAC;IACtD,EAAE,OAAM;IACN,SAAS;IACX;AACF;AAEO,MAAM,YAA6B;IACxC,MAAM,cAAa,MAAc;QAC/B,OAAO,KAAK;IACd;IAEA,MAAM,YAAW,IAAY,EAAE,MAAc;QAC3C,MAAM,OAAO,KAAK;QAClB,MAAM,MAAM,KAAK,OAAO,CAAC;QACzB,IAAI,OAAO,GAAG;YACZ,KAAK,MAAM,CAAC,KAAK;YACjB,KAAK,QAAQ;YACb,OAAO;QACT;QACA,KAAK,IAAI,CAAC;QACV,KAAK,QAAQ;QACb,OAAO;IACT;IAEA,MAAM,eAAc,MAAgB;QAClC,qFAAqF;QACrF,OAAO,CAAC;IACV;AACF"}},
    {"offset": {"line": 1463, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/supabase/likesRepo.supabase.ts"],"sourcesContent":["import type { LikesRepository } from '../likesRepo';\r\nimport { getSupabase } from '@/lib/supabaseClient';\r\n\r\nexport const likesRepoSupabase: LikesRepository = {\r\n  async getUserLikes(userId: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return [];\r\n    const { data, error } = await supabase\r\n      .from('ad_likes')\r\n      .select('ad_id')\r\n      .eq('user_id', userId);\r\n    if (error || !Array.isArray(data)) {\r\n      if (error) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][likesRepo.getUserLikes]', error);\r\n      }\r\n      return [];\r\n    }\r\n    return (data as { ad_id: string }[]).map((r) => r.ad_id);\r\n  },\r\n\r\n  async toggleLike(adId: string, userId: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return false;\r\n    const { error } = await supabase\r\n      .from('ad_likes')\r\n      .insert({ ad_id: adId, user_id: userId })\r\n      .single();\r\n    if (!error) return true;\r\n    // Duplicate PK -> unlike\r\n    if (error.code === '23505') {\r\n      const { error: delError } = await supabase.from('ad_likes').delete().eq('ad_id', adId).eq('user_id', userId);\r\n      if (delError) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][likesRepo.toggleLike delete]', delError);\r\n        throw delError;\r\n      }\r\n      return false;\r\n    }\r\n    // eslint-disable-next-line no-console\r\n    console.error('[SUPABASE ERROR][likesRepo.toggleLike]', error);\r\n    throw error;\r\n  },\r\n\r\n  async getLikeCounts(adIds: string[]) {\r\n    const supabase = getSupabase();\r\n    if (!supabase || adIds.length === 0) return {};\r\n    const { data, error } = await supabase\r\n      .from('ad_like_counts')\r\n      .select('ad_id, likes_count')\r\n      .in('ad_id', adIds);\r\n    if (error || !Array.isArray(data)) {\r\n      if (error) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][likesRepo.getLikeCounts]', error);\r\n      }\r\n      return {};\r\n    }\r\n    const out: Record<string, number> = {};\r\n    for (const row of data as { ad_id: string; likes_count: number }[]) {\r\n      out[row.ad_id] = Number(row.likes_count) || 0;\r\n    }\r\n    return out;\r\n  },\r\n};\r\n\r\n"],"names":[],"mappings":";;;;AACA;;AAEO,MAAM,oBAAqC;IAChD,MAAM,cAAa,MAAc;QAC/B,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO,EAAE;QACxB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,YACL,MAAM,CAAC,SACP,EAAE,CAAC,WAAW;QACjB,IAAI,SAAS,CAAC,MAAM,OAAO,CAAC,OAAO;YACjC,IAAI,OAAO;gBACT,sCAAsC;gBACtC,QAAQ,KAAK,CAAC,4CAA4C;YAC5D;YACA,OAAO,EAAE;QACX;QACA,OAAO,AAAC,KAA6B,GAAG,CAAC,CAAC,IAAM,EAAE,KAAK;IACzD;IAEA,MAAM,YAAW,IAAY,EAAE,MAAc;QAC3C,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO;QACtB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,YACL,MAAM,CAAC;YAAE,OAAO;YAAM,SAAS;QAAO,GACtC,MAAM;QACT,IAAI,CAAC,OAAO,OAAO;QACnB,yBAAyB;QACzB,IAAI,MAAM,IAAI,KAAK,SAAS;YAC1B,MAAM,EAAE,OAAO,QAAQ,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,YAAY,MAAM,GAAG,EAAE,CAAC,SAAS,MAAM,EAAE,CAAC,WAAW;YACrG,IAAI,UAAU;gBACZ,sCAAsC;gBACtC,QAAQ,KAAK,CAAC,iDAAiD;gBAC/D,MAAM;YACR;YACA,OAAO;QACT;QACA,sCAAsC;QACtC,QAAQ,KAAK,CAAC,0CAA0C;QACxD,MAAM;IACR;IAEA,MAAM,eAAc,KAAe;QACjC,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,YAAY,MAAM,MAAM,KAAK,GAAG,OAAO,CAAC;QAC7C,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,kBACL,MAAM,CAAC,sBACP,EAAE,CAAC,SAAS;QACf,IAAI,SAAS,CAAC,MAAM,OAAO,CAAC,OAAO;YACjC,IAAI,OAAO;gBACT,sCAAsC;gBACtC,QAAQ,KAAK,CAAC,6CAA6C;YAC7D;YACA,OAAO,CAAC;QACV;QACA,MAAM,MAA8B,CAAC;QACrC,KAAK,MAAM,OAAO,KAAkD;YAClE,GAAG,CAAC,IAAI,KAAK,CAAC,GAAG,OAAO,IAAI,WAAW,KAAK;QAC9C;QACA,OAAO;IACT;AACF"}},
    {"offset": {"line": 1527, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/getLikesRepo.ts"],"sourcesContent":["import type { LikesRepository } from './likesRepo';\r\nimport { likesRepo } from './local/likesRepo.local';\r\nimport { likesRepoSupabase } from './supabase/likesRepo.supabase';\r\nimport { useSupabase } from '@/lib/supabaseClient';\r\n\r\nexport function getLikesRepo(): LikesRepository {\r\n  return useSupabase ? likesRepoSupabase : likesRepo;\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEO,SAAS;IACd,OAAO,qNAAW,GAAG,8PAAiB,GAAG,gPAAS;AACpD"}},
    {"offset": {"line": 1544, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/cachedData.ts"],"sourcesContent":["/**\n * Cached computed data: public ads list and click stats (7d).\n * Uses src/lib/cache.ts with TTL; invalidate on ad/user/click mutations.\n */\nimport type { Ad, User } from '@/types';\nimport { getCache, setCache, invalidate } from './cache';\nimport { getPublicAds } from './selectors/adsSelectors';\nimport { getClicksRepo } from './repositories/getClicksRepo';\nimport { getLikesRepo } from './repositories/getLikesRepo';\nimport { useSupabase } from './supabaseClient';\n\nconst PUBLIC_ADS_KEY = 'publicAds:v1';\nconst PUBLIC_ADS_TTL_MS = 60_000; // 60s\n\nconst CLICK_STATS_7D_KEY = 'clickStats:7d:v1';\nconst CLICK_STATS_TTL_MS = 30_000; // 30s\n\nconst LIKE_COUNTS_KEY = 'likeCounts:v1';\nconst LIKE_COUNTS_TTL_MS = 30_000;\n\nexport function getCachedPublicAds(ads: Ad[], users: User[]): Ad[] {\n  const cached = getCache<Ad[]>(PUBLIC_ADS_KEY);\n  if (cached != null) return cached;\n  const result = getPublicAds(ads, users);\n  setCache(PUBLIC_ADS_KEY, result, PUBLIC_ADS_TTL_MS);\n  return result;\n}\n\nexport function invalidatePublicAdsCache(): void {\n  invalidate(PUBLIC_ADS_KEY);\n}\n\nexport async function getCachedClickStatsLast7Days(): Promise<{\n  totalClicks: number;\n  clicksByAdId: Record<string, number>;\n  topAds: { adId: string; clicks: number }[];\n}> {\n  const cached = getCache<{ totalClicks: number; clicksByAdId: Record<string, number>; topAds: { adId: string; clicks: number }[] }>(CLICK_STATS_7D_KEY);\n  if (cached != null) return cached;\n  try {\n    const to = new Date();\n    const from = new Date(to.getTime() - 7 * 24 * 60 * 60 * 1000);\n    const stats = await getClicksRepo().getStats({\n      from: from.toISOString(),\n      to: to.toISOString(),\n    });\n    setCache(CLICK_STATS_7D_KEY, stats, CLICK_STATS_TTL_MS);\n    return stats;\n  } catch (err: any) {\n    // eslint-disable-next-line no-console\n    console.error('[CACHE] Failed to load click stats:', err);\n    // Return empty stats instead of throwing\n    const emptyStats = { totalClicks: 0, clicksByAdId: {}, topAds: [] };\n    setCache(CLICK_STATS_7D_KEY, emptyStats, CLICK_STATS_TTL_MS);\n    return emptyStats;\n  }\n}\n\nexport function invalidateClickStatsCache(): void {\n  invalidate(CLICK_STATS_7D_KEY);\n}\n\nexport async function getCachedLikeCounts(adIds: string[]): Promise<Record<string, number>> {\n  if (!useSupabase) return {};\n  const cached = getCache<Record<string, number>>(LIKE_COUNTS_KEY);\n  if (cached != null) return cached;\n  try {\n    const counts = await getLikesRepo().getLikeCounts(adIds);\n    setCache(LIKE_COUNTS_KEY, counts, LIKE_COUNTS_TTL_MS);\n    return counts;\n  } catch (err: any) {\n    // eslint-disable-next-line no-console\n    console.error('[CACHE] Failed to load like counts:', err);\n    // Return empty map instead of throwing\n    const emptyCounts: Record<string, number> = {};\n    setCache(LIKE_COUNTS_KEY, emptyCounts, LIKE_COUNTS_TTL_MS);\n    return emptyCounts;\n  }\n}\n\nexport function invalidateLikeCountsCache(): void {\n  invalidate(LIKE_COUNTS_KEY);\n}\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;;;;;;;;;;;AAED;AACA;AACA;AACA;AACA;;;;;;AAEA,MAAM,iBAAiB;AACvB,MAAM,oBAAoB,QAAQ,MAAM;AAExC,MAAM,qBAAqB;AAC3B,MAAM,qBAAqB,QAAQ,MAAM;AAEzC,MAAM,kBAAkB;AACxB,MAAM,qBAAqB;AAEpB,SAAS,mBAAmB,GAAS,EAAE,KAAa;IACzD,MAAM,SAAS,IAAA,yMAAQ,EAAO;IAC9B,IAAI,UAAU,MAAM,OAAO;IAC3B,MAAM,SAAS,IAAA,iOAAY,EAAC,KAAK;IACjC,IAAA,yMAAQ,EAAC,gBAAgB,QAAQ;IACjC,OAAO;AACT;AAEO,SAAS;IACd,IAAA,2MAAU,EAAC;AACb;AAEO,eAAe;IAKpB,MAAM,SAAS,IAAA,yMAAQ,EAA4G;IACnI,IAAI,UAAU,MAAM,OAAO;IAC3B,IAAI;QACF,MAAM,KAAK,IAAI;QACf,MAAM,OAAO,IAAI,KAAK,GAAG,OAAO,KAAK,IAAI,KAAK,KAAK,KAAK;QACxD,MAAM,QAAQ,MAAM,IAAA,sOAAa,IAAG,QAAQ,CAAC;YAC3C,MAAM,KAAK,WAAW;YACtB,IAAI,GAAG,WAAW;QACpB;QACA,IAAA,yMAAQ,EAAC,oBAAoB,OAAO;QACpC,OAAO;IACT,EAAE,OAAO,KAAU;QACjB,sCAAsC;QACtC,QAAQ,KAAK,CAAC,uCAAuC;QACrD,yCAAyC;QACzC,MAAM,aAAa;YAAE,aAAa;YAAG,cAAc,CAAC;YAAG,QAAQ,EAAE;QAAC;QAClE,IAAA,yMAAQ,EAAC,oBAAoB,YAAY;QACzC,OAAO;IACT;AACF;AAEO,SAAS;IACd,IAAA,2MAAU,EAAC;AACb;AAEO,eAAe,oBAAoB,KAAe;IACvD,IAAI,CAAC,qNAAW,EAAE,OAAO,CAAC;IAC1B,MAAM,SAAS,IAAA,yMAAQ,EAAyB;IAChD,IAAI,UAAU,MAAM,OAAO;IAC3B,IAAI;QACF,MAAM,SAAS,MAAM,IAAA,oOAAY,IAAG,aAAa,CAAC;QAClD,IAAA,yMAAQ,EAAC,iBAAiB,QAAQ;QAClC,OAAO;IACT,EAAE,OAAO,KAAU;QACjB,sCAAsC;QACtC,QAAQ,KAAK,CAAC,uCAAuC;QACrD,uCAAuC;QACvC,MAAM,cAAsC,CAAC;QAC7C,IAAA,yMAAQ,EAAC,iBAAiB,aAAa;QACvC,OAAO;IACT;AACF;AAEO,SAAS;IACd,IAAA,2MAAU,EAAC;AACb"}},
    {"offset": {"line": 1639, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/local/adsRepo.local.ts"],"sourcesContent":["import type { Ad } from '@/types';\nimport type { AdsRepository } from '../adsRepo';\nimport { storage } from '@/lib/storage';\nimport { invalidatePrefix } from '@/lib/cache';\nimport { AppError, ERROR_CODES } from '@/lib/errors';\nimport { LIMITS } from '@/lib/constants';\n\nconst CACHE_KEY = 'ads_list';\n\nexport const adsRepo: AdsRepository = {\n  async list(filters) {\n    const ads = storage.getAds();\n    let result = [...ads];\n    if (filters?.userId) result = result.filter((a) => a.userId === filters.userId);\n    if (filters?.status !== undefined) result = result.filter((a) => a.status === filters.status);\n    result.sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime());\n    return result;\n  },\n\n  async getById(id: string) {\n    const ads = storage.getAds();\n    return ads.find((a) => a.id === id) ?? null;\n  },\n\n  async create(data, options) {\n    const bypassLimit = options?.bypassLimit === true;\n    if (!bypassLimit && data.userId) {\n      const ads = storage.getAds();\n      const ownerAds = ads.filter((a) => a.userId === data.userId);\n      let countProduct = 0;\n      let countService = 0;\n      for (const a of ownerAds) {\n        if (a.type === 'product') countProduct++;\n        else countService++;\n      }\n      if (data.type === 'product' && countProduct >= LIMITS.MAX_PRODUCTS) {\n        throw new AppError(ERROR_CODES.LIMIT_REACHED, 'Limite de 10 produtos atingido.');\n      }\n      if (data.type === 'service' && countService >= LIMITS.MAX_SERVICES) {\n        throw new AppError(ERROR_CODES.LIMIT_REACHED, 'Limite de 5 serviços atingido.');\n      }\n    }\n    const now = new Date().toISOString();\n    const status = data.status ?? 'published';\n    const ad: Ad = {\n      ...data,\n      status,\n      id: crypto.randomUUID(),\n      createdAt: now,\n      updatedAt: now,\n    };\n    const ads = storage.getAds();\n    storage.setAds([...ads, ad]);\n    invalidatePrefix(CACHE_KEY);\n    return ad;\n  },\n\n  async update(id: string, data) {\n    const ads = storage.getAds();\n    const index = ads.findIndex((a) => a.id === id);\n    if (index === -1) return null;\n    const now = new Date().toISOString();\n    const updated: Ad = { ...ads[index], ...data, updatedAt: now };\n    const next = [...ads];\n    next[index] = updated;\n    storage.setAds(next);\n    invalidatePrefix(CACHE_KEY);\n    return updated;\n  },\n\n  async delete(id: string) {\n    const ads = storage.getAds();\n    const next = ads.filter((a) => a.id !== id);\n    if (next.length === ads.length) return false;\n    storage.setAds(next);\n    invalidatePrefix(CACHE_KEY);\n    return true;\n  },\n};\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;;;;;AAEA,MAAM,YAAY;AAEX,MAAM,UAAyB;IACpC,MAAM,MAAK,OAAO;QAChB,MAAM,MAAM,0MAAO,CAAC,MAAM;QAC1B,IAAI,SAAS;eAAI;SAAI;QACrB,IAAI,SAAS,QAAQ,SAAS,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,QAAQ,MAAM;QAC9E,IAAI,SAAS,WAAW,WAAW,SAAS,OAAO,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,QAAQ,MAAM;QAC5F,OAAO,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO,KAAK,IAAI,KAAK,EAAE,SAAS,EAAE,OAAO;QACrF,OAAO;IACT;IAEA,MAAM,SAAQ,EAAU;QACtB,MAAM,MAAM,0MAAO,CAAC,MAAM;QAC1B,OAAO,IAAI,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,OAAO;IACzC;IAEA,MAAM,QAAO,IAAI,EAAE,OAAO;QACxB,MAAM,cAAc,SAAS,gBAAgB;QAC7C,IAAI,CAAC,eAAe,KAAK,MAAM,EAAE;YAC/B,MAAM,MAAM,0MAAO,CAAC,MAAM;YAC1B,MAAM,WAAW,IAAI,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,KAAK,KAAK,MAAM;YAC3D,IAAI,eAAe;YACnB,IAAI,eAAe;YACnB,KAAK,MAAM,KAAK,SAAU;gBACxB,IAAI,EAAE,IAAI,KAAK,WAAW;qBACrB;YACP;YACA,IAAI,KAAK,IAAI,KAAK,aAAa,gBAAgB,2MAAM,CAAC,YAAY,EAAE;gBAClE,MAAM,IAAI,0MAAQ,CAAC,6MAAW,CAAC,aAAa,EAAE;YAChD;YACA,IAAI,KAAK,IAAI,KAAK,aAAa,gBAAgB,2MAAM,CAAC,YAAY,EAAE;gBAClE,MAAM,IAAI,0MAAQ,CAAC,6MAAW,CAAC,aAAa,EAAE;YAChD;QACF;QACA,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,SAAS,KAAK,MAAM,IAAI;QAC9B,MAAM,KAAS;YACb,GAAG,IAAI;YACP;YACA,IAAI,OAAO,UAAU;YACrB,WAAW;YACX,WAAW;QACb;QACA,MAAM,MAAM,0MAAO,CAAC,MAAM;QAC1B,0MAAO,CAAC,MAAM,CAAC;eAAI;YAAK;SAAG;QAC3B,IAAA,iNAAgB,EAAC;QACjB,OAAO;IACT;IAEA,MAAM,QAAO,EAAU,EAAE,IAAI;QAC3B,MAAM,MAAM,0MAAO,CAAC,MAAM;QAC1B,MAAM,QAAQ,IAAI,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAC5C,IAAI,UAAU,CAAC,GAAG,OAAO;QACzB,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,UAAc;YAAE,GAAG,GAAG,CAAC,MAAM;YAAE,GAAG,IAAI;YAAE,WAAW;QAAI;QAC7D,MAAM,OAAO;eAAI;SAAI;QACrB,IAAI,CAAC,MAAM,GAAG;QACd,0MAAO,CAAC,MAAM,CAAC;QACf,IAAA,iNAAgB,EAAC;QACjB,OAAO;IACT;IAEA,MAAM,QAAO,EAAU;QACrB,MAAM,MAAM,0MAAO,CAAC,MAAM;QAC1B,MAAM,OAAO,IAAI,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QACxC,IAAI,KAAK,MAAM,KAAK,IAAI,MAAM,EAAE,OAAO;QACvC,0MAAO,CAAC,MAAM,CAAC;QACf,IAAA,iNAAgB,EAAC;QACjB,OAAO;IACT;AACF"}},
    {"offset": {"line": 1733, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/storageHelpers.ts"],"sourcesContent":["/**\n * Storage helpers: normalize paths, generate URLs (public or signed).\n * CRITICAL RULES:\n * - Never construct URLs manually by concatenating strings.\n * - Always use Supabase API: getPublicUrl() or createSignedUrl().\n * - DB stores ONLY paths (never full URLs).\n * - UI resolves URLs async when needed (signed URLs require async).\n */\n\nimport { getSupabase } from './supabaseClient';\n\n// Build/caching proof stamp (updated when this file changes)\nexport const __STORAGE_HELPERS_VERSION__ = '2026-02-20T00:00:00Z';\n\nconst SIGNED_URL_CACHE = new Map<string, { url: string; expiresAt: number }>();\n\n/**\n * Checks if a value looks like a URL (http/https).\n */\nexport function isProbablyUrl(value: string): boolean {\n  return value.startsWith('http://') || value.startsWith('https://');\n}\n\n/**\n * Normalizes a storage path or URL to a clean path string.\n * \n * Accepts:\n * - Pure path: `banners/x/y.jpg` -> `banners/x/y.jpg`\n * - Public URL: `.../storage/v1/object/public/<bucket>/<path>` -> extracts `<path>`\n * - Wrong URL (no /public/): `.../storage/v1/object/<bucket>/<path>` -> extracts `<path>`\n * \n * Returns: clean path without leading/trailing slashes.\n */\nexport function normalizeStoragePath(input: string, bucket: string): string {\n  if (!input) return '';\n\n  // If it's already a path (no http/https), clean it\n  if (!isProbablyUrl(input)) {\n    return input.replace(/^\\/+|\\/+$/g, ''); // Remove leading/trailing slashes\n  }\n\n  // Extract path from URL\n  // Format: https://<project>.supabase.co/storage/v1/object/public/<bucket>/<path>\n  // Or: https://<project>.supabase.co/storage/v1/object/sign/<bucket>/<path>?...\n  // Or (wrong): https://<project>.supabase.co/storage/v1/object/<bucket>/<path>\n  try {\n    const url = new URL(input);\n    // Match both correct (/public/) and wrong (no /public/) formats\n    let pathMatch = url.pathname.match(new RegExp(`/storage/v1/object/(?:public|sign)/${bucket}/(.+)$`));\n    if (!pathMatch) {\n      // Try wrong format (no /public/)\n      pathMatch = url.pathname.match(new RegExp(`/storage/v1/object/${bucket}/(.+)$`));\n    }\n    if (pathMatch && pathMatch[1]) {\n      return decodeURIComponent(pathMatch[1]);\n    }\n\n    // Fallback: try to find bucket in pathname\n    const bucketIndex = url.pathname.indexOf(`/${bucket}/`);\n    if (bucketIndex !== -1) {\n      const afterBucket = url.pathname.substring(bucketIndex + bucket.length + 1);\n      const queryIndex = afterBucket.indexOf('?');\n      const path = queryIndex !== -1 ? afterBucket.substring(0, queryIndex) : afterBucket;\n      return decodeURIComponent(path);\n    }\n  } catch {\n    // Invalid URL, try manual extraction\n    const bucketIndex = input.indexOf(`/${bucket}/`);\n    if (bucketIndex !== -1) {\n      const afterBucket = input.substring(bucketIndex + bucket.length + 1);\n      const queryIndex = afterBucket.indexOf('?');\n      const path = queryIndex !== -1 ? afterBucket.substring(0, queryIndex) : afterBucket;\n      return decodeURIComponent(path);\n    }\n  }\n\n  // URL but not recognized as a Storage URL for this bucket\n  // Returning '' avoids accidentally treating arbitrary external URLs as Storage paths.\n  return '';\n}\n\n/**\n * Gets a public URL synchronously using Supabase API.\n * Use this ONLY when bucket is public and you need immediate URL (e.g., in render).\n * Never tries signed URL (signed URLs require async).\n */\nexport function getPublicUrl(bucket: string, path: string): string {\n  const supabase = getSupabase();\n  if (!supabase) return '';\n\n  const normalizedPath = normalizeStoragePath(path, bucket);\n  if (!normalizedPath) return '';\n\n  const { data } = supabase.storage.from(bucket).getPublicUrl(normalizedPath);\n  return data?.publicUrl || '';\n}\n\n/**\n * Gets a signed URL asynchronously.\n * Implements cache by key `${bucket}:${path}` with expiration.\n */\nexport async function getSignedUrl(\n  bucket: string,\n  path: string,\n  ttlSeconds = 3600\n): Promise<string> {\n  const supabase = getSupabase();\n  if (!supabase) return '';\n\n  const normalizedPath = normalizeStoragePath(path, bucket);\n  if (!normalizedPath) return '';\n\n  // Check cache\n  const cacheKey = `${bucket}:${normalizedPath}`;\n  const cached = SIGNED_URL_CACHE.get(cacheKey);\n  if (cached && cached.expiresAt > Date.now()) {\n    return cached.url;\n  }\n\n  try {\n    const { data, error } = await supabase.storage\n      .from(bucket)\n      .createSignedUrl(normalizedPath, ttlSeconds);\n\n    if (error) {\n      if (process.env.NODE_ENV === 'development') {\n        // eslint-disable-next-line no-console\n        console.error('[STORAGE] Failed to create signed URL:', {\n          bucket,\n          path: normalizedPath,\n          error: error.message,\n          code: (error as any)?.statusCode,\n          fullError: error,\n        });\n      }\n      return '';\n    }\n\n    if (data?.signedUrl) {\n      // Cache signed URL\n      SIGNED_URL_CACHE.set(cacheKey, {\n        url: data.signedUrl,\n        expiresAt: Date.now() + ttlSeconds * 1000,\n      });\n      return data.signedUrl;\n    }\n  } catch (err) {\n    if (process.env.NODE_ENV === 'development') {\n      // eslint-disable-next-line no-console\n      console.error('[STORAGE] Error creating signed URL:', err);\n    }\n  }\n\n  return '';\n}\n\n/**\n * Resolves storage URL (public or signed) asynchronously.\n * \n * Strategy:\n * - If preferSigned = true: tries signed first, falls back to public.\n * - Otherwise: tries public first, falls back to signed.\n * \n * Returns URL ready for use in <img src=\"...\">.\n */\nexport async function resolveStorageUrl(\n  bucket: string,\n  pathOrUrl: string,\n  options?: { preferSigned?: boolean }\n): Promise<string> {\n  const supabase = getSupabase();\n  if (!supabase) return '';\n\n  // If it's an external URL (not a Supabase Storage URL), keep it as-is.\n  // This keeps placeholders like https://placehold.co/... working.\n  if (\n    isProbablyUrl(pathOrUrl) &&\n    !pathOrUrl.includes('/storage/v1/object/') &&\n    !pathOrUrl.includes(`/${bucket}/`)\n  ) {\n    return pathOrUrl;\n  }\n\n  const normalizedPath = normalizeStoragePath(pathOrUrl, bucket);\n  if (!normalizedPath) return '';\n\n  if (options?.preferSigned) {\n    // Try signed first\n    const signedUrl = await getSignedUrl(bucket, normalizedPath);\n    if (signedUrl) return signedUrl;\n    // Fallback to public\n    return getPublicUrl(bucket, normalizedPath);\n  }\n\n  // Try public first (default for public buckets)\n  const publicUrl = getPublicUrl(bucket, normalizedPath);\n  if (publicUrl) {\n    // For public buckets, public URL should work\n    // But if bucket is private, we'll get 400/403 when loading, so we could test here\n    // For now, return public URL and let UI handle errors\n    return publicUrl;\n  }\n\n  // Fallback to signed\n  return getSignedUrl(bucket, normalizedPath);\n}\n\n/**\n * Clears the signed URL cache.\n */\nexport function clearStorageUrlCache(bucket?: string, path?: string): void {\n  if (bucket && path) {\n    const cacheKey = `${bucket}:${normalizeStoragePath(path, bucket)}`;\n    SIGNED_URL_CACHE.delete(cacheKey);\n  } else {\n    SIGNED_URL_CACHE.clear();\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1896, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/supabase/adsRepo.supabase.ts"],"sourcesContent":["/**\r\n * Supabase implementation: ads + ad_images tables + Storage.\r\n * Requires migrations 20250114000000 (profiles) and 20250214000000 (ads, ad_images).\r\n */\r\nimport type { Ad, AdStatus } from '@/types';\r\nimport type { AdsRepository } from '../adsRepo';\r\nimport { getSupabase } from '@/lib/supabaseClient';\r\nimport { AppError, ERROR_CODES } from '@/lib/errors';\r\nimport { LIMITS } from '@/lib/constants';\r\nimport { normalizeStoragePath, getPublicUrl } from '@/lib/storageHelpers';\r\nimport type { SupabaseClient } from '@supabase/supabase-js';\r\n\r\nconst BUCKET = 'ad-images';\r\n\r\ntype AdsRow = {\r\n  id: string;\r\n  owner_id: string;\r\n  type: string;\r\n  status: string;\r\n  title: string;\r\n  description: string;\r\n  price_mzn: number | null;\r\n  price_note: string | null;\r\n  province: string;\r\n  city: string;\r\n  neighborhood: string | null;\r\n  category: string;\r\n  whatsapp: string;\r\n  created_at: string;\r\n  updated_at: string;\r\n};\r\n\r\nfunction rowToAd(\r\n  row: AdsRow,\r\n  imagePaths: { path: string; sort_order: number }[],\r\n  ownerName?: string\r\n): Ad {\r\n  const sorted = [...imagePaths].sort((a, b) => a.sort_order - b.sort_order);\r\n  // Normalize paths and get URLs (handles both paths and full URLs from DB)\r\n  // Note: We return public URLs here for immediate render, but UI should use useStorageImage hook for async resolution\r\n  const images = sorted.map((i) => {\r\n    const normalizedPath = normalizeStoragePath(i.path, BUCKET);\r\n    return normalizedPath ? getPublicUrl(BUCKET, normalizedPath) : '';\r\n  });\r\n  return {\r\n    id: row.id,\r\n    userId: row.owner_id,\r\n    userName: ownerName,\r\n    type: row.type as 'product' | 'service',\r\n    status: row.status as AdStatus,\r\n    title: row.title,\r\n    description: row.description,\r\n    price: row.price_mzn != null ? Number(row.price_mzn) : null,\r\n    priceOnRequest: row.price_note != null && row.price_note.length > 0,\r\n    location: row.city,\r\n    province: row.province,\r\n    neighborhood: row.neighborhood ?? undefined,\r\n    categoryId: row.category,\r\n    whatsapp: row.whatsapp,\r\n    images,\r\n    likes: 0,\r\n    createdAt: row.created_at,\r\n    updatedAt: row.updated_at,\r\n  };\r\n}\r\n\r\nasync function fetchImagesForAds(supabase: SupabaseClient, adIds: string[]): Promise<Map<string, { path: string; sort_order: number }[]>> {\r\n  if (adIds.length === 0) return new Map();\r\n  try {\r\n    const { data, error } = await supabase\r\n      .from('ad_images')\r\n      .select('ad_id, path, sort_order')\r\n      .in('ad_id', adIds)\r\n      .order('sort_order', { ascending: true });\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][adsRepo.fetchImagesForAds]', error);\r\n      // Don't throw - return empty map to allow app to continue\r\n      return new Map();\r\n    }\r\n    const map = new Map<string, { path: string; sort_order: number }[]>();\r\n    for (const r of (data as { ad_id: string; path: string; sort_order: number }[]) ?? []) {\r\n      const list = map.get(r.ad_id) ?? [];\r\n      list.push({ path: r.path, sort_order: r.sort_order });\r\n      map.set(r.ad_id, list);\r\n    }\r\n    return map;\r\n  } catch (err: any) {\r\n    // eslint-disable-next-line no-console\r\n    console.error('[SUPABASE ERROR][adsRepo.fetchImagesForAds] unexpected error:', err);\r\n    // Return empty map instead of throwing\r\n    return new Map();\r\n  }\r\n}\r\n\r\nexport const adsRepoSupabase: AdsRepository = {\r\n  async list(filters) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return [];\r\n\r\n    let query = supabase\r\n      .from('ads')\r\n      .select('*')\r\n      .order('updated_at', { ascending: false });\r\n\r\n    if (filters?.userId) query = query.eq('owner_id', filters.userId);\r\n    if (filters?.status !== undefined) query = query.eq('status', filters.status);\r\n\r\n    const { data, error } = await query;\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][adsRepo.list]', error);\r\n      // Check for RLS recursion error (42P17) - don't crash\r\n      if (error.code === '42P17' || error.message?.includes('recursion') || error.message?.includes('infinite')) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[DB] RLS recursion detected (42P17) in adsRepo.list - ensure migration 20250216_fix_profiles_rls_NO_RECURSION_HARD.sql is applied');\r\n        return [];\r\n      }\r\n      // Don't throw - return empty array to allow app to continue\r\n      if (error.code === 'PGRST116' || error.message?.includes('policy')) return [];\r\n      // eslint-disable-next-line no-console\r\n      console.warn('[DB] adsRepo.list error (non-fatal):', error.message);\r\n      return [];\r\n    }\r\n\r\n    const rows = (data ?? []) as AdsRow[];\r\n    const adIds = rows.map((r) => r.id);\r\n    const imagesMap = await fetchImagesForAds(supabase, adIds);\r\n\r\n    return rows.map((r) => {\r\n      const images = imagesMap.get(r.id) ?? [];\r\n      return rowToAd(r, images, undefined);\r\n    });\r\n  },\r\n\r\n  async getById(id: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    const { data: adData, error: adError } = await supabase\r\n      .from('ads')\r\n      .select('*')\r\n      .eq('id', id)\r\n      .single();\r\n\r\n    if (adError || !adData) {\r\n      if (adError) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][adsRepo.getById]', adError);\r\n      }\r\n      return null;\r\n    }\r\n\r\n    const { data: imgData, error: imgError } = await supabase\r\n      .from('ad_images')\r\n      .select('path, sort_order')\r\n      .eq('ad_id', id)\r\n      .order('sort_order', { ascending: true });\r\n    if (imgError) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][adsRepo.getById images]', imgError);\r\n      // Don't throw - continue with empty images array\r\n      // eslint-disable-next-line no-console\r\n      console.warn('[DB] adsRepo.getById images error (non-fatal):', imgError.message);\r\n    }\r\n\r\n    const row = adData as AdsRow;\r\n    const images = (imgData ?? []) as { path: string; sort_order: number }[];\r\n    try {\r\n      return rowToAd(row, images, undefined);\r\n    } catch (err: any) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][adsRepo.getById rowToAd]', err);\r\n      return null;\r\n    }\r\n  },\r\n\r\n  async create(data, options) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) throw new AppError(ERROR_CODES.UNAUTHORIZED, 'Supabase not configured');\r\n\r\n    const bypassLimit = options?.bypassLimit === true;\r\n    if (!bypassLimit && data.userId) {\r\n      const { data: existing, error: existingError } = await supabase\r\n        .from('ads')\r\n        .select('id, type')\r\n        .eq('owner_id', data.userId);\r\n      if (existingError) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][adsRepo.create existing]', existingError);\r\n        throw existingError;\r\n      }\r\n      const list = (existing ?? []) as { type: string }[];\r\n      const countProduct = list.filter((r) => r.type === 'product').length;\r\n      const countService = list.filter((r) => r.type === 'service').length;\r\n      if (data.type === 'product' && countProduct >= LIMITS.MAX_PRODUCTS) {\r\n        throw new AppError(ERROR_CODES.LIMIT_REACHED, 'Limite de 10 produtos atingido.');\r\n      }\r\n      if (data.type === 'service' && countService >= LIMITS.MAX_SERVICES) {\r\n        throw new AppError(ERROR_CODES.LIMIT_REACHED, 'Limite de 5 serviços atingido.');\r\n      }\r\n    }\r\n\r\n    const province = data.province ?? '';\r\n    const row = {\r\n      owner_id: data.userId,\r\n      type: data.type,\r\n      status: data.status ?? 'published',\r\n      title: data.title,\r\n      description: data.description,\r\n      price_mzn: data.price != null ? data.price : null,\r\n      price_note: data.priceOnRequest ? 'Sob consulta' : null,\r\n      province,\r\n      city: data.location,\r\n      neighborhood: data.neighborhood ?? null,\r\n      category: data.categoryId,\r\n      whatsapp: data.whatsapp,\r\n    };\r\n\r\n    const { data: inserted, error } = await supabase.from('ads').insert(row).select().single();\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][adsRepo.create]', error);\r\n      throw new AppError(ERROR_CODES.UNAUTHORIZED, error.message);\r\n    }\r\n\r\n    const adRow = inserted as AdsRow;\r\n    return rowToAd(adRow, [], data.userName);\r\n  },\r\n\r\n  async update(id: string, data) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    const updates: Record<string, unknown> = { updated_at: new Date().toISOString() };\r\n    if (data.title != null) updates.title = data.title;\r\n    if (data.description != null) updates.description = data.description;\r\n    if (data.price != null) updates.price_mzn = data.price;\r\n    if (data.price === null) updates.price_mzn = null;\r\n    if (data.priceOnRequest != null) updates.price_note = data.priceOnRequest ? 'Sob consulta' : null;\r\n    if (data.province != null) updates.province = data.province;\r\n    if (data.location != null) updates.city = data.location;\r\n    if (data.neighborhood !== undefined) updates.neighborhood = data.neighborhood || null;\r\n    if (data.categoryId != null) updates.category = data.categoryId;\r\n    if (data.whatsapp != null) updates.whatsapp = data.whatsapp;\r\n    if (data.type != null) updates.type = data.type;\r\n    if (data.status != null) updates.status = data.status;\r\n\r\n    const { data: updated, error } = await supabase\r\n      .from('ads')\r\n      .update(updates)\r\n      .eq('id', id)\r\n      .select()\r\n      .single();\r\n    if (error || !updated) {\r\n      if (error) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][adsRepo.update]', error);\r\n      }\r\n      return null;\r\n    }\r\n    const existing = await this.getById(id);\r\n    return existing;\r\n  },\r\n\r\n  async delete(id: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return false;\r\n\r\n    const { error } = await supabase.from('ads').delete().eq('id', id);\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][adsRepo.delete]', error);\r\n      throw error;\r\n    }\r\n    return true;\r\n  },\r\n};\r\n\r\n/** Insert image rows for an ad (after uploading files to Storage). */\r\nexport async function insertAdImages(\r\n  adId: string,\r\n  paths: { path: string; sort_order: number }[]\r\n): Promise<void> {\r\n  const supabase = getSupabase();\r\n  if (!supabase) return;\r\n  if (paths.length === 0) return;\r\n  // CRITICAL: Normalize all paths before inserting to DB (ensure no URLs)\r\n  const rows = paths.map((p) => {\r\n    const normalizedPath = normalizeStoragePath(p.path, BUCKET);\r\n    if (!normalizedPath) {\r\n      if (process.env.NODE_ENV === 'development') {\r\n        // eslint-disable-next-line no-console\r\n        console.warn('[UPLOAD] Skipping invalid path in insertAdImages:', p.path);\r\n      }\r\n      return null;\r\n    }\r\n    return { ad_id: adId, path: normalizedPath, sort_order: p.sort_order };\r\n  }).filter((r): r is { ad_id: string; path: string; sort_order: number } => r !== null);\r\n\r\n  if (rows.length === 0) return;\r\n\r\n  const { error } = await supabase.from('ad_images').insert(rows);\r\n  if (error) {\r\n    // eslint-disable-next-line no-console\r\n    console.error('[SUPABASE ERROR][adsRepo.insertAdImages]', error);\r\n    throw error;\r\n  }\r\n}\r\n\r\n/** Delete one image row and remove from Storage. */\r\nexport async function deleteAdImage(adId: string, path: string): Promise<void> {\r\n  const supabase = getSupabase();\r\n  if (!supabase) return;\r\n  const normalizedPath = normalizeStoragePath(path, BUCKET);\r\n  if (!normalizedPath) {\r\n    if (process.env.NODE_ENV === 'development') {\r\n      // eslint-disable-next-line no-console\r\n      console.warn('[UPLOAD] Invalid path in deleteAdImage:', path);\r\n    }\r\n    return;\r\n  }\r\n\r\n  // Delete from DB (match by normalized path or original path for compatibility)\r\n  const { error } = await supabase\r\n    .from('ad_images')\r\n    .delete()\r\n    .eq('ad_id', adId)\r\n    .or(`path.eq.${normalizedPath},path.eq.${path}`);\r\n  if (error) {\r\n    // eslint-disable-next-line no-console\r\n    console.error('[SUPABASE ERROR][adsRepo.deleteAdImage rows]', error);\r\n    throw error;\r\n  }\r\n\r\n  // Remove from storage (don't fail if file doesn't exist)\r\n  const { error: storageError } = await supabase.storage.from(BUCKET).remove([normalizedPath]);\r\n  if (storageError && process.env.NODE_ENV === 'development') {\r\n    // eslint-disable-next-line no-console\r\n    console.warn('[UPLOAD] Failed to remove image from storage (non-fatal):', {\r\n      path: normalizedPath,\r\n      error: storageError.message,\r\n    });\r\n    // Don't throw - file might already be deleted\r\n  }\r\n}\r\n\r\n/** Delete all image rows for an ad (and optionally remove objects from Storage). */\r\nexport async function deleteAllAdImages(adId: string): Promise<void> {\r\n  const supabase = getSupabase();\r\n  if (!supabase) return;\r\n  const { data: rows, error } = await supabase.from('ad_images').select('path').eq('ad_id', adId);\r\n  if (error) {\r\n    // eslint-disable-next-line no-console\r\n    console.error('[SUPABASE ERROR][adsRepo.deleteAllAdImages select]', error);\r\n    throw error;\r\n  }\r\n  // Normalize all paths before removing from storage\r\n  const paths = (rows ?? [])\r\n    .map((r: { path: string }) => normalizeStoragePath(r.path, BUCKET))\r\n    .filter((p): p is string => !!p);\r\n\r\n  const { error: delError } = await supabase.from('ad_images').delete().eq('ad_id', adId);\r\n  if (delError) {\r\n    // eslint-disable-next-line no-console\r\n    console.error('[SUPABASE ERROR][adsRepo.deleteAllAdImages delete]', delError);\r\n    throw delError;\r\n  }\r\n\r\n  // Remove from storage (don't fail if files don't exist)\r\n  if (paths.length > 0) {\r\n    const { error: storageError } = await supabase.storage.from(BUCKET).remove(paths);\r\n    if (storageError && process.env.NODE_ENV === 'development') {\r\n      // eslint-disable-next-line no-console\r\n      console.warn('[UPLOAD] Failed to remove some images from storage (non-fatal):', {\r\n        paths,\r\n        error: storageError.message,\r\n      });\r\n      // Don't throw - files might already be deleted\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2221, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/getAdsRepo.ts"],"sourcesContent":["import type { AdsRepository } from './adsRepo';\nimport { adsRepo } from './local/adsRepo.local';\nimport { adsRepoSupabase } from './supabase/adsRepo.supabase';\nimport { useSupabase } from '@/lib/supabaseClient';\n\n/** Returns the ads repository. In modo backend real, usa sempre Supabase. */\nexport function getAdsRepo(): AdsRepository {\n  if (useSupabase) {\n    // eslint-disable-next-line no-console\n    console.log('[REPO] Using Supabase ads repo');\n    return adsRepoSupabase;\n  }\n  return adsRepo;\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAGO,SAAS;IACd,IAAI,qNAAW,EAAE;QACf,sCAAsC;QACtC,QAAQ,GAAG,CAAC;QACZ,OAAO,0PAAe;IACxB;IACA,OAAO,4OAAO;AAChB"}},
    {"offset": {"line": 2243, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/local/categoriesRepo.local.ts"],"sourcesContent":["import type { Category } from '@/types';\nimport type { CategoriesRepository } from '../categoriesRepo';\nimport { storage } from '@/lib/storage';\n\nexport const categoriesRepo: CategoriesRepository = {\n  async list() {\n    return storage.getCategories();\n  },\n\n  async create(data) {\n    const category: Category = {\n      ...data,\n      id: crypto.randomUUID(),\n    };\n    const categories = storage.getCategories();\n    storage.setCategories([...categories, category]);\n    return category;\n  },\n\n  async update(id: string, data) {\n    const categories = storage.getCategories();\n    const index = categories.findIndex((c) => c.id === id);\n    if (index === -1) return null;\n    const updated: Category = { ...categories[index], ...data };\n    const next = [...categories];\n    next[index] = updated;\n    storage.setCategories(next);\n    return updated;\n  },\n\n  async delete(id: string) {\n    const categories = storage.getCategories();\n    const next = categories.filter((c) => c.id !== id);\n    if (next.length === categories.length) return false;\n    storage.setCategories(next);\n    return true;\n  },\n};\n"],"names":[],"mappings":";;;;AAEA;;AAEO,MAAM,iBAAuC;IAClD,MAAM;QACJ,OAAO,0MAAO,CAAC,aAAa;IAC9B;IAEA,MAAM,QAAO,IAAI;QACf,MAAM,WAAqB;YACzB,GAAG,IAAI;YACP,IAAI,OAAO,UAAU;QACvB;QACA,MAAM,aAAa,0MAAO,CAAC,aAAa;QACxC,0MAAO,CAAC,aAAa,CAAC;eAAI;YAAY;SAAS;QAC/C,OAAO;IACT;IAEA,MAAM,QAAO,EAAU,EAAE,IAAI;QAC3B,MAAM,aAAa,0MAAO,CAAC,aAAa;QACxC,MAAM,QAAQ,WAAW,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QACnD,IAAI,UAAU,CAAC,GAAG,OAAO;QACzB,MAAM,UAAoB;YAAE,GAAG,UAAU,CAAC,MAAM;YAAE,GAAG,IAAI;QAAC;QAC1D,MAAM,OAAO;eAAI;SAAW;QAC5B,IAAI,CAAC,MAAM,GAAG;QACd,0MAAO,CAAC,aAAa,CAAC;QACtB,OAAO;IACT;IAEA,MAAM,QAAO,EAAU;QACrB,MAAM,aAAa,0MAAO,CAAC,aAAa;QACxC,MAAM,OAAO,WAAW,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAC/C,IAAI,KAAK,MAAM,KAAK,WAAW,MAAM,EAAE,OAAO;QAC9C,0MAAO,CAAC,aAAa,CAAC;QACtB,OAAO;IACT;AACF"}},
    {"offset": {"line": 2292, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/supabase/categoriesRepo.supabase.ts"],"sourcesContent":["import type { Category } from '@/types';\r\nimport type { CategoriesRepository } from '../categoriesRepo';\r\nimport { getSupabase } from '@/lib/supabaseClient';\r\nimport { AppError, ERROR_CODES } from '@/lib/errors';\r\n\r\ntype CategoryRow = {\r\n  id: string;\r\n  name: string;\r\n  slug: string;\r\n  icon: string | null;\r\n  created_at: string;\r\n};\r\n\r\nfunction rowToCategory(row: CategoryRow): Category {\r\n  return {\r\n    id: row.id,\r\n    name: row.name,\r\n    slug: row.slug,\r\n    icon: row.icon ?? undefined,\r\n  };\r\n}\r\n\r\nexport const categoriesRepoSupabase: CategoriesRepository = {\r\n  async list() {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return [];\r\n\r\n    const { data, error } = await supabase\r\n      .from('categories')\r\n      .select('*')\r\n      .order('name', { ascending: true });\r\n\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][categoriesRepo.list]', error);\r\n      // Check for RLS recursion error (42P17) - don't crash\r\n      if (error.code === '42P17' || error.message?.includes('recursion') || error.message?.includes('infinite')) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[DB] RLS recursion detected (42P17) in categoriesRepo.list - ensure migration 20250216_fix_profiles_rls_NO_RECURSION_HARD.sql is applied');\r\n        return [];\r\n      }\r\n      // Don't throw - return empty array to allow app to continue\r\n      if (error.code === 'PGRST116') return [];\r\n      // eslint-disable-next-line no-console\r\n      console.warn('[DB] categoriesRepo.list error (non-fatal):', error.message);\r\n      return [];\r\n    }\r\n    return (data ?? []).map((r) => rowToCategory(r as CategoryRow));\r\n  },\r\n\r\n  async create(data) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) throw new AppError(ERROR_CODES.UNAUTHORIZED, 'Supabase not configured');\r\n\r\n    const row = {\r\n      name: data.name,\r\n      slug: data.slug,\r\n      icon: data.icon ?? null,\r\n    };\r\n\r\n    const { data: inserted, error } = await supabase.from('categories').insert(row).select().single();\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][categoriesRepo.create]', error);\r\n      throw new AppError(ERROR_CODES.UNAUTHORIZED, error.message);\r\n    }\r\n    return rowToCategory(inserted as CategoryRow);\r\n  },\r\n\r\n  async update(id: string, data) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    const updates: Record<string, unknown> = {};\r\n    if (data.name != null) updates.name = data.name;\r\n    if (data.slug != null) updates.slug = data.slug;\r\n    if (data.icon !== undefined) updates.icon = data.icon ?? null;\r\n\r\n    const { data: updated, error } = await supabase\r\n      .from('categories')\r\n      .update(updates)\r\n      .eq('id', id)\r\n      .select()\r\n      .single();\r\n\r\n    if (error || !updated) {\r\n      if (error) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][categoriesRepo.update]', error);\r\n      }\r\n      return null;\r\n    }\r\n    return rowToCategory(updated as CategoryRow);\r\n  },\r\n\r\n  async delete(id: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return false;\r\n    const { error } = await supabase.from('categories').delete().eq('id', id);\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][categoriesRepo.delete]', error);\r\n      throw error;\r\n    }\r\n    return true;\r\n  },\r\n};\r\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAUA,SAAS,cAAc,GAAgB;IACrC,OAAO;QACL,IAAI,IAAI,EAAE;QACV,MAAM,IAAI,IAAI;QACd,MAAM,IAAI,IAAI;QACd,MAAM,IAAI,IAAI,IAAI;IACpB;AACF;AAEO,MAAM,yBAA+C;IAC1D,MAAM;QACJ,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO,EAAE;QAExB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,cACL,MAAM,CAAC,KACP,KAAK,CAAC,QAAQ;YAAE,WAAW;QAAK;QAEnC,IAAI,OAAO;YACT,sCAAsC;YACtC,QAAQ,KAAK,CAAC,yCAAyC;YACvD,sDAAsD;YACtD,IAAI,MAAM,IAAI,KAAK,WAAW,MAAM,OAAO,EAAE,SAAS,gBAAgB,MAAM,OAAO,EAAE,SAAS,aAAa;gBACzG,sCAAsC;gBACtC,QAAQ,KAAK,CAAC;gBACd,OAAO,EAAE;YACX;YACA,4DAA4D;YAC5D,IAAI,MAAM,IAAI,KAAK,YAAY,OAAO,EAAE;YACxC,sCAAsC;YACtC,QAAQ,IAAI,CAAC,+CAA+C,MAAM,OAAO;YACzE,OAAO,EAAE;QACX;QACA,OAAO,CAAC,QAAQ,EAAE,EAAE,GAAG,CAAC,CAAC,IAAM,cAAc;IAC/C;IAEA,MAAM,QAAO,IAAI;QACf,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,MAAM,IAAI,0MAAQ,CAAC,6MAAW,CAAC,YAAY,EAAE;QAE5D,MAAM,MAAM;YACV,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI;YACf,MAAM,KAAK,IAAI,IAAI;QACrB;QAEA,MAAM,EAAE,MAAM,QAAQ,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,cAAc,MAAM,CAAC,KAAK,MAAM,GAAG,MAAM;QAC/F,IAAI,OAAO;YACT,sCAAsC;YACtC,QAAQ,KAAK,CAAC,2CAA2C;YACzD,MAAM,IAAI,0MAAQ,CAAC,6MAAW,CAAC,YAAY,EAAE,MAAM,OAAO;QAC5D;QACA,OAAO,cAAc;IACvB;IAEA,MAAM,QAAO,EAAU,EAAE,IAAI;QAC3B,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO;QAEtB,MAAM,UAAmC,CAAC;QAC1C,IAAI,KAAK,IAAI,IAAI,MAAM,QAAQ,IAAI,GAAG,KAAK,IAAI;QAC/C,IAAI,KAAK,IAAI,IAAI,MAAM,QAAQ,IAAI,GAAG,KAAK,IAAI;QAC/C,IAAI,KAAK,IAAI,KAAK,WAAW,QAAQ,IAAI,GAAG,KAAK,IAAI,IAAI;QAEzD,MAAM,EAAE,MAAM,OAAO,EAAE,KAAK,EAAE,GAAG,MAAM,SACpC,IAAI,CAAC,cACL,MAAM,CAAC,SACP,EAAE,CAAC,MAAM,IACT,MAAM,GACN,MAAM;QAET,IAAI,SAAS,CAAC,SAAS;YACrB,IAAI,OAAO;gBACT,sCAAsC;gBACtC,QAAQ,KAAK,CAAC,2CAA2C;YAC3D;YACA,OAAO;QACT;QACA,OAAO,cAAc;IACvB;IAEA,MAAM,QAAO,EAAU;QACrB,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO;QACtB,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,cAAc,MAAM,GAAG,EAAE,CAAC,MAAM;QACtE,IAAI,OAAO;YACT,sCAAsC;YACtC,QAAQ,KAAK,CAAC,2CAA2C;YACzD,MAAM;QACR;QACA,OAAO;IACT;AACF"}},
    {"offset": {"line": 2381, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/getCategoriesRepo.ts"],"sourcesContent":["import type { CategoriesRepository } from './categoriesRepo';\nimport { categoriesRepo } from './local/categoriesRepo.local';\nimport { categoriesRepoSupabase } from './supabase/categoriesRepo.supabase';\nimport { useSupabase } from '@/lib/supabaseClient';\n\nexport function getCategoriesRepo(): CategoriesRepository {\n  return useSupabase ? categoriesRepoSupabase : categoriesRepo;\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEO,SAAS;IACd,OAAO,qNAAW,GAAG,wQAAsB,GAAG,0PAAc;AAC9D"}},
    {"offset": {"line": 2398, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/local/bannersRepo.local.ts"],"sourcesContent":["import type { Banner } from '@/types';\nimport type { BannersRepository } from '../bannersRepo';\nimport { storage } from '@/lib/storage';\n\nexport const bannersRepo: BannersRepository = {\n  async listPublic() {\n    return storage.getBanners().filter((b) => b.active).sort((a, b) => a.order - b.order);\n  },\n\n  async listAll() {\n    return storage.getBanners().sort((a, b) => a.order - b.order);\n  },\n\n  async getById(id: string) {\n    return storage.getBanners().find((b) => b.id === id) ?? null;\n  },\n\n  async create(data) {\n    const now = new Date().toISOString();\n    const banner: Banner = {\n      ...data,\n      id: crypto.randomUUID(),\n      createdAt: now,\n    };\n    const banners = storage.getBanners();\n    storage.setBanners([...banners, banner]);\n    return banner;\n  },\n\n  async update(id: string, data) {\n    const banners = storage.getBanners();\n    const index = banners.findIndex((b) => b.id === id);\n    if (index === -1) return null;\n    const updated: Banner = { ...banners[index], ...data };\n    const next = [...banners];\n    next[index] = updated;\n    storage.setBanners(next);\n    return updated;\n  },\n\n  async delete(id: string) {\n    const banners = storage.getBanners();\n    const next = banners.filter((b) => b.id !== id);\n    if (next.length === banners.length) return false;\n    storage.setBanners(next);\n    return true;\n  },\n};\n"],"names":[],"mappings":";;;;AAEA;;AAEO,MAAM,cAAiC;IAC5C,MAAM;QACJ,OAAO,0MAAO,CAAC,UAAU,GAAG,MAAM,CAAC,CAAC,IAAM,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK;IACtF;IAEA,MAAM;QACJ,OAAO,0MAAO,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,KAAK,GAAG,EAAE,KAAK;IAC9D;IAEA,MAAM,SAAQ,EAAU;QACtB,OAAO,0MAAO,CAAC,UAAU,GAAG,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,OAAO;IAC1D;IAEA,MAAM,QAAO,IAAI;QACf,MAAM,MAAM,IAAI,OAAO,WAAW;QAClC,MAAM,SAAiB;YACrB,GAAG,IAAI;YACP,IAAI,OAAO,UAAU;YACrB,WAAW;QACb;QACA,MAAM,UAAU,0MAAO,CAAC,UAAU;QAClC,0MAAO,CAAC,UAAU,CAAC;eAAI;YAAS;SAAO;QACvC,OAAO;IACT;IAEA,MAAM,QAAO,EAAU,EAAE,IAAI;QAC3B,MAAM,UAAU,0MAAO,CAAC,UAAU;QAClC,MAAM,QAAQ,QAAQ,SAAS,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAChD,IAAI,UAAU,CAAC,GAAG,OAAO;QACzB,MAAM,UAAkB;YAAE,GAAG,OAAO,CAAC,MAAM;YAAE,GAAG,IAAI;QAAC;QACrD,MAAM,OAAO;eAAI;SAAQ;QACzB,IAAI,CAAC,MAAM,GAAG;QACd,0MAAO,CAAC,UAAU,CAAC;QACnB,OAAO;IACT;IAEA,MAAM,QAAO,EAAU;QACrB,MAAM,UAAU,0MAAO,CAAC,UAAU;QAClC,MAAM,OAAO,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAC5C,IAAI,KAAK,MAAM,KAAK,QAAQ,MAAM,EAAE,OAAO;QAC3C,0MAAO,CAAC,UAAU,CAAC;QACnB,OAAO;IACT;AACF"}},
    {"offset": {"line": 2455, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/imageCompression.ts"],"sourcesContent":["/**\n * Client-side image compression for ad uploads.\n * Resize max width 1280px, compress quality ~0.8.\n * Returns base64 data URL. Ready to swap for Supabase Storage upload (TODO).\n */\n\nconst MAX_WIDTH = 1280;\nconst QUALITY = 0.8;\n\nexport async function compressImage(file: File): Promise<string> {\n  return new Promise((resolve, reject) => {\n    const img = document.createElement('img');\n    const url = URL.createObjectURL(file);\n    img.onload = () => {\n      URL.revokeObjectURL(url);\n      const canvas = document.createElement('canvas');\n      let { width, height } = img;\n      if (width > MAX_WIDTH) {\n        height = Math.round((height * MAX_WIDTH) / width);\n        width = MAX_WIDTH;\n      }\n      canvas.width = width;\n      canvas.height = height;\n      const ctx = canvas.getContext('2d');\n      if (!ctx) {\n        reject(new Error('Canvas not available'));\n        return;\n      }\n      ctx.drawImage(img, 0, 0, width, height);\n      try {\n        const dataUrl = canvas.toDataURL('image/jpeg', QUALITY);\n        resolve(dataUrl);\n      } catch {\n        reject(new Error('Failed to compress'));\n      }\n    };\n    img.onerror = () => {\n      URL.revokeObjectURL(url);\n      reject(new Error('Failed to load image'));\n    };\n    img.src = url;\n  });\n}\n\n/** Convert a data URL (e.g. from compressImage) to a Blob for upload. */\nexport function dataUrlToBlob(dataUrl: string): Blob {\n  const [header, base64] = dataUrl.split(',');\n  const mime = header?.match(/data:([^;]+)/)?.[1] ?? 'image/jpeg';\n  const bin = atob(base64 ?? '');\n  const arr = new Uint8Array(bin.length);\n  for (let i = 0; i < bin.length; i++) arr[i] = bin.charCodeAt(i);\n  return new Blob([arr], { type: mime });\n}\n"],"names":[],"mappings":";;;;;;AAAA;;;;CAIC,GAED,MAAM,YAAY;AAClB,MAAM,UAAU;AAET,eAAe,cAAc,IAAU;IAC5C,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC3B,MAAM,MAAM,SAAS,aAAa,CAAC;QACnC,MAAM,MAAM,IAAI,eAAe,CAAC;QAChC,IAAI,MAAM,GAAG;YACX,IAAI,eAAe,CAAC;YACpB,MAAM,SAAS,SAAS,aAAa,CAAC;YACtC,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,GAAG;YACxB,IAAI,QAAQ,WAAW;gBACrB,SAAS,KAAK,KAAK,CAAC,AAAC,SAAS,YAAa;gBAC3C,QAAQ;YACV;YACA,OAAO,KAAK,GAAG;YACf,OAAO,MAAM,GAAG;YAChB,MAAM,MAAM,OAAO,UAAU,CAAC;YAC9B,IAAI,CAAC,KAAK;gBACR,OAAO,IAAI,MAAM;gBACjB;YACF;YACA,IAAI,SAAS,CAAC,KAAK,GAAG,GAAG,OAAO;YAChC,IAAI;gBACF,MAAM,UAAU,OAAO,SAAS,CAAC,cAAc;gBAC/C,QAAQ;YACV,EAAE,OAAM;gBACN,OAAO,IAAI,MAAM;YACnB;QACF;QACA,IAAI,OAAO,GAAG;YACZ,IAAI,eAAe,CAAC;YACpB,OAAO,IAAI,MAAM;QACnB;QACA,IAAI,GAAG,GAAG;IACZ;AACF;AAGO,SAAS,cAAc,OAAe;IAC3C,MAAM,CAAC,QAAQ,OAAO,GAAG,QAAQ,KAAK,CAAC;IACvC,MAAM,OAAO,QAAQ,MAAM,iBAAiB,CAAC,EAAE,IAAI;IACnD,MAAM,MAAM,KAAK,UAAU;IAC3B,MAAM,MAAM,IAAI,WAAW,IAAI,MAAM;IACrC,IAAK,IAAI,IAAI,GAAG,IAAI,IAAI,MAAM,EAAE,IAAK,GAAG,CAAC,EAAE,GAAG,IAAI,UAAU,CAAC;IAC7D,OAAO,IAAI,KAAK;QAAC;KAAI,EAAE;QAAE,MAAM;IAAK;AACtC"}},
    {"offset": {"line": 2517, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/supabase/bannersRepo.supabase.ts"],"sourcesContent":["import type { Banner } from '@/types';\r\nimport type { BannersRepository } from '../bannersRepo';\r\nimport { getSupabase } from '@/lib/supabaseClient';\r\nimport { AppError, ERROR_CODES, withTimeout } from '@/lib/errors';\r\nimport { dataUrlToBlob } from '@/lib/imageCompression';\r\nimport { normalizeStoragePath, getPublicUrl } from '@/lib/storageHelpers';\r\n\r\n// ── Helpers de MIME ──────────────────────────────────────────────────────────\r\n\r\n/** Extrai o mime type de um data URL. Ex: 'data:image/png;base64,...' → 'image/png'. */\r\nfunction detectDataUrlMime(dataUrl: string): string {\r\n  const match = dataUrl.match(/^data:([a-z]+\\/[a-z+.-]+);/i);\r\n  return match?.[1]?.toLowerCase() ?? 'image/jpeg';\r\n}\r\n\r\n/** Mapeia mime type para extensão de ficheiro. */\r\nfunction mimeToExt(mime: string): string {\r\n  const map: Record<string, string> = {\r\n    'image/jpeg': 'jpg',\r\n    'image/jpg': 'jpg',\r\n    'image/png': 'png',\r\n    'image/webp': 'webp',\r\n    'image/gif': 'gif',\r\n    'image/svg+xml': 'svg',\r\n  };\r\n  return map[mime] ?? 'jpg';\r\n}\r\n\r\n// Nome único do bucket de banners. Se mudar, alterar aqui e no Supabase.\r\nexport const BANNERS_BUCKET = 'banner-images';\r\n\r\ntype BannerRow = {\r\n  id: string;\r\n  title: string;\r\n  image_path: string;\r\n  link: string | null;\r\n  active: boolean;\r\n  sort_order: number;\r\n  created_at: string;\r\n};\r\n\r\nfunction rowToBanner(row: BannerRow): Banner {\r\n  // Normalize path and get URL (handles both paths and full URLs from DB)\r\n  const normalizedPath = normalizeStoragePath(row.image_path, BANNERS_BUCKET);\r\n  const imageUrl = normalizedPath ? getPublicUrl(BANNERS_BUCKET, normalizedPath) : '';\r\n\r\n  return {\r\n    id: row.id,\r\n    title: row.title,\r\n    imageUrl,\r\n    link: row.link ?? undefined,\r\n    active: row.active,\r\n    order: row.sort_order,\r\n    createdAt: row.created_at,\r\n  };\r\n}\r\n\r\nexport const bannersRepoSupabase: BannersRepository = {\r\n  async listPublic() {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return [];\r\n\r\n    const { data, error } = await supabase\r\n      .from('banners')\r\n      .select('*')\r\n      .eq('active', true)\r\n      .order('sort_order', { ascending: true });\r\n\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][bannersRepo.listPublic]', error);\r\n      return [];\r\n    }\r\n    return (data ?? []).map((r) => rowToBanner(r as BannerRow));\r\n  },\r\n\r\n  async listAll() {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return [];\r\n\r\n    const { data, error } = await supabase\r\n      .from('banners')\r\n      .select('*')\r\n      .order('sort_order', { ascending: true });\r\n\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][bannersRepo.listAll]', error);\r\n      return [];\r\n    }\r\n    return (data ?? []).map((r) => rowToBanner(r as BannerRow));\r\n  },\r\n\r\n  async getById(id: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    const { data, error } = await supabase.from('banners').select('*').eq('id', id).single();\r\n    if (error || !data) {\r\n      if (error) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][bannersRepo.getById]', error);\r\n      }\r\n      return null;\r\n    }\r\n    return rowToBanner(data as BannerRow);\r\n  },\r\n\r\n  async create(data: Omit<Banner, 'id' | 'createdAt'>) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) throw new AppError(ERROR_CODES.UNAUTHORIZED, 'Supabase not configured');\r\n\r\n    const id = crypto.randomUUID();\r\n    let imagePath: string;\r\n\r\n    if (data.imageUrl.startsWith('data:')) {\r\n      const blob = dataUrlToBlob(data.imageUrl);\r\n      // Detectar contentType real do dataUrl para não forçar sempre jpeg\r\n      const contentType = detectDataUrlMime(data.imageUrl);\r\n      const ext = mimeToExt(contentType);\r\n      imagePath = `banners/${id}/${crypto.randomUUID()}.${ext}`;\r\n\r\n      // Verificar se o bucket existe antes de tentar upload.\r\n      const { error: listError } = await withTimeout(\r\n        supabase.storage.from(BANNERS_BUCKET).list('', { limit: 1 }),\r\n        12_000,\r\n        'Verificação do bucket de banners'\r\n      );\r\n      if (listError) {\r\n        const status = (listError as any).status as number | undefined;\r\n        const message = (listError as any).message as string | undefined;\r\n        const isMissing =\r\n          status === 404 ||\r\n          (message &&\r\n            (message.toLowerCase().includes('bucket') &&\r\n              message.toLowerCase().includes('not found')));\r\n\r\n        if (isMissing) {\r\n          throw new AppError(\r\n            ERROR_CODES.STORAGE_BUCKET_MISSING,\r\n            `Bucket '${BANNERS_BUCKET}' não existe no Supabase. Crie o bucket no dashboard ou ajuste o nome na configuração.`,\r\n            listError\r\n          );\r\n        }\r\n      }\r\n\r\n      const { error: uploadError } = await withTimeout(\r\n        supabase.storage\r\n          .from(BANNERS_BUCKET)\r\n          .upload(imagePath, blob, { contentType, upsert: false }),\r\n        12_000,\r\n        'Upload do banner'\r\n      );\r\n      if (uploadError) {\r\n        if (process.env.NODE_ENV === 'development') {\r\n          // eslint-disable-next-line no-console\r\n          console.error('[UPLOAD] Error uploading banner:', {\r\n            bucket: BANNERS_BUCKET,\r\n            path: imagePath,\r\n            size: blob.size,\r\n            contentType: 'image/jpeg',\r\n            error: uploadError.message,\r\n            statusCode: (uploadError as any)?.statusCode ?? (uploadError as any)?.status,\r\n            fullError: uploadError,\r\n          });\r\n        }\r\n        throw new AppError(\r\n          ERROR_CODES.UNAUTHORIZED,\r\n          `Erro ao fazer upload do banner: ${uploadError.message}`,\r\n          uploadError\r\n        );\r\n      }\r\n      if (process.env.NODE_ENV === 'development') {\r\n        // eslint-disable-next-line no-console\r\n        console.log('[UPLOAD] Banner uploaded successfully:', {\r\n          bucket: BANNERS_BUCKET,\r\n          path: imagePath,\r\n          size: blob.size,\r\n          ok: true,\r\n        });\r\n      }\r\n    } else {\r\n      // If it's not a data URL, it might be a full URL or existing path\r\n      // Normalize it to ensure we store only the path\r\n      imagePath = normalizeStoragePath(data.imageUrl, BANNERS_BUCKET);\r\n      if (!imagePath) {\r\n        throw new AppError(\r\n          ERROR_CODES.UNAUTHORIZED,\r\n          'URL ou path de imagem inválido para banner.'\r\n        );\r\n      }\r\n    }\r\n\r\n    const row = {\r\n      id,\r\n      title: data.title ?? '',\r\n      image_path: imagePath,\r\n      link: data.link ?? null,\r\n      active: data.active ?? true,\r\n      sort_order: data.order ?? 0,\r\n    };\r\n\r\n    const { data: inserted, error } = await supabase.from('banners').insert(row).select().single();\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][bannersRepo.create]', error);\r\n      throw new AppError(ERROR_CODES.UNAUTHORIZED, error.message);\r\n    }\r\n\r\n    return rowToBanner(inserted as BannerRow);\r\n  },\r\n\r\n  async update(id: string, data: Partial<Omit<Banner, 'id'>>) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    const existing = await this.getById(id);\r\n    if (!existing) return null;\r\n\r\n    const updates: Record<string, unknown> = {};\r\n    if (data.title != null) updates.title = data.title;\r\n    if (data.link !== undefined) updates.link = data.link ?? null;\r\n    if (data.active != null) updates.active = data.active;\r\n    if (data.order != null) updates.sort_order = data.order;\r\n\r\n    if (data.imageUrl != null) {\r\n      if (data.imageUrl.startsWith('data:')) {\r\n        // New image upload\r\n        const { data: row, error: selectError } = await supabase.from('banners').select('image_path').eq('id', id).single();\r\n        if (selectError) {\r\n          // eslint-disable-next-line no-console\r\n          console.error('[SUPABASE ERROR][bannersRepo.update select image_path]', selectError);\r\n          throw selectError;\r\n        }\r\n        const oldPath = (row as { image_path: string } | null)?.image_path;\r\n        const blob = dataUrlToBlob(data.imageUrl);\r\n        // Detectar contentType real do dataUrl\r\n        const contentType = detectDataUrlMime(data.imageUrl);\r\n        const ext = mimeToExt(contentType);\r\n        const newPath = `banners/${id}/${crypto.randomUUID()}.${ext}`;\r\n\r\n        const { error: uploadError } = await withTimeout(\r\n          supabase.storage\r\n            .from(BANNERS_BUCKET)\r\n            .upload(newPath, blob, { contentType, upsert: false }),\r\n          12_000,\r\n          'Upload do banner'\r\n        );\r\n        if (uploadError) {\r\n          if (process.env.NODE_ENV === 'development') {\r\n            // eslint-disable-next-line no-console\r\n            console.error('[UPLOAD] Error uploading banner:', {\r\n              bucket: BANNERS_BUCKET,\r\n              path: newPath,\r\n              size: blob.size,\r\n              contentType: 'image/jpeg',\r\n              error: uploadError.message,\r\n              statusCode: (uploadError as any)?.statusCode ?? (uploadError as any)?.status,\r\n              fullError: uploadError,\r\n            });\r\n          }\r\n          throw uploadError;\r\n        }\r\n        if (process.env.NODE_ENV === 'development') {\r\n          // eslint-disable-next-line no-console\r\n          console.log('[UPLOAD] Banner uploaded successfully:', {\r\n            bucket: BANNERS_BUCKET,\r\n            path: newPath,\r\n            size: blob.size,\r\n            ok: true,\r\n          });\r\n        }\r\n        updates.image_path = newPath;\r\n\r\n        // Remove old file (don't fail if it doesn't exist)\r\n        if (oldPath) {\r\n          const normalizedOldPath = normalizeStoragePath(oldPath, BANNERS_BUCKET);\r\n          if (normalizedOldPath) {\r\n            const { error: removeError } = await supabase.storage.from(BANNERS_BUCKET).remove([normalizedOldPath]);\r\n            if (removeError && process.env.NODE_ENV === 'development') {\r\n              // eslint-disable-next-line no-console\r\n              console.warn('[UPLOAD] Failed to remove old banner file (non-fatal):', {\r\n                path: normalizedOldPath,\r\n                error: removeError.message,\r\n              });\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        // URL or path provided - normalize to path only\r\n        const normalizedPath = normalizeStoragePath(data.imageUrl, BANNERS_BUCKET);\r\n        if (normalizedPath) {\r\n          updates.image_path = normalizedPath;\r\n        }\r\n      }\r\n    }\r\n\r\n    const { data: updated, error } = await supabase.from('banners').update(updates).eq('id', id).select().single();\r\n    if (error || !updated) {\r\n      if (error) {\r\n        // eslint-disable-next-line no-console\r\n        console.error('[SUPABASE ERROR][bannersRepo.update]', error);\r\n      }\r\n      return null;\r\n    }\r\n    return rowToBanner(updated as BannerRow);\r\n  },\r\n\r\n  async delete(id: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return false;\r\n\r\n    const { data: row, error: selectError } = await supabase.from('banners').select('image_path').eq('id', id).single();\r\n    if (selectError) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][bannersRepo.delete select image_path]', selectError);\r\n      throw selectError;\r\n    }\r\n    const path = (row as { image_path: string } | null)?.image_path;\r\n    const { error: delError } = await supabase.from('banners').delete().eq('id', id);\r\n    if (delError) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][bannersRepo.delete delete]', delError);\r\n      throw delError;\r\n    }\r\n    if (path) {\r\n      const normalizedPath = normalizeStoragePath(path, BANNERS_BUCKET);\r\n      if (normalizedPath) {\r\n        const { error: removeError } = await supabase.storage.from(BANNERS_BUCKET).remove([normalizedPath]);\r\n        if (removeError && process.env.NODE_ENV === 'development') {\r\n          // eslint-disable-next-line no-console\r\n          console.warn('[SUPABASE ERROR][bannersRepo.delete remove] (non-fatal):', {\r\n            path: normalizedPath,\r\n            error: removeError.message,\r\n          });\r\n          // Don't throw - file might already be deleted\r\n        }\r\n      }\r\n    }\r\n    return true;\r\n  },\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2804, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/getBannersRepo.ts"],"sourcesContent":["import type { BannersRepository } from './bannersRepo';\nimport { bannersRepo } from './local/bannersRepo.local';\nimport { bannersRepoSupabase } from './supabase/bannersRepo.supabase';\nimport { useSupabase } from '@/lib/supabaseClient';\n\nexport function getBannersRepo(): BannersRepository {\n  return useSupabase ? bannersRepoSupabase : bannersRepo;\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEO,SAAS;IACd,OAAO,qNAAW,GAAG,kQAAmB,GAAG,oPAAW;AACxD"}},
    {"offset": {"line": 2821, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/local/settingsRepo.local.ts"],"sourcesContent":["import type { SettingsRepository } from '../settingsRepo';\nimport { CONTACT_INFO, LIMITS } from '@/lib/constants';\n\nconst FALLBACK_PUBLIC: Record<string, unknown> = {\n  admin_whatsapp: { number: CONTACT_INFO.WHATSAPP_RAW },\n  activation_fee_mzn: { amount: LIMITS.ACTIVATION_FEE_MT },\n};\n\nexport const settingsRepo: SettingsRepository = {\n  async get(key: string) {\n    return FALLBACK_PUBLIC[key] ?? null;\n  },\n\n  async listPublic() {\n    return { ...FALLBACK_PUBLIC };\n  },\n\n  async update() {\n    // Local mode: no-op; settings are constants\n  },\n};\n"],"names":[],"mappings":";;;;AACA;;AAEA,MAAM,kBAA2C;IAC/C,gBAAgB;QAAE,QAAQ,iNAAY,CAAC,YAAY;IAAC;IACpD,oBAAoB;QAAE,QAAQ,2MAAM,CAAC,iBAAiB;IAAC;AACzD;AAEO,MAAM,eAAmC;IAC9C,MAAM,KAAI,GAAW;QACnB,OAAO,eAAe,CAAC,IAAI,IAAI;IACjC;IAEA,MAAM;QACJ,OAAO;YAAE,GAAG,eAAe;QAAC;IAC9B;IAEA,MAAM;IACJ,4CAA4C;IAC9C;AACF"}},
    {"offset": {"line": 2852, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/supabase/settingsRepo.supabase.ts"],"sourcesContent":["import type { SettingsRepository } from '../settingsRepo';\r\nimport { getSupabase } from '@/lib/supabaseClient';\r\nimport { AppError, ERROR_CODES } from '@/lib/errors';\r\n\r\nconst PUBLIC_KEYS = ['admin_whatsapp', 'activation_fee_mzn', 'support_email'] as const;\r\n\r\nexport const settingsRepoSupabase: SettingsRepository = {\r\n  async get(key: string) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return null;\r\n\r\n    const { data, error } = await supabase\r\n      .from('admin_settings')\r\n      .select('value')\r\n      .eq('key', key)\r\n      .maybeSingle();\r\n\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][settingsRepo.get]', error);\r\n      return null;\r\n    }\r\n    return data?.value ?? null;\r\n  },\r\n\r\n  async listPublic() {\r\n    const supabase = getSupabase();\r\n    if (!supabase) return {};\r\n\r\n    const { data, error } = await supabase\r\n      .from('admin_settings')\r\n      .select('key, value')\r\n      .in('key', [...PUBLIC_KEYS]);\r\n\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][settingsRepo.listPublic]', error);\r\n      return {};\r\n    }\r\n    const out: Record<string, unknown> = {};\r\n    for (const row of data ?? []) {\r\n      const r = row as { key: string; value: unknown };\r\n      out[r.key] = r.value;\r\n    }\r\n    return out;\r\n  },\r\n\r\n  async update(key: string, value: unknown) {\r\n    const supabase = getSupabase();\r\n    if (!supabase) throw new AppError(ERROR_CODES.UNAUTHORIZED, 'Supabase not configured');\r\n\r\n    const { error } = await supabase\r\n      .from('admin_settings')\r\n      .upsert({ key, value, updated_at: new Date().toISOString() }, { onConflict: 'key' });\r\n\r\n    if (error) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('[SUPABASE ERROR][settingsRepo.update]', error);\r\n      throw new AppError(ERROR_CODES.UNAUTHORIZED, error.message);\r\n    }\r\n  },\r\n};\r\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEA,MAAM,cAAc;IAAC;IAAkB;IAAsB;CAAgB;AAEtE,MAAM,uBAA2C;IACtD,MAAM,KAAI,GAAW;QACnB,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO;QAEtB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,kBACL,MAAM,CAAC,SACP,EAAE,CAAC,OAAO,KACV,WAAW;QAEd,IAAI,OAAO;YACT,sCAAsC;YACtC,QAAQ,KAAK,CAAC,sCAAsC;YACpD,OAAO;QACT;QACA,OAAO,MAAM,SAAS;IACxB;IAEA,MAAM;QACJ,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,OAAO,CAAC;QAEvB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,SAC3B,IAAI,CAAC,kBACL,MAAM,CAAC,cACP,EAAE,CAAC,OAAO;eAAI;SAAY;QAE7B,IAAI,OAAO;YACT,sCAAsC;YACtC,QAAQ,KAAK,CAAC,6CAA6C;YAC3D,OAAO,CAAC;QACV;QACA,MAAM,MAA+B,CAAC;QACtC,KAAK,MAAM,OAAO,QAAQ,EAAE,CAAE;YAC5B,MAAM,IAAI;YACV,GAAG,CAAC,EAAE,GAAG,CAAC,GAAG,EAAE,KAAK;QACtB;QACA,OAAO;IACT;IAEA,MAAM,QAAO,GAAW,EAAE,KAAc;QACtC,MAAM,WAAW,IAAA,qNAAW;QAC5B,IAAI,CAAC,UAAU,MAAM,IAAI,0MAAQ,CAAC,6MAAW,CAAC,YAAY,EAAE;QAE5D,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SACrB,IAAI,CAAC,kBACL,MAAM,CAAC;YAAE;YAAK;YAAO,YAAY,IAAI,OAAO,WAAW;QAAG,GAAG;YAAE,YAAY;QAAM;QAEpF,IAAI,OAAO;YACT,sCAAsC;YACtC,QAAQ,KAAK,CAAC,yCAAyC;YACvD,MAAM,IAAI,0MAAQ,CAAC,6MAAW,CAAC,YAAY,EAAE,MAAM,OAAO;QAC5D;IACF;AACF"}},
    {"offset": {"line": 2916, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/repositories/getSettingsRepo.ts"],"sourcesContent":["import type { SettingsRepository } from './settingsRepo';\nimport { settingsRepo } from './local/settingsRepo.local';\nimport { settingsRepoSupabase } from './supabase/settingsRepo.supabase';\nimport { useSupabase } from '@/lib/supabaseClient';\n\nexport function getSettingsRepo(): SettingsRepository {\n  return useSupabase ? settingsRepoSupabase : settingsRepo;\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;;;;AAEO,SAAS;IACd,OAAO,qNAAW,GAAG,oQAAoB,GAAG,sPAAY;AAC1D"}},
    {"offset": {"line": 2933, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/context/AppContext.tsx"],"sourcesContent":["/**\n * Estado global do CeluPublic: ads, categorias, banners, likes.\n * Em modo backend real, tudo vem de Supabase via repositórios.\n */\n\nimport {\n  createContext,\n  useCallback,\n  useContext,\n  useMemo,\n  useState,\n  type ReactNode,\n} from 'react';\nimport type { Ad, Category, Banner, User } from '../types';\nimport { useEffect } from 'react';\nimport { PLACEHOLDER_IMAGE } from '../lib/constants';\nimport { invalidatePublicAdsCache } from '../lib/cachedData';\nimport { getUsersRepo } from '../lib/repositories/getUsersRepo';\nimport { getAdsRepo } from '../lib/repositories/getAdsRepo';\nimport { getLikesRepo } from '../lib/repositories/getLikesRepo';\nimport { getCategoriesRepo } from '../lib/repositories/getCategoriesRepo';\nimport { getBannersRepo } from '../lib/repositories/getBannersRepo';\nimport { getSettingsRepo } from '../lib/repositories/getSettingsRepo';\nimport { useSupabase, getSupabase } from '../lib/supabaseClient';\n\ntype AppState = {\n  ads: Ad[];\n  categories: Category[];\n  banners: Banner[];\n  users: User[];\n  likedIds: Record<string, boolean>;\n  /** Public settings (admin_whatsapp, activation_fee_mzn). From settingsRepo when useSupabase. */\n  publicSettings: Record<string, unknown>;\n  /** Loading states for each data type */\n  loading: {\n    ads: boolean;\n    categories: boolean;\n    banners: boolean;\n    users: boolean;\n    settings: boolean;\n  };\n  /** Error states (non-fatal, app continues rendering) */\n  errors: {\n    ads: string | null;\n    categories: string | null;\n    banners: string | null;\n    users: string | null;\n    settings: string | null;\n  };\n};\n\ntype AppContextValue = AppState & {\n  setAds: (ads: Ad[] | ((prev: Ad[]) => Ad[])) => void;\n  setCategories: (categories: Category[] | ((prev: Category[]) => Category[])) => void;\n  setBanners: (banners: Banner[] | ((prev: Banner[]) => Banner[])) => void;\n  setUsers: (users: User[] | ((prev: User[]) => User[])) => void;\n  refreshUsers: () => void;\n  refreshAds: () => Promise<void>;\n  refreshCategories: () => Promise<void>;\n  refreshBanners: () => Promise<void>;\n  refreshSettings: () => Promise<void>;\n  toggleLike: (adId: string) => void;\n  getAdById: (id: string) => Ad | undefined;\n  getCategoryById: (id: string) => Category | undefined;\n  getAdsByUser: (userId: string) => Ad[];\n  getPublishedAds: () => Ad[];\n  getFeaturedAds: () => Ad[];\n  getTopRankedAds: () => Ad[];\n  getAdsByCategory: (categoryId: string) => Ad[];\n  getRelatedAds: (ad: Ad, limit?: number) => Ad[];\n};\n\nconst defaultState: AppState = {\n  ads: [],\n  categories: [],\n  banners: [],\n  users: [],\n  likedIds: {},\n  publicSettings: {},\n  loading: {\n    ads: false,\n    categories: false,\n    banners: false,\n    users: false,\n    settings: false,\n  },\n  errors: {\n    ads: null,\n    categories: null,\n    banners: null,\n    users: null,\n    settings: null,\n  },\n};\n\nconst AppContext = createContext<AppContextValue | null>(null);\n\nexport function AppProvider({ children }: { children: ReactNode }) {\n  const [ads, setAdsState] = useState<Ad[]>(defaultState.ads);\n  const [categories, setCategoriesState] = useState<Category[]>(defaultState.categories);\n  const [banners, setBannersState] = useState<Banner[]>(defaultState.banners);\n  const [users, setUsersState] = useState<User[]>(defaultState.users);\n  const [likedIds, setLikedIdsState] = useState<Record<string, boolean>>(defaultState.likedIds);\n  const [publicSettings, setPublicSettingsState] = useState<Record<string, unknown>>(defaultState.publicSettings);\n  const [loading, setLoading] = useState(defaultState.loading);\n  const [errors, setErrors] = useState(defaultState.errors);\n\n  const setAds = useCallback((updater: Ad[] | ((prev: Ad[]) => Ad[])) => {\n    setAdsState((prev) => {\n      const next = typeof updater === 'function' ? updater(prev) : updater;\n      invalidatePublicAdsCache();\n      return next;\n    });\n  }, []);\n\n  const setCategories = useCallback((updater: Category[] | ((prev: Category[]) => Category[])) => {\n    setCategoriesState((prev) => {\n      const next = typeof updater === 'function' ? updater(prev) : updater;\n      return next;\n    });\n  }, []);\n\n  const setBanners = useCallback((updater: Banner[] | ((prev: Banner[]) => Banner[])) => {\n    setBannersState((prev) => {\n      const next = typeof updater === 'function' ? updater(prev) : updater;\n      return next;\n    });\n  }, []);\n\n  const setUsers = useCallback((updater: User[] | ((prev: User[]) => User[])) => {\n    setUsersState((prev) => {\n      const next = typeof updater === 'function' ? updater(prev) : updater;\n      invalidatePublicAdsCache();\n      return next;\n    });\n  }, []);\n\n  const refreshUsers = useCallback(async () => {\n    setLoading((prev) => ({ ...prev, users: true }));\n    setErrors((prev) => ({ ...prev, users: null }));\n    try {\n      const list = await getUsersRepo().list();\n      setUsersState(list);\n      setLoading((prev) => ({ ...prev, users: false }));\n      // eslint-disable-next-line no-console\n      console.log('[DB] Loaded users:', list.length);\n    } catch (err: any) {\n      // eslint-disable-next-line no-console\n      console.error('[DB] Failed to load users', err);\n      setLoading((prev) => ({ ...prev, users: false }));\n      // Check for RLS recursion error (42P17) - don't crash the app\n      if (err?.code === '42P17' || err?.message?.includes('recursion') || err?.message?.includes('infinite')) {\n        // eslint-disable-next-line no-console\n        console.error('[DB] RLS recursion detected (42P17) - ensure migration 20250216_fix_profiles_rls_NO_RECURSION_HARD.sql is applied');\n        setErrors((prev) => ({ ...prev, users: 'Erro de configuração do banco de dados. Contacte o suporte.' }));\n      } else {\n        setErrors((prev) => ({ ...prev, users: 'Não foi possível carregar utilizadores.' }));\n      }\n      // Don't throw - allow app to continue rendering\n    }\n  }, []);\n\n  const refreshAds = useCallback(async () => {\n    setLoading((prev) => ({ ...prev, ads: true }));\n    setErrors((prev) => ({ ...prev, ads: null }));\n    try {\n      const list = await getAdsRepo().list();\n      setAdsState(list);\n      invalidatePublicAdsCache();\n      setLoading((prev) => ({ ...prev, ads: false }));\n      // eslint-disable-next-line no-console\n      console.log('[DB] Loaded ads:', list.length);\n    } catch (err: any) {\n      // eslint-disable-next-line no-console\n      console.error('[DB] Failed to load ads', err);\n      setLoading((prev) => ({ ...prev, ads: false }));\n      // Check for RLS recursion error (42P17) - don't crash the app\n      if (err?.code === '42P17' || err?.message?.includes('recursion') || err?.message?.includes('infinite')) {\n        // eslint-disable-next-line no-console\n        console.error('[DB] RLS recursion detected (42P17) - ensure migration 20250216_fix_profiles_rls_NO_RECURSION_HARD.sql is applied');\n        setErrors((prev) => ({ ...prev, ads: 'Erro de configuração do banco de dados. Contacte o suporte.' }));\n      } else {\n        setErrors((prev) => ({ ...prev, ads: 'Não foi possível carregar anúncios.' }));\n      }\n      // Don't throw - allow app to continue rendering\n    }\n  }, []);\n\n  const refreshCategories = useCallback(async () => {\n    setLoading((prev) => ({ ...prev, categories: true }));\n    setErrors((prev) => ({ ...prev, categories: null }));\n    try {\n      const list = await getCategoriesRepo().list();\n      setCategoriesState(list);\n      setLoading((prev) => ({ ...prev, categories: false }));\n    } catch (err: any) {\n      // eslint-disable-next-line no-console\n      console.error('[DB] Failed to load categories', err);\n      setLoading((prev) => ({ ...prev, categories: false }));\n      if (err?.code === '42P17' || err?.message?.includes('recursion') || err?.message?.includes('infinite')) {\n        setErrors((prev) => ({ ...prev, categories: 'Erro de configuração do banco de dados.' }));\n      } else {\n        setErrors((prev) => ({ ...prev, categories: 'Não foi possível carregar categorias.' }));\n      }\n    }\n  }, []);\n\n  const refreshBanners = useCallback(async () => {\n    setLoading((prev) => ({ ...prev, banners: true }));\n    setErrors((prev) => ({ ...prev, banners: null }));\n    try {\n      const list = await getBannersRepo().listPublic();\n      setBannersState(list);\n      setLoading((prev) => ({ ...prev, banners: false }));\n    } catch (err: any) {\n      // eslint-disable-next-line no-console\n      console.error('[DB] Failed to load banners', err);\n      setLoading((prev) => ({ ...prev, banners: false }));\n      setErrors((prev) => ({ ...prev, banners: 'Não foi possível carregar banners.' }));\n    }\n  }, []);\n\n  const refreshSettings = useCallback(async () => {\n    setLoading((prev) => ({ ...prev, settings: true }));\n    setErrors((prev) => ({ ...prev, settings: null }));\n    try {\n      const settings = await getSettingsRepo().listPublic();\n      setPublicSettingsState(settings);\n      setLoading((prev) => ({ ...prev, settings: false }));\n    } catch (err: any) {\n      // eslint-disable-next-line no-console\n      console.error('[DB] Failed to load settings', err);\n      setLoading((prev) => ({ ...prev, settings: false }));\n      setErrors((prev) => ({ ...prev, settings: 'Não foi possível carregar configurações.' }));\n    }\n  }, []);\n\n  // Carregamento inicial de todos os dados a partir dos repositórios (Supabase/local consoante implementação).\n  // SAFE BOOT: Never throw errors, always render with fallback states\n  useEffect(() => {\n    // Public data (categories, banners, settings) can be loaded immediately\n    // These are safe to load without session and should not crash\n    void refreshCategories();\n    void refreshBanners();\n    void refreshSettings();\n\n    // Users and ads: load carefully, but don't wait for auth\n    // If Supabase is enabled, try to load (public data should be accessible via RLS)\n    // If it fails, state will show error but app continues rendering\n    if (useSupabase) {\n      const supabase = getSupabase();\n      if (supabase) {\n        // Try to get session, but don't wait - load data anyway (public data)\n        supabase.auth.getSession().then(() => {\n          // Load users and ads (public data should be accessible)\n          void refreshUsers();\n          void refreshAds();\n        }).catch((err) => {\n          // eslint-disable-next-line no-console\n          console.warn('[DB] getSession failed, loading data anyway:', err);\n          // Still try to load (might be public data accessible without session)\n          void refreshUsers();\n          void refreshAds();\n        });\n      } else {\n        // No supabase client - skip loading (will use empty arrays)\n        // eslint-disable-next-line no-console\n        console.warn('[DB] Supabase client not available, skipping data load');\n      }\n    } else {\n      // Local mode - load everything\n      void refreshUsers();\n      void refreshAds();\n    }\n  }, [refreshUsers, refreshAds, refreshCategories, refreshBanners, refreshSettings, useSupabase]);\n\n  useEffect(() => {\n    if (users.length > 0) {\n      const usersRepo = getUsersRepo();\n      const currentId = usersRepo.getCurrentUserId?.();\n      // Carregamos likes do utilizador autenticado, se houver.\n      if (currentId) {\n        getLikesRepo()\n          .getUserLikes(currentId)\n          .then((ids) => {\n            const map: Record<string, boolean> = {};\n            for (const id of ids) map[id] = true;\n            setLikedIdsState(map);\n          })\n          .catch((err: any) => {\n            // eslint-disable-next-line no-console\n            console.error('[DB] Failed to load user likes', err);\n            // Don't crash - just set empty likes\n            setLikedIdsState({});\n          });\n      } else {\n        setLikedIdsState({});\n      }\n    }\n  }, [useSupabase, users]);\n\n  const toggleLike = useCallback((adId: string) => {\n    const wasLiked = likedIds[adId];\n    setLikedIdsState((prev) => {\n      const next = { ...prev, [adId]: !prev[adId] };\n      return next;\n    });\n    if (!useSupabase) {\n      setAdsState((prev) => {\n        const ad = prev.find((a) => a.id === adId);\n        if (!ad) return prev;\n        const delta = wasLiked ? -1 : 1;\n        const next = prev.map((a) =>\n          a.id === adId ? { ...a, likes: Math.max(0, a.likes + delta) } : a\n        );\n        return next;\n      });\n    }\n  }, [likedIds, useSupabase]);\n\n  const getAdById = useCallback(\n    (id: string) => ads.find((a) => a.id === id),\n    [ads]\n  );\n\n  const getCategoryById = useCallback(\n    (id: string) => categories.find((c) => c.id === id),\n    [categories]\n  );\n\n  const getAdsByUser = useCallback(\n    (userId: string) => ads.filter((a) => a.userId === userId),\n    [ads]\n  );\n\n  const getPublishedAds = useCallback(\n    () => ads.filter((a) => a.status === 'published').sort((a, b) => new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()),\n    [ads]\n  );\n\n  const getFeaturedAds = useCallback(() => {\n    const published = ads.filter((a) => a.status === 'published');\n    return [...published].sort((a, b) => b.likes - a.likes).slice(0, 8);\n  }, [ads]);\n\n  const getTopRankedAds = useCallback(() => {\n    const published = ads.filter((a) => a.status === 'published');\n    return [...published].sort((a, b) => b.likes - a.likes).slice(0, 8);\n  }, [ads]);\n\n  const getAdsByCategory = useCallback(\n    (categoryId: string) =>\n      ads.filter((a) => a.status === 'published' && a.categoryId === categoryId),\n    [ads]\n  );\n\n  const getRelatedAds = useCallback(\n    (ad: Ad, limit = 4) =>\n      ads\n        .filter((a) => a.status === 'published' && a.id !== ad.id && (a.categoryId === ad.categoryId || a.type === ad.type))\n        .sort((a, b) => b.likes - a.likes)\n        .slice(0, limit),\n    [ads]\n  );\n\n  const value = useMemo<AppContextValue>(\n    () => ({\n      ads,\n      categories,\n      banners,\n      users,\n      likedIds,\n      publicSettings,\n      loading,\n      errors,\n      setAds,\n      setCategories,\n      setBanners,\n      setUsers,\n      refreshUsers,\n      refreshAds,\n      refreshCategories,\n      refreshBanners,\n      refreshSettings,\n      toggleLike,\n      getAdById,\n      getCategoryById,\n      getAdsByUser,\n      getPublishedAds,\n      getFeaturedAds,\n      getTopRankedAds,\n      getAdsByCategory,\n      getRelatedAds,\n    }),\n    [\n      ads,\n      categories,\n      banners,\n      users,\n      likedIds,\n      publicSettings,\n      loading,\n      errors,\n      setAds,\n      setCategories,\n      setBanners,\n      setUsers,\n      refreshUsers,\n      refreshAds,\n      refreshCategories,\n      refreshBanners,\n      refreshSettings,\n      toggleLike,\n      getAdById,\n      getCategoryById,\n      getAdsByUser,\n      getPublishedAds,\n      getFeaturedAds,\n      getTopRankedAds,\n      getAdsByCategory,\n      getRelatedAds,\n    ]\n  );\n\n  return <AppContext.Provider value={value}>{children}</AppContext.Provider>;\n}\n\nexport function useApp() {\n  const ctx = useContext(AppContext);\n  if (!ctx) throw new Error('useApp must be used within AppProvider');\n  return ctx;\n}\n\nexport function getAdImage(ad: Ad): string {\n  return ad.images?.[0] || PLACEHOLDER_IMAGE;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3407, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from 'clsx';\nimport { twMerge } from 'tailwind-merge';\n\n/** Combina classes Tailwind com suporte a condicionais (estilo shadcn). */\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,uPAAO,EAAC,IAAA,8NAAI,EAAC;AACtB"}},
    {"offset": {"line": 3422, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/components/ui/button.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Slot } from '@radix-ui/react-slot';\nimport { cva, type VariantProps } from 'class-variance-authority';\nimport { cn } from '@/lib/utils';\n\nconst buttonVariants = cva(\n  'inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0',\n  {\n    variants: {\n      variant: {\n        default: 'bg-primary text-primary-foreground hover:bg-primary/90',\n        destructive: 'bg-destructive text-destructive-foreground hover:bg-destructive/90',\n        outline: 'border border-input bg-background hover:bg-accent hover:text-accent-foreground',\n        secondary: 'bg-secondary text-secondary-foreground hover:bg-secondary/80',\n        ghost: 'hover:bg-accent hover:text-accent-foreground',\n        link: 'text-primary underline-offset-4 hover:underline',\n      },\n      size: {\n        default: 'h-10 px-4 py-2',\n        sm: 'h-9 rounded-md px-3',\n        lg: 'h-11 rounded-md px-8',\n        icon: 'h-10 w-10',\n        'icon-sm': 'h-8 w-8',\n        'icon-lg': 'h-12 w-12',\n      },\n    },\n    defaultVariants: {\n      variant: 'default',\n      size: 'default',\n    },\n  }\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : 'button';\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  }\n);\nButton.displayName = 'Button';\n\nexport { Button, buttonVariants };\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;;;;;;AAEA,MAAM,iBAAiB,IAAA,wPAAG,EACxB,qUACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aAAa;YACb,SAAS;YACT,WAAW;YACX,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;YACN,WAAW;YACX,WAAW;QACb;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,oSAAgB,CAC7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,yPAAI,GAAG;IAC9B,qBACE,+TAAC;QACC,WAAW,IAAA,mMAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 3484, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/components/ui/app-button.tsx"],"sourcesContent":["import * as React from 'react';\nimport { Button } from '@/components/ui/button';\nimport type { ButtonProps } from '@/components/ui/button';\nimport { cn } from '@/lib/utils';\n\n/**\n * App-level button wrapper. Uses shadcn Button internally.\n * Standardizes primary/secondary styles across the app.\n */\nconst variantMap = {\n  primary: 'default',\n  default: 'default',\n  secondary: 'secondary',\n  outline: 'outline',\n  ghost: 'ghost',\n  destructive: 'destructive',\n  link: 'link',\n} as const;\n\nexport type AppButtonVariant = keyof typeof variantMap;\n\nexport interface AppButtonProps extends Omit<ButtonProps, 'variant'> {\n  variant?: AppButtonVariant;\n}\n\nconst AppButton = React.forwardRef<HTMLButtonElement, AppButtonProps>(\n  ({ variant = 'primary', className, ...props }, ref) => (\n    <Button\n      ref={ref}\n      variant={variantMap[variant] as ButtonProps['variant']}\n      className={cn(className)}\n      {...props}\n    />\n  )\n);\nAppButton.displayName = 'AppButton';\n\nexport { AppButton };\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAEA;;;;;AAEA;;;CAGC,GACD,MAAM,aAAa;IACjB,SAAS;IACT,SAAS;IACT,WAAW;IACX,SAAS;IACT,OAAO;IACP,aAAa;IACb,MAAM;AACR;AAQA,MAAM,0BAAY,oSAAgB,CAChC,CAAC,EAAE,UAAU,SAAS,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC7C,+TAAC,sNAAM;QACL,KAAK;QACL,SAAS,UAAU,CAAC,QAAQ;QAC5B,WAAW,IAAA,mMAAE,EAAC;QACb,GAAG,KAAK;;;;;;AAIf,UAAU,WAAW,GAAG"}},
    {"offset": {"line": 3524, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/components/ui/card.tsx"],"sourcesContent":["import * as React from 'react';\nimport { cn } from '@/lib/utils';\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      'rounded-xl border bg-card text-card-foreground shadow-sm',\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = 'Card';\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn('flex flex-col space-y-1.5 p-6', className)}\n    {...props}\n  />\n));\nCardHeader.displayName = 'CardHeader';\n\nconst CardTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h3\n    ref={ref}\n    className={cn('font-semibold leading-none tracking-tight', className)}\n    {...props}\n  />\n));\nCardTitle.displayName = 'CardTitle';\n\nconst CardDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <p\n    ref={ref}\n    className={cn('text-sm text-muted-foreground', className)}\n    {...props}\n  />\n));\nCardDescription.displayName = 'CardDescription';\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn('p-6 pt-0', className)} {...props} />\n));\nCardContent.displayName = 'CardContent';\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn('flex items-center p-6 pt-0', className)}\n    {...props}\n  />\n));\nCardFooter.displayName = 'CardFooter';\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA;AACA;;;;AAEA,MAAM,qBAAO,oSAAgB,CAG3B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,+TAAC;QACC,KAAK;QACL,WAAW,IAAA,mMAAE,EACX,4DACA;QAED,GAAG,KAAK;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,oSAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,+TAAC;QACC,KAAK;QACL,WAAW,IAAA,mMAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,oSAAgB,CAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,+TAAC;QACC,KAAK;QACL,WAAW,IAAA,mMAAE,EAAC,6CAA6C;QAC1D,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,oSAAgB,CAGtC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,+TAAC;QACC,KAAK;QACL,WAAW,IAAA,mMAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,oSAAgB,CAGlC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,+TAAC;QAAI,KAAK;QAAK,WAAW,IAAA,mMAAE,EAAC,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,oSAAgB,CAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,+TAAC;QACC,KAAK;QACL,WAAW,IAAA,mMAAE,EAAC,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG"}},
    {"offset": {"line": 3609, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/context/ToastContext.tsx"],"sourcesContent":["import { createContext, useCallback, useContext, useMemo, useState, type ReactNode } from 'react';\nimport { AppButton } from '@/components/ui/app-button';\nimport { Card, CardContent } from '@/components/ui/card';\n\ntype ToastVariant = 'success' | 'error' | 'info';\n\nexport type ToastOptions = {\n  id?: string;\n  title?: string;\n  description: string;\n  variant?: ToastVariant;\n  actionLabel?: string;\n  onAction?: () => void;\n};\n\ntype ToastState = ToastOptions & { id: string };\n\ntype ToastContextValue = {\n  showToast: (toast: ToastOptions) => void;\n};\n\nconst ToastContext = createContext<ToastContextValue | null>(null);\n\nexport function ToastProvider({ children }: { children: ReactNode }) {\n  const [toasts, setToasts] = useState<ToastState[]>([]);\n\n  const showToast = useCallback((toast: ToastOptions) => {\n    const id = toast.id ?? crypto.randomUUID();\n    const next: ToastState = {\n      ...toast,\n      id,\n      variant: toast.variant ?? 'info',\n    };\n    setToasts((prev) => [...prev, next]);\n    // Auto-dismiss após 5s.\n    setTimeout(() => {\n      setToasts((prev) => prev.filter((t) => t.id !== id));\n    }, 5000);\n  }, []);\n\n  const value = useMemo<ToastContextValue>(\n    () => ({\n      showToast,\n    }),\n    [showToast]\n  );\n\n  return (\n    <ToastContext.Provider value={value}>\n      {children}\n      {/* Container simples no canto inferior direito */}\n      <div className=\"pointer-events-none fixed inset-x-0 bottom-4 z-50 flex justify-end px-4\">\n        <div className=\"flex w-full max-w-sm flex-col gap-2\">\n          {toasts.map((toast) => (\n            <Card\n              key={toast.id}\n              className=\"pointer-events-auto border shadow-lg\"\n              data-variant={toast.variant}\n            >\n              <CardContent className=\"flex flex-col gap-2 py-3\">\n                {toast.title ? (\n                  <p className=\"text-sm font-medium\">\n                    {toast.title}\n                  </p>\n                ) : null}\n                <p className=\"text-sm text-muted-foreground\">{toast.description}</p>\n                {toast.actionLabel && toast.onAction ? (\n                  <div className=\"mt-1\">\n                    <AppButton\n                      size=\"sm\"\n                      variant={toast.variant === 'error' ? 'destructive' : 'outline'}\n                      onClick={toast.onAction}\n                    >\n                      {toast.actionLabel}\n                    </AppButton>\n                  </div>\n                ) : null}\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </ToastContext.Provider>\n  );\n}\n\nexport function useToast() {\n  const ctx = useContext(ToastContext);\n  if (!ctx) throw new Error('useToast must be used within ToastProvider');\n  return ctx;\n}\n\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;;;;;AAmBA,MAAM,6BAAe,IAAA,uSAAa,EAA2B;AAEtD,SAAS,cAAc,EAAE,QAAQ,EAA2B;IACjE,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,kSAAQ,EAAe,EAAE;IAErD,MAAM,YAAY,IAAA,qSAAW,EAAC,CAAC;QAC7B,MAAM,KAAK,MAAM,EAAE,IAAI,OAAO,UAAU;QACxC,MAAM,OAAmB;YACvB,GAAG,KAAK;YACR;YACA,SAAS,MAAM,OAAO,IAAI;QAC5B;QACA,UAAU,CAAC,OAAS;mBAAI;gBAAM;aAAK;QACnC,wBAAwB;QACxB,WAAW;YACT,UAAU,CAAC,OAAS,KAAK,MAAM,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK;QAClD,GAAG;IACL,GAAG,EAAE;IAEL,MAAM,QAAQ,IAAA,iSAAO,EACnB,IAAM,CAAC;YACL;QACF,CAAC,GACD;QAAC;KAAU;IAGb,qBACE,+TAAC,aAAa,QAAQ;QAAC,OAAO;;YAC3B;0BAED,+TAAC;gBAAI,WAAU;0BACb,cAAA,+TAAC;oBAAI,WAAU;8BACZ,OAAO,GAAG,CAAC,CAAC,sBACX,+TAAC,kNAAI;4BAEH,WAAU;4BACV,gBAAc,MAAM,OAAO;sCAE3B,cAAA,+TAAC,yNAAW;gCAAC,WAAU;;oCACpB,MAAM,KAAK,iBACV,+TAAC;wCAAE,WAAU;kDACV,MAAM,KAAK;;;;;+CAEZ;kDACJ,+TAAC;wCAAE,WAAU;kDAAiC,MAAM,WAAW;;;;;;oCAC9D,MAAM,WAAW,IAAI,MAAM,QAAQ,iBAClC,+TAAC;wCAAI,WAAU;kDACb,cAAA,+TAAC,gOAAS;4CACR,MAAK;4CACL,SAAS,MAAM,OAAO,KAAK,UAAU,gBAAgB;4CACrD,SAAS,MAAM,QAAQ;sDAEtB,MAAM,WAAW;;;;;;;;;;+CAGpB;;;;;;;2BArBD,MAAM,EAAE;;;;;;;;;;;;;;;;;;;;;AA6B3B;AAEO,SAAS;IACd,MAAM,MAAM,IAAA,oSAAU,EAAC;IACvB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,OAAO;AACT"}},
    {"offset": {"line": 3731, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/app/providers.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { AuthProvider } from '@/components/providers/AuthProvider';\r\nimport { AppProvider } from '@/context/AppContext';\r\nimport { ToastProvider } from '@/context/ToastContext';\r\n\r\nexport function Providers({ children }: { children: React.ReactNode }) {\r\n    return (\r\n        <AppProvider>\r\n            <AuthProvider>\r\n                <ToastProvider>\r\n                    {children}\r\n                </ToastProvider>\r\n            </AuthProvider>\r\n        </AppProvider>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAMO,SAAS,UAAU,EAAE,QAAQ,EAAiC;IACjE,qBACI,+TAAC,sNAAW;kBACR,cAAA,+TAAC,yOAAY;sBACT,cAAA,+TAAC,0NAAa;0BACT;;;;;;;;;;;;;;;;AAKrB"}}]
}