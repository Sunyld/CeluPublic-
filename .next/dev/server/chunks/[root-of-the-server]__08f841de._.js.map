{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/supabase/admin.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\n/**\r\n * Supabase Admin client using SERVICE_ROLE_KEY.\r\n * USE ONLY ON THE SERVER (Route Handlers, Server Actions).\r\n * This client bypasses RLS.\r\n */\r\nexport function createAdminClient() {\r\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL\r\n    const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY\r\n\r\n    if (!supabaseUrl || !supabaseServiceKey) {\r\n        throw new Error('[ADMIN] Supabase URL or Service Role Key is missing. Check your environment variables.');\r\n    }\r\n\r\n    return createClient(supabaseUrl || '', supabaseServiceKey || '', {\r\n        auth: {\r\n            autoRefreshToken: false,\r\n            persistSession: false\r\n        }\r\n    })\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAOO,SAAS;IACZ,MAAM;IACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,yBAAyB;IAEhE,IAAI,CAAC,eAAe,CAAC,oBAAoB;QACrC,MAAM,IAAI,MAAM;IACpB;IAEA,OAAO,IAAA,iRAAY,EAAC,eAAe,IAAI,sBAAsB,IAAI;QAC7D,MAAM;YACF,kBAAkB;YAClB,gBAAgB;QACpB;IACJ;AACJ"}},
    {"offset": {"line": 69, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport function createClient() {\r\n    const cookieStore = cookies()\r\n\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookies: {\r\n                get(name: string) {\r\n                    return cookieStore.get(name)?.value\r\n                },\r\n                set(name: string, value: string, options: CookieOptions) {\r\n                    try {\r\n                        cookieStore.set({ name, value, ...options })\r\n                    } catch (error) {\r\n                        // The `set` method was called from a Server Component.\r\n                        // This can be ignored if you have middleware refreshing\r\n                        // user sessions.\r\n                    }\r\n                },\r\n                remove(name: string, options: CookieOptions) {\r\n                    try {\r\n                        cookieStore.set({ name, value: '', ...options })\r\n                    } catch (error) {\r\n                        // The `remove` method was called from a Server Component.\r\n                        // This can be ignored if you have middleware refreshing\r\n                        // user sessions.\r\n                    }\r\n                },\r\n            },\r\n        }\r\n    )\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,SAAS;IACZ,MAAM,cAAc,IAAA,6NAAO;IAE3B,OAAO,IAAA,kRAAkB,sUAGrB;QACI,SAAS;YACL,KAAI,IAAY;gBACZ,OAAO,YAAY,GAAG,CAAC,OAAO;YAClC;YACA,KAAI,IAAY,EAAE,KAAa,EAAE,OAAsB;gBACnD,IAAI;oBACA,YAAY,GAAG,CAAC;wBAAE;wBAAM;wBAAO,GAAG,OAAO;oBAAC;gBAC9C,EAAE,OAAO,OAAO;gBACZ,uDAAuD;gBACvD,wDAAwD;gBACxD,iBAAiB;gBACrB;YACJ;YACA,QAAO,IAAY,EAAE,OAAsB;gBACvC,IAAI;oBACA,YAAY,GAAG,CAAC;wBAAE;wBAAM,OAAO;wBAAI,GAAG,OAAO;oBAAC;gBAClD,EAAE,OAAO,OAAO;gBACZ,0DAA0D;gBAC1D,wDAAwD;gBACxD,iBAAiB;gBACrB;YACJ;QACJ;IACJ;AAER"}},
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///D:/PROJECTOS/Reactjs/Celu/project-bolt-sb1-r7qsskrc/funcional/project/app/api/admin/banners/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { createAdminClient } from '@/lib/supabase/admin';\r\nimport { createClient } from '@/lib/supabase/server';\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        // 1. Verify user is Admin\r\n        const supabaseUserClient = createClient();\r\n        const { data: { user }, error: authError } = await supabaseUserClient.auth.getUser();\r\n\r\n        if (authError || !user) {\r\n            return NextResponse.json({ error: 'Não autenticado' }, { status: 401 });\r\n        }\r\n\r\n        // Check is_admin via RPC or profile\r\n        const { data: profile, error: profileError } = await supabaseUserClient\r\n            .from('profiles')\r\n            .select('role')\r\n            .eq('id', user.id)\r\n            .single();\r\n\r\n        if (profileError || profile?.role !== 'admin') {\r\n            return NextResponse.json({ error: 'Acesso negado: Apenas administradores' }, { status: 403 });\r\n        }\r\n\r\n        // 2. Parse FormData\r\n        const formData = await request.formData();\r\n        const title = formData.get('title') as string;\r\n        const link = (formData.get('link') as string) || '';\r\n        const active = formData.get('active') === 'true';\r\n        const order = parseInt(formData.get('order') as string) || 0;\r\n        const file = formData.get('file') as File;\r\n\r\n        if (!title || !file) {\r\n            return NextResponse.json({ error: 'Título e imagem são obrigatórios' }, { status: 400 });\r\n        }\r\n\r\n        const supabaseAdmin = createAdminClient();\r\n\r\n        // 3. Upload to Storage (Service Role)\r\n        const fileExt = file.name.split('.').pop();\r\n        const fileName = `${crypto.randomUUID()}.${fileExt}`;\r\n        const filePath = `banners/${fileName}`;\r\n\r\n        const arrayBuffer = await file.arrayBuffer();\r\n        const buffer = Buffer.from(arrayBuffer);\r\n\r\n        const { data: uploadData, error: uploadError } = await supabaseAdmin\r\n            .storage\r\n            .from('banner-images')\r\n            .upload(filePath, buffer, {\r\n                contentType: file.type,\r\n                upsert: true\r\n            });\r\n\r\n        if (uploadError) {\r\n            console.error('[API/BANNERS] Upload error:', uploadError);\r\n            return NextResponse.json({ error: `Erro no upload: ${uploadError.message}` }, { status: 500 });\r\n        }\r\n\r\n        // 4. Insert into DB (Service Role)\r\n        const { data: banner, error: dbError } = await supabaseAdmin\r\n            .from('banners')\r\n            .insert({\r\n                title,\r\n                link,\r\n                image_path: filePath,\r\n                image_url: filePath, // Fallback for old schema compatibility\r\n                active,\r\n                sort_order: order\r\n            })\r\n            .select()\r\n            .single();\r\n\r\n        if (dbError) {\r\n            console.error('[API/BANNERS] DB Insert error:', dbError);\r\n            // Se falhar por coluna inexistente, tentamos sem image_url\r\n            if (dbError.message.includes('image_url')) {\r\n                const { data: retryBanner, error: retryError } = await supabaseAdmin\r\n                    .from('banners')\r\n                    .insert({\r\n                        title,\r\n                        link,\r\n                        image_path: filePath,\r\n                        active,\r\n                        sort_order: order\r\n                    })\r\n                    .select()\r\n                    .single();\r\n                if (retryError) throw retryError;\r\n                return NextResponse.json(retryBanner);\r\n            }\r\n            throw dbError;\r\n        }\r\n\r\n        return NextResponse.json(banner);\r\n\r\n    } catch (err: any) {\r\n        console.error('[API/BANNERS] Unexpected error:', err);\r\n        return NextResponse.json({ error: 'Erro interno no servidor' }, { status: 500 });\r\n    }\r\n}\r\n\r\nexport async function PATCH(request: Request) {\r\n    try {\r\n        const supabaseUserClient = createClient();\r\n        const { data: { user }, error: authError } = await supabaseUserClient.auth.getUser();\r\n\r\n        if (authError || !user) {\r\n            return NextResponse.json({ error: 'Não autenticado' }, { status: 401 });\r\n        }\r\n\r\n        // Admin check\r\n        const { data: profile } = await supabaseUserClient.from('profiles').select('role').eq('id', user.id).single();\r\n        if (profile?.role !== 'admin') {\r\n            return NextResponse.json({ error: 'Acesso negado' }, { status: 403 });\r\n        }\r\n\r\n        const formData = await request.formData();\r\n        const id = formData.get('id') as string;\r\n        const active = formData.get('active') === 'true';\r\n        // support optional fields\r\n        const title = formData.get('title') as string | null;\r\n        const link = formData.get('link') as string | null;\r\n        const order = formData.get('order') ? parseInt(formData.get('order') as string) : undefined;\r\n\r\n        if (!id) return NextResponse.json({ error: 'ID é obrigatório' }, { status: 400 });\r\n\r\n        const supabaseAdmin = createAdminClient();\r\n        const updates: any = { active };\r\n        if (title !== null) updates.title = title;\r\n        if (link !== null) updates.link = link;\r\n        if (order !== undefined) updates.sort_order = order;\r\n        updates.updated_at = new Date().toISOString();\r\n\r\n        const { data: banner, error: dbError } = await supabaseAdmin\r\n            .from('banners')\r\n            .update(updates)\r\n            .eq('id', id)\r\n            .select()\r\n            .single();\r\n\r\n        if (dbError) {\r\n            return NextResponse.json({ error: dbError.message }, { status: 500 });\r\n        }\r\n\r\n        return NextResponse.json(banner);\r\n    } catch (err: any) {\r\n        return NextResponse.json({ error: 'Erro' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}